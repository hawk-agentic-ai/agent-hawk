
<div class="p-6">
  <!-- Page Header -->
  <div class="mb-6">
    <h2 class="text-xl font-semibold text-gray-900 mb-2">Entity Configuration</h2>
    <p class="text-gray-600">Manage and configure entities for hedge accounting</p>
  </div>

  <!-- Search and Add Button Section -->
  <div class="flex items-center gap-4 mb-4">
    <div class="flex-1 flex items-center gap-2">
      <label class="filter-label">Search:</label>
      <input type="text" placeholder="Search entities..." [(ngModel)]="search" (ngModelChange)="onSearchChange($event)" class="filter-input flex-1 max-w-xs">
    </div>
    <button class="btn btn-primary ml-auto" (click)="openAdd()">
      <i class="pi pi-plus"></i>
      <span>Add Entity</span>
    </button>
  </div>

  <!-- Data Grid -->
  <div class="bg-white rounded-lg shadow-sm border border-gray-200">
    <ag-grid-angular
      class="ag-theme-alpine w-full"
      style="height: 600px;"
      [columnDefs]="columnDefs"
      [rowData]="entities"
      [defaultColDef]="defaultColDef"
      [gridOptions]="gridOptions"
      (gridReady)="onGridReady($event)">
    </ag-grid-angular>
  </div>

  <!-- Add/Edit Entity Dialog -->
  <p-dialog 
    header="{{ mode === 'edit' ? 'Edit Entity' : 'Add Entity' }}" 
    [(visible)]="showSheet"
    [modal]="true"
    [style]="{width: '100vw', height: '90vh', 'border-top-left-radius': '16px', 'border-top-right-radius': '16px', 'max-width': '100vw', 'max-height': '90vh'}"
    [closable]="true"
    styleClass="entity-dialog entity-dialog-full">
    <form class="space-y-6 p-2">
      <!-- Section: Basic Info -->
      <div class="rounded-lg border border-gray-200 p-4 bg-white">
        <div class="grid grid-cols-12 gap-4">
          <div class="col-span-12 md:col-span-3 flex items-center">
            <div class="text-sm font-semibold text-gray-700">Basic Info</div>
          </div>
          <div class="col-span-12 md:col-span-9">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="field">
                <label class="block text-sm font-medium text-gray-700 mb-1">Entity Code</label>
                <input type="text" class="filter-input w-full" [(ngModel)]="form.legal_entity_code" name="legal_entity_code" />
              </div>
              <div class="field">
                <label class="block text-sm font-medium text-gray-700 mb-1">Entity Name</label>
                <input type="text" class="filter-input w-full" [(ngModel)]="form.entity_name" name="entity_name" />
              </div>
              <div class="field">
                <label class="block text-sm font-medium text-gray-700 mb-1">Entity Type</label>
                <p-dropdown [options]="entityTypes" [(ngModel)]="form.entity_type" name="entity_type" placeholder="Select type" styleClass="filter-input w-full" [style]="{width:'100%'}"></p-dropdown>
              </div>
              <div class="field">
                <label class="block text-sm font-medium text-gray-700 mb-1">Business Unit</label>
                <input type="text" class="filter-input w-full" [(ngModel)]="form.business_unit" name="business_unit" />
              </div>
              <div class="field">
                <label class="block text-sm font-medium text-gray-700 mb-1">Country</label>
                <p-dropdown [options]="countries" [(ngModel)]="form.country_code" name="country_code" placeholder="Select country" styleClass="filter-input w-full" [style]="{width:'100%'}"></p-dropdown>
              </div>
              <div class="field">
                <label class="block text-sm font-medium text-gray-700 mb-1">Region</label>
                <input type="text" class="filter-input w-full" [(ngModel)]="form.region" name="region" />
              </div>
              <div class="field">
                <label class="block text-sm font-medium text-gray-700 mb-1">Functional Currency</label>
                <p-dropdown [options]="currencies" [(ngModel)]="form.currency_code" name="currency_code" placeholder="Select currency" styleClass="filter-input w-full" [style]="{width:'100%'}"></p-dropdown>
              </div>
              <div class="field">
                <label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                <p-dropdown [options]="[{label: 'Active', value: 'Y'}, {label: 'Inactive', value: 'N'}]" [(ngModel)]="form.active_flag" name="active_flag" placeholder="Select status" styleClass="filter-input w-full" [style]="{width:'100%'}"></p-dropdown>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Section: Dates & Parent -->
      <div class="rounded-lg border border-gray-200 p-4 bg-white">
        <div class="grid grid-cols-12 gap-4">
          <div class="col-span-12 md:col-span-3 flex items-center">
            <div class="text-sm font-semibold text-gray-700">Dates & Parent</div>
          </div>
          <div class="col-span-12 md:col-span-9">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="field">
                <label class="block text-sm font-medium text-gray-700 mb-1">Inception Date</label>
                <input type="date" class="filter-input w-full" [(ngModel)]="form.inception_date" name="inception_date" />
              </div>
              <div class="field">
                <label class="block text-sm font-medium text-gray-700 mb-1">Termination Date</label>
                <input type="date" class="filter-input w-full" [(ngModel)]="form.termination_date" name="termination_date" />
              </div>
              <div class="field">
                <label class="block text-sm font-medium text-gray-700 mb-1">Created Date</label>
                <input type="date" class="filter-input w-full" [(ngModel)]="form.created_date" name="created_date" />
              </div>
              <div class="field">
                <label class="block text-sm font-medium text-gray-700 mb-1">Modified Date</label>
                <input type="date" class="filter-input w-full" [(ngModel)]="form.modified_date" name="modified_date" />
              </div>
              <div class="field">
                <label class="block text-sm font-medium text-gray-700 mb-1">Parent Entity</label>
                <input type="text" class="filter-input w-full" [(ngModel)]="form.parent_entity_id" name="parent_entity_id" />
              </div>
              <div class="field">
                <label class="block text-sm font-medium text-gray-700 mb-1">Parent-Child NAV Link</label>
                <p-dropdown [options]="[{label: 'Yes', value: true}, {label: 'No', value: false}]" [(ngModel)]="form.parent_child_nav_link" name="parent_child_nav_link" placeholder="Select" styleClass="filter-input w-full" [style]="{width:'100%'}"></p-dropdown>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Section: Regulatory & Risk -->
      <div class="rounded-lg border border-gray-200 p-4 bg-white">
        <div class="grid grid-cols-12 gap-4">
          <div class="col-span-12 md:col-span-3 flex items-center">
            <div class="text-sm font-semibold text-gray-700">Regulatory & Risk</div>
          </div>
          <div class="col-span-12 md:col-span-9">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="field">
                <label class="block text-sm font-medium text-gray-700 mb-1">CAR Exemption</label>
                <p-dropdown [options]="[{label: 'Yes', value: 'Y'}, {label: 'No', value: 'N'}]" [(ngModel)]="form.car_exemption_flag" name="car_exemption_flag" placeholder="Select" styleClass="filter-input w-full" [style]="{width:'100%'}"></p-dropdown>
              </div>
              <div class="field">
                <label class="block text-sm font-medium text-gray-700 mb-1">Regulatory Classification</label>
                <input type="text" class="filter-input w-full" [(ngModel)]="form.regulatory_classification" name="regulatory_classification" />
              </div>
              <div class="field">
                <label class="block text-sm font-medium text-gray-700 mb-1">Risk Weight Category</label>
                <input type="text" class="filter-input w-full" [(ngModel)]="form.risk_weight_category" name="risk_weight_category" />
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Section: Murex & Comments -->
      <div class="rounded-lg border border-gray-200 p-4 bg-white">
        <div class="grid grid-cols-12 gap-4">
          <div class="col-span-12 md:col-span-3 flex items-center">
            <div class="text-sm font-semibold text-gray-700">Murex & Comments</div>
          </div>
          <div class="col-span-12 md:col-span-9">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="field">
                <label class="block text-sm font-medium text-gray-700 mb-1">Murex Issuer</label>
                <input type="text" class="filter-input w-full" [(ngModel)]="form.murex_issuer" name="murex_issuer" />
              </div>
              <div class="field">
                <label class="block text-sm font-medium text-gray-700 mb-1">Murex Comment</label>
                <input type="text" class="filter-input w-full" [(ngModel)]="form.murex_comment" name="murex_comment" />
              </div>
              <div class="field col-span-2">
                <label class="block text-sm font-medium text-gray-700 mb-1">Comments</label>
                <textarea rows="2" class="filter-input w-full" [(ngModel)]="form.comments" name="comments"></textarea>
              </div>
            </div>
          </div>
        </div>
      </div>

    </form>
    <ng-template pTemplate="footer">
      <div class="flex justify-end space-x-3 pt-4 border-t border-gray-200">
        <button class="btn btn-secondary" (click)="showSheet = false">Cancel</button>
        <button class="btn btn-primary" (click)="confirmSave()">{{ mode === 'edit' ? 'Update Entity' : 'Save Entity' }}</button>
      </div>
    </ng-template>
  </p-dialog>
</div>
