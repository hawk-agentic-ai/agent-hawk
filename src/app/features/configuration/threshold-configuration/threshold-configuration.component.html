<div class="p-6">
  <!-- Page Header -->
  <div class="mb-6">
    <div class="flex justify-between items-center">
      <div>
        <h2 class="text-xl font-semibold text-gray-900 mb-2">Threshold Configuration</h2>
        <p class="text-gray-600">Manage and configure threshold settings for risk monitoring</p>
      </div>
      <button class="btn btn-primary" (click)="openAdd()">
        <i class="pi pi-plus"></i>
        <span>Add Threshold</span>
      </button>
    </div>
  </div>

  <!-- Search Bar -->
  <div class="flex items-center gap-4 mb-4">
    <div class="flex-1 flex items-center gap-2">
      <label class="filter-label">Search:</label>
      <input type="text" placeholder="Search thresholds..." [(ngModel)]="search" (ngModelChange)="onSearchChange($event)" class="filter-input flex-1 max-w-xs">
    </div>
  </div>

  <!-- Data Grid -->
  <div class="bg-white rounded-lg shadow-sm border border-gray-200">
    <ag-grid-angular
      class="ag-theme-alpine w-full"
      style="height: 600px;"
      [columnDefs]="columnDefs"
      [rowData]="thresholds"
      [defaultColDef]="defaultColDef"
      [gridOptions]="gridOptions"
      (gridReady)="onGridReady($event)">
    </ag-grid-angular>
  </div>

  <!-- Add/Edit Threshold Dialog -->
  <p-dialog 
    header="{{ mode === 'edit' ? 'Edit Threshold' : 'Add Threshold' }}" 
    [(visible)]="showSheet"
    [modal]="true"
    [style]="{width: '900px'}"
    [closable]="true"
    styleClass="entity-dialog entity-dialog-full">
    <form class="space-y-6 p-2">
      <!-- Section: Basic Info -->
      <div class="rounded-lg border border-gray-200 p-4 bg-white">
        <div class="grid grid-cols-12 gap-4">
          <div class="col-span-12 md:col-span-3 flex items-center">
            <div class="text-sm font-semibold text-gray-700">Basic Info</div>
          </div>
          <div class="col-span-12 md:col-span-9">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="field">
                <label class="block text-sm font-medium text-gray-700 mb-1">Threshold ID</label>
                <input type="text" class="filter-input w-full" [(ngModel)]="form.threshold_id" name="threshold_id" />
              </div>
              <div class="field">
                <label class="block text-sm font-medium text-gray-700 mb-1">Threshold Type</label>
                <input type="text" class="filter-input w-full" [(ngModel)]="form.threshold_type" name="threshold_type" />
              </div>
              <div class="field">
                <label class="block text-sm font-medium text-gray-700 mb-1">Currency Code</label>
                <input type="text" class="filter-input w-full" [(ngModel)]="form.currency_code" name="currency_code" />
              </div>
              <div class="field">
                <label class="block text-sm font-medium text-gray-700 mb-1">Entity Type</label>
                <input type="text" class="filter-input w-full" [(ngModel)]="form.entity_type" name="entity_type" />
              </div>
              <div class="field">
                <label class="block text-sm font-medium text-gray-700 mb-1">Unit of Measure</label>
                <input type="text" class="filter-input w-full" [(ngModel)]="form.unit_of_measure" name="unit_of_measure" />
              </div>
              <div class="field">
                <label class="block text-sm font-medium text-gray-700 mb-1">Maximum Limit</label>
                <input type="number" class="filter-input w-full" [(ngModel)]="form.maximum_limit" name="maximum_limit" />
              </div>
              <div class="field">
                <label class="block text-sm font-medium text-gray-700 mb-1">Warning Level</label>
                <input type="number" class="filter-input w-full" [(ngModel)]="form.warning_level" name="warning_level" />
              </div>
              <div class="field">
                <label class="block text-sm font-medium text-gray-700 mb-1">Critical Level</label>
                <input type="number" class="filter-input w-full" [(ngModel)]="form.critical_level" name="critical_level" />
              </div>
              <div class="field">
                <label class="block text-sm font-medium text-gray-700 mb-1">Tolerance (min)</label>
                <input type="number" class="filter-input w-full" [(ngModel)]="form.breach_tolerance_minutes" name="breach_tolerance_minutes" />
              </div>
              <div class="field">
                <label class="block text-sm font-medium text-gray-700 mb-1">Automated Action</label>
                <p-dropdown [options]="[{label: 'Yes', value: 'Y'}, {label: 'No', value: 'N'}]" [(ngModel)]="form.automated_action_flag" name="automated_action_flag" placeholder="Select" styleClass="filter-input w-full" [style]="{width:'100%'}"></p-dropdown>
              </div>
              <div class="field">
                <label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                <p-dropdown [options]="[{label: 'Active', value: 'Y'}, {label: 'Inactive', value: 'N'}]" [(ngModel)]="form.active_flag" name="active_flag" placeholder="Select status" styleClass="filter-input w-full" [style]="{width:'100%'}"></p-dropdown>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Section: Escalation & Notification -->
      <div class="rounded-lg border border-gray-200 p-4 bg-white">
        <div class="grid grid-cols-12 gap-4">
          <div class="col-span-12 md:col-span-3 flex items-center">
            <div class="text-sm font-semibold text-gray-700">Escalation & Notification</div>
          </div>
          <div class="col-span-12 md:col-span-9">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="field">
                <label class="block text-sm font-medium text-gray-700 mb-1">Escalation Level 1</label>
                <input type="text" class="filter-input w-full" [(ngModel)]="form.escalation_level_1" name="escalation_level_1" />
              </div>
              <div class="field">
                <label class="block text-sm font-medium text-gray-700 mb-1">Escalation Level 2</label>
                <input type="text" class="filter-input w-full" [(ngModel)]="form.escalation_level_2" name="escalation_level_2" />
              </div>
              <div class="field">
                <label class="block text-sm font-medium text-gray-700 mb-1">Escalation Level 3</label>
                <input type="text" class="filter-input w-full" [(ngModel)]="form.escalation_level_3" name="escalation_level_3" />
              </div>
              <div class="field col-span-2">
                <label class="block text-sm font-medium text-gray-700 mb-1">Notification Emails</label>
                <textarea rows="2" class="filter-input w-full" [(ngModel)]="form.notification_emails" name="notification_emails"></textarea>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Section: Dates & Audit -->
      <div class="rounded-lg border border-gray-200 p-4 bg-white">
        <div class="grid grid-cols-12 gap-4">
          <div class="col-span-12 md:col-span-3 flex items-center">
            <div class="text-sm font-semibold text-gray-700">Dates & Audit</div>
          </div>
          <div class="col-span-12 md:col-span-9">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="field">
                <label class="block text-sm font-medium text-gray-700 mb-1">Effective Date</label>
                <input type="date" class="filter-input w-full" [(ngModel)]="form.effective_date" name="effective_date" />
              </div>
              <div class="field">
                <label class="block text-sm font-medium text-gray-700 mb-1">Expiry Date</label>
                <input type="date" class="filter-input w-full" [(ngModel)]="form.expiry_date" name="expiry_date" />
              </div>
              <div class="field">
                <label class="block text-sm font-medium text-gray-700 mb-1">Created Date</label>
                <input type="datetime-local" class="filter-input w-full" [(ngModel)]="form.created_date" name="created_date" />
              </div>
              <div class="field">
                <label class="block text-sm font-medium text-gray-700 mb-1">Modified Date</label>
                <input type="datetime-local" class="filter-input w-full" [(ngModel)]="form.modified_date" name="modified_date" />
              </div>
              <div class="field">
                <label class="block text-sm font-medium text-gray-700 mb-1">Created By</label>
                <input type="text" class="filter-input w-full" [(ngModel)]="form.created_by" name="created_by" />
              </div>
              <div class="field">
                <label class="block text-sm font-medium text-gray-700 mb-1">Modified By</label>
                <input type="text" class="filter-input w-full" [(ngModel)]="form.modified_by" name="modified_by" />
              </div>
            </div>
          </div>
        </div>
      </div>
    </form>
    <ng-template pTemplate="footer">
      <div class="flex justify-end space-x-3 pt-4 border-t border-gray-200">
        <button class="btn btn-secondary" (click)="showSheet = false">Cancel</button>
        <button class="btn btn-primary" (click)="confirmSave()">{{ mode === 'edit' ? 'Update Threshold' : 'Save Threshold' }}</button>
      </div>
    </ng-template>
  </p-dialog>
</div>
