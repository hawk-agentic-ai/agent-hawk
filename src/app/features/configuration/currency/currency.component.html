<div class="currency-container p-6 h-full flex flex-col">
  <!-- Page Header -->
  <div class="mb-6">
    <h2 class="text-xl font-semibold text-gray-900 mb-2">Currency Configuration</h2>
    <p class="text-gray-600">Manage and configure currencies for hedge accounting system</p>
  </div>

  <!-- Search and Filters -->
  <div class="filter-bar">
    <div class="filter-row w-full items-center">
      <!-- Left: filters -->
      <div class="flex items-center gap-4 flex-wrap flex-1">
        <div class="flex items-center gap-2">
          <label class="filter-label">Search:</label>
          <input type="text"
                 class="filter-input w-64"
                 placeholder="Search currencies..."
                 [(ngModel)]="searchTerm"
                 (ngModelChange)="onSearchChange($event)"
                 (keyup.enter)="loadCurrencies()" />
        </div>
        <div class="flex items-center gap-2">
          <label class="filter-label">Currency Type:</label>
          <select class="filter-input w-40" [(ngModel)]="selectedType" (change)="loadCurrencies()">
            <option [ngValue]="null">All</option>
            <option *ngFor="let opt of currencyTypes" [value]="opt.value">{{ opt.label }}</option>
          </select>
        </div>
        <div class="flex items-center gap-2">
          <label class="filter-label">Status:</label>
          <select class="filter-input w-40" [(ngModel)]="selectedStatus" (change)="loadCurrencies()">
            <option [ngValue]="null">All</option>
            <option *ngFor="let opt of statusOptions" [value]="opt.value">{{ opt.label }}</option>
          </select>
        </div>
      </div>
      <!-- Right: Add button -->
      <div class="ml-auto">
        <button class="btn btn-primary" (click)="openAdd()">
          <i class="pi pi-plus"></i>
          <span>Add</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Currencies Table (AG Grid) -->
  <div class="bg-white rounded-lg shadow-sm border border-gray-200 flex-1 min-h-0 overflow-hidden">
    <ag-grid-angular
      class="ag-theme-alpine w-full"
      style="height: 100%; min-height: 420px;"
      [columnDefs]="columnDefs"
      [rowData]="currencies"
      [defaultColDef]="defaultColDef"
      [gridOptions]="gridOptions"
      (gridReady)="onGridReady($event)">
    </ag-grid-angular>
  </div>

  <!-- Right-aligned full-height overlay for Add -->
  <div *ngIf="showAddDialog" class="fixed inset-0 z-40">
    <!-- Backdrop -->
    <div class="absolute inset-0 bg-black/50" (click)="showAddDialog = false; dialogMode = 'add';"></div>
    <!-- Slide-over panel -->
    <div class="absolute inset-x-0 top-[2.5vh] h-[95vh] w-[100vw] max-w-[100vw] bg-white shadow-xl border border-gray-200 rounded-t-2xl overflow-hidden flex flex-col" (click)="$event.stopPropagation()">
      <!-- Header -->
      <div class="flex items-center justify-between px-4 py-3 border-b border-gray-200">
        <h3 class="text-base font-semibold text-gray-900">{{ dialogMode === 'edit' ? 'Edit Currency' : 'Add Currency' }}</h3>
        <button class="btn btn-tertiary" (click)="showAddDialog = false" title="Close">
          <i class="pi pi-times"></i>
        </button>
      </div>
      <!-- Content -->
      <div class="flex-1 overflow-auto p-4 space-y-4 bg-[#F5F7F9]">
        <!-- Section: General Information -->
        <div class="rounded-lg border border-gray-200 p-4 bg-white">
          <div class="grid grid-cols-12 gap-4">
            <div class="col-span-12 md:col-span-3">
              <div class="text-sm font-semibold text-gray-700">General Information</div>
            </div>
            <div class="col-span-12 md:col-span-9">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="field">
                  <label for="currencyCode" class="block text-sm font-medium text-gray-700 mb-1">Currency Code</label>
                  <input id="currencyCode" type="text" pInputText [(ngModel)]="newCurrency.code" placeholder="e.g., USD" class="filter-input w-full">
                </div>
                <div class="field">
                  <label for="currencyName" class="block text-sm font-medium text-gray-700 mb-1">Currency Name</label>
                  <input id="currencyName" type="text" pInputText [(ngModel)]="newCurrency.name" placeholder="US Dollar" class="filter-input w-full">
                </div>
                <div class="field">
                  <label for="currencyType" class="block text-sm font-medium text-gray-700 mb-1">Currency Type</label>
                  <p-dropdown id="currencyType" [options]="currencyTypes" [(ngModel)]="newCurrency.type" placeholder="Select currency type" styleClass="filter-input w-full" [style]="{width: '100%'}"></p-dropdown>
                </div>
                <div class="field">
                  <label for="baseCurrency" class="block text-sm font-medium text-gray-700 mb-1">Base Currency</label>
                  <input id="baseCurrency" type="text" pInputText [(ngModel)]="newCurrency.baseCurrency" placeholder="e.g., SGD" class="filter-input w-full">
                </div>
                <div class="field">
                  <label for="active" class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                  <p-dropdown id="active" [options]="[{label: 'Active', value: true}, {label: 'Inactive', value: false}]" [(ngModel)]="newCurrency.active" placeholder="Select status" styleClass="filter-input w-full" [style]="{width: '100%'}"></p-dropdown>
                </div>
                <div class="field">
                  <label for="proxyCurrency" class="block text-sm font-medium text-gray-700 mb-1">Proxy Currency</label>
                  <input id="proxyCurrency" type="text" pInputText [(ngModel)]="newCurrency.proxyCurrency" placeholder="Optional" class="filter-input w-full">
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Section: Eligibility & Flags -->
        <div class="rounded-lg border border-gray-200 p-4 bg-white">
          <div class="grid grid-cols-12 gap-4">
            <div class="col-span-12 md:col-span-3">
              <div class="text-sm font-semibold text-gray-700">Eligibility & Flags</div>
            </div>
            <div class="col-span-12 md:col-span-9">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="field">
                  <label class="block text-sm font-medium text-gray-700 mb-1">Deliverable</label>
                  <p-dropdown [options]="yesNoOptions" [(ngModel)]="newCurrency.isDeliverable" placeholder="Select" styleClass="filter-input w-full" [style]="{width: '100%'}"></p-dropdown>
                </div>
                <div class="field">
                  <label class="block text-sm font-medium text-gray-700 mb-1">Dealing Currency</label>
                  <p-dropdown [options]="yesNoOptions" [(ngModel)]="newCurrency.dealingCurrency" placeholder="Select" styleClass="filter-input w-full" [style]="{width: '100%'}"></p-dropdown>
                </div>
                <div class="field">
                  <label class="block text-sm font-medium text-gray-700 mb-1">Hedge Accounting Eligible</label>
                  <p-dropdown [options]="yesNoOptions" [(ngModel)]="newCurrency.hedgeEligible" placeholder="Select" styleClass="filter-input w-full" [style]="{width: '100%'}"></p-dropdown>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Section: Deal Constraints -->
        <div class="rounded-lg border border-gray-200 p-4 bg-white">
          <div class="grid grid-cols-12 gap-4">
            <div class="col-span-12 md:col-span-3">
              <div class="text-sm font-semibold text-gray-700">Deal Constraints</div>
            </div>
            <div class="col-span-12 md:col-span-9">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="field">
                  <label class="block text-sm font-medium text-gray-700 mb-1">Settlement Days</label>
                  <input type="number" pInputText [(ngModel)]="newCurrency.settlementDays" class="filter-input w-full">
                </div>
                <div class="field">
                  <label class="block text-sm font-medium text-gray-700 mb-1">Minimum Deal Size</label>
                  <input type="number" step="0.01" pInputText [(ngModel)]="newCurrency.minDealSize" class="filter-input w-full">
                </div>
                <div class="field">
                  <label class="block text-sm font-medium text-gray-700 mb-1">Maximum Deal Size</label>
                  <input type="number" step="0.01" pInputText [(ngModel)]="newCurrency.maxDealSize" class="filter-input w-full">
                </div>
                <div class="field">
                  <label class="block text-sm font-medium text-gray-700 mb-1">Rounding Precision</label>
                  <input type="number" pInputText [(ngModel)]="newCurrency.rounding" class="filter-input w-full">
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Section: Market Hours -->
        <div class="rounded-lg border border-gray-200 p-4 bg-white">
          <div class="grid grid-cols-12 gap-4">
            <div class="col-span-12 md:col-span-3">
              <div class="text-sm font-semibold text-gray-700">Market Hours</div>
            </div>
            <div class="col-span-12 md:col-span-9">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="field">
                  <label class="block text-sm font-medium text-gray-700 mb-1">Start</label>
                  <input type="time" class="filter-input w-full" [(ngModel)]="newCurrency.marketStart">
                </div>
                <div class="field">
                  <label class="block text-sm font-medium text-gray-700 mb-1">End</label>
                  <input type="time" class="filter-input w-full" [(ngModel)]="newCurrency.marketEnd">
                </div>
                <div class="field">
                  <label class="block text-sm font-medium text-gray-700 mb-1">Cut-off</label>
                  <input type="time" class="filter-input w-full" [(ngModel)]="newCurrency.cutoff">
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Section: Dates -->
        <div class="rounded-lg border border-gray-200 p-4 bg-white">
          <div class="grid grid-cols-12 gap-4">
            <div class="col-span-12 md:col-span-3">
              <div class="text-sm font-semibold text-gray-700">Dates</div>
            </div>
            <div class="col-span-12 md:col-span-9">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="field">
                  <label class="block text-sm font-medium text-gray-700 mb-1">Effective Date</label>
                  <input type="date" class="filter-input w-full" [(ngModel)]="newCurrency.effectiveDate">
                </div>
                <div class="field">
                  <label class="block text-sm font-medium text-gray-700 mb-1">Expiry Date</label>
                  <input type="date" class="filter-input w-full" [(ngModel)]="newCurrency.expiryDate">
                </div>
              </div>
            </div>
          </div>
        </div>

        
      </div>
      <!-- Footer -->
      <div class="px-4 py-3 border-t border-gray-200 flex justify-between items-center gap-2 bg-white">
        <button class="btn btn-secondary" (click)="showAddDialog = false"><i class="pi pi-times"></i><span>Cancel</span></button>
        <button class="btn btn-primary" (click)="saveCurrency()"><i class="pi pi-check"></i><span>Save</span></button>
      </div>
    </div>
  </div>

  <!-- Confirm Save Dialog -->
  <p-dialog header="Confirm Changes" [(visible)]="showConfirmSave" [modal]="true" [closable]="false" [style]="{width: '520px'}" styleClass="app-dialog">
    <div class="flex flex-col items-center text-center gap-2">
      <i class="pi pi-check-circle text-green-500 text-4xl mb-1"></i>
      <div class="text-base font-semibold text-gray-800">Apply Changes</div>
      <div class="text-sm text-gray-600">Confirm updating currency <strong>{{ newCurrency.code }}</strong>.</div>
    </div>
    <ng-template pTemplate="footer">
      <div class="flex justify-end gap-2 w-full">
        <button class="btn btn-secondary" (click)="showConfirmSave = false"><i class="pi pi-times"></i><span>Cancel</span></button>
        <button class="btn btn-primary" (click)="confirmSaveChanges()"><i class="pi pi-check"></i><span>Confirm</span></button>
      </div>
    </ng-template>
  </p-dialog>

  <!-- Confirm Delete Dialog -->
  <p-dialog header="Delete Currency" [(visible)]="showConfirmDelete" [modal]="true" [closable]="false" [style]="{width: '520px'}" styleClass="app-dialog">
    <div class="flex flex-col items-center text-center gap-2">
      <i class="pi pi-trash text-red-500 text-4xl mb-1"></i>
      <div class="text-base font-semibold text-gray-800">Delete Currency</div>
      <div class="text-sm text-gray-600">This action cannot be undone. Delete <strong>{{ pendingDeleteCode }}</strong>?</div>
    </div>
    <ng-template pTemplate="footer">
      <div class="flex justify-end gap-2 w-full">
        <button class="btn btn-secondary" (click)="showConfirmDelete = false"><i class="pi pi-times"></i><span>Cancel</span></button>
        <button class="btn btn-primary" (click)="confirmDelete()"><i class="pi pi-trash"></i><span>Delete</span></button>
      </div>
    </ng-template>
  </p-dialog>
</div>
