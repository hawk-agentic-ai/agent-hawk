<div class="dashboard-container">
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-left">
      <h2 class="page-title">Dashboard</h2>
      <p class="page-description">Overview of hedge accounting positions and key metrics</p>
    </div>
    <div class="header-right">
      <label class="filter-label mr-2">Currency:</label>
      <p-dropdown 
        [options]="availableCurrencies" 
        [(ngModel)]="selectedCurrency" 
        (onChange)="onCurrencyChange()"
        placeholder="All Currencies"
        optionLabel="label"
        styleClass="filter-input"
        [style]="{'min-width': '180px', 'width': '220px'}"
        [showClear]="false">
      </p-dropdown>
    </div>
  </div>

  <!-- KPI Cards -->
  <div class="kpi-section">
    <div class="kpi-grid">
      <div *ngFor="let kpi of kpiCards" class="kpi-card">
        <div class="kpi-header">
          <div class="kpi-icon-container">
            <i [class]="kpi.icon + ' kpi-icon'"></i>
          </div>
          <div class="kpi-change" 
               [class.positive]="kpi.changeType === 'positive'"
               [class.negative]="kpi.changeType === 'negative'">
            {{ kpi.change }}
          </div>
        </div>
        <div class="kpi-content">
          <h3 class="kpi-title">{{ kpi.title }}</h3>
          <p class="kpi-value">{{ kpi.value }}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Charts Section -->
  <div class="charts-section">
    <div class="charts-grid">
      <!-- Row 1: Primary Charts -->
      <!-- Row 1: Donuts side-by-side -->
      <p-card header="Currency Distribution" class="chart-card chart-donut">
        <div class="chart-wrapper">
          <p-chart type="doughnut" [data]="currencyChartData" [options]="chartOptions" class="w-full"></p-chart>
        </div>
      </p-card>
      
      <p-card header="Position Status" class="chart-card chart-donut">
        <div class="chart-wrapper">
          <p-chart type="doughnut" [data]="positionStatusChartData" [options]="chartOptions" class="w-full"></p-chart>
        </div>
      </p-card>
      
      <!-- Row 2: Comparison Charts -->
      <p-card header="NAV vs Position" class="chart-card chart-line">
        <div class="chart-wrapper">
          <p-chart type="line" [data]="navVsPositionChartData" [options]="lineChartOptions" class="w-full"></p-chart>
        </div>
      </p-card>
      
      <p-card header="Entity Exposure" class="chart-card chart-bar">
        <div class="chart-wrapper">
          <p-chart type="bar" [data]="entityExposureChartData" [options]="barChartOptions" class="w-full"></p-chart>
        </div>
      </p-card>
      
      <!-- Row 3: Analysis Charts -->
      <p-card header="Position Value Over Time" class="chart-card chart-line">
        <div class="chart-wrapper">
          <p-chart type="line" [data]="positionValueChartData" [options]="lineChartOptions" class="w-full"></p-chart>
        </div>
      </p-card>
      
      <p-card header="Hedge Coverage Ratio" class="chart-card chart-line">
        <div class="chart-wrapper">
          <p-chart type="line" [data]="hedgeCoverageChartData" [options]="lineChartOptions" class="w-full"></p-chart>
        </div>
      </p-card>
    </div>
  </div>

  <!-- Recent Activities -->
  <div class="activities-section">
    <div class="activities-card">
      <div class="activities-header">
        <h3 class="activities-title">Recent Activities</h3>
      </div>
      <div class="activities-content">
        <div *ngFor="let activity of recentActivities; let last = last" class="activity-row">
          <!-- Left: Avatar/Icon -->
          <div class="activity-avatar">
            <span class="avatar-circle">
              <i [class]="activity.icon" [ngClass]="activity.iconColor"></i>
            </span>
          </div>
          <!-- Middle: Content -->
          <div class="activity-main">
            <div class="activity-title-line">
              <span class="activity-actor">{{ activity.user }}</span>
              <span class="activity-text">{{ activity.title }}</span>
              <a class="activity-link" *ngIf="activity.metadata?.link" [href]="activity.metadata.link" target="_blank" rel="noopener">{{ activity.metadata.linkLabel || 'Details' }}</a>
            </div>
            <div class="activity-desc">{{ activity.description }}</div>
            <div class="prompt-snippet" *ngIf="activity.type==='template_execution' && activity.metadata?.prompt_text">
              {{ activity.metadata.prompt_text }}
            </div>
            <div class="chip-list" *ngIf="activity.tags?.length">
              <span class="chip" *ngFor="let tag of activity.tags">{{ tag }}</span>
            </div>
            <div class="activity-meta">
              <span class="activity-time">{{ activity.timestamp }}</span>
              <span class="dot">â€¢</span>
              <span class="activity-status" *ngIf="activity.tags && activity.tags.length">Status: {{ activity.tags[activity.tags.length-1] }}</span>
            </div>
          </div>
          <!-- Right: Action -->
          <div class="activity-action">
            <button class="btn btn-secondary" (click)="viewRow(activity)">
              <i class="pi pi-eye"></i>
              <span>View</span>
            </button>
          </div>
          <div class="activity-divider" *ngIf="!last"></div>
        </div>

        <div *ngIf="recentActivities.length === 0" class="activity-row">
          <div class="activity-avatar"><span class="avatar-circle info"><i class="pi pi-info-circle"></i></span></div>
          <div class="activity-main">
            <div class="activity-title-line"><span class="activity-text">Loading activities...</span></div>
            <div class="activity-desc">Recent system activities will appear here</div>
          </div>
        </div>
      </div>
      <!-- footer removed per request -->
    </div>
  </div>
</div>
