"use strict";(self.webpackChunkhedge_accounting_sfx=self.webpackChunkhedge_accounting_sfx||[]).push([[873],{873:(_e,x,p)=>{p.r(x),p.d(x,{PromptTemplatesComponent:()=>ge});var _=p(467),v=p(177),m=p(4341),b=p(1626);const C="https://udify.app/chatbot/9FLUTdD0hszkzdTC",P=(()=>{try{return new URL(C).origin}catch{return"*"}})();var I=p(1570),e=p(4438),F=p(345),k=p(7673),R=p(8384),T=p(6354);let j=(()=>{class i{constructor(t){this.http=t,this.mockCurrencyConfig=[{id:"1",currencyCode:"SGD",currencyName:"Singapore Dollar",isActive:!0,priority:1},{id:"2",currencyCode:"USD",currencyName:"US Dollar",isActive:!0,priority:2},{id:"3",currencyCode:"EUR",currencyName:"Euro",isActive:!0,priority:3},{id:"4",currencyCode:"GBP",currencyName:"British Pound",isActive:!0,priority:4},{id:"5",currencyCode:"JPY",currencyName:"Japanese Yen",isActive:!0,priority:5},{id:"6",currencyCode:"AUD",currencyName:"Australian Dollar",isActive:!0,priority:6},{id:"7",currencyCode:"HKD",currencyName:"Hong Kong Dollar",isActive:!0,priority:7},{id:"8",currencyCode:"CNY",currencyName:"Chinese Yuan",isActive:!0,priority:8},{id:"9",currencyCode:"INR",currencyName:"Indian Rupee",isActive:!0,priority:9},{id:"10",currencyCode:"KRW",currencyName:"South Korean Won",isActive:!0,priority:10},{id:"11",currencyCode:"TWD",currencyName:"Taiwan Dollar",isActive:!0,priority:11},{id:"12",currencyCode:"THB",currencyName:"Thai Baht",isActive:!0,priority:12},{id:"13",currencyCode:"MYR",currencyName:"Malaysian Ringgit",isActive:!0,priority:13},{id:"14",currencyCode:"CAD",currencyName:"Canadian Dollar",isActive:!0,priority:14},{id:"15",currencyCode:"CHF",currencyName:"Swiss Franc",isActive:!0,priority:15}]}getCurrencyCodes(){return(0,k.of)(this.mockCurrencyConfig).pipe((0,R.c)(300),(0,T.T)(t=>t.filter(n=>n.isActive).sort((n,r)=>n.priority-r.priority).map(n=>n.currencyCode)))}getCurrencyConfigs(){return(0,k.of)(this.mockCurrencyConfig).pipe((0,R.c)(300),(0,T.T)(t=>t.filter(n=>n.isActive)))}static{this.\u0275fac=function(n){return new(n||i)(e.KVO(b.Qq))}}static{this.\u0275prov=e.jDH({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var w=p(6806);const S=["agentFrame"],M=["resultsSection"],E=()=>[1,2,3,4,5];function $(i,a){if(1&i){const t=e.RV6();e.j41(0,"button",39),e.bIt("click",function(){const r=e.eBV(t).$implicit,s=e.XpG(2);return e.Njj(s.onInstructionTypeSelect(r.key))}),e.EFF(1),e.j41(2,"span",40),e.EFF(3),e.k0s()()}if(2&i){const t=a.$implicit,n=e.XpG(2);e.Y8G("ngClass",n.activeInstructionType===t.key?"bg-gray-800 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),e.R7$(),e.SpI(" ",t.label," "),e.R7$(2),e.SpI("(",t.count,")")}}function G(i,a){if(1&i){const t=e.RV6();e.j41(0,"button",44),e.bIt("click",function(){const r=e.eBV(t).$implicit,s=e.XpG(3);return e.Njj(s.loadRecentTemplate(r))}),e.EFF(1),e.k0s()}if(2&i){const t=a.$implicit;e.R7$(),e.SpI(" ",t.label," ")}}function N(i,a){if(1&i&&(e.j41(0,"div",20)(1,"span",41),e.EFF(2,"Recent"),e.k0s(),e.j41(3,"div",42),e.DNE(4,G,2,1,"button",43),e.k0s()()),2&i){const t=e.XpG(2);e.R7$(4),e.Y8G("ngForOf",t.recentTemplates.slice(0,3))}}function D(i,a){if(1&i&&(e.j41(0,"option",45),e.EFF(1),e.k0s()),2&i){const t=a.$implicit;e.Y8G("value",t.key),e.R7$(),e.Lme(" ",t.label," (",t.count,") ")}}function V(i,a){if(1&i){const t=e.RV6();e.j41(0,"label",46)(1,"div",47)(2,"input",48),e.bIt("change",function(){const r=e.eBV(t).index,s=e.XpG(2);return e.Njj(s.selectPrompt(r))}),e.k0s()(),e.j41(3,"div",49)(4,"div",50)(5,"div",51),e.EFF(6),e.k0s()(),e.j41(7,"div",52)(8,"div",53),e.EFF(9),e.k0s()(),e.j41(10,"div",54)(11,"div",55),e.EFF(12),e.k0s(),e.j41(13,"div",56),e.EFF(14),e.k0s()()()()}if(2&i){const t=a.$implicit,n=a.index,r=e.XpG(2);e.R7$(2),e.Y8G("checked",r.selectedPromptIndex===n),e.R7$(4),e.SpI("Template ",n+1,""),e.R7$(3),e.JRh(t.template),e.R7$(2),e.Y8G("title",t.usageCount+" uses"),e.R7$(),e.SpI(" ",r.formatUsageCount(t.usageCount)," "),e.R7$(),e.Y8G("title",t.successRate+"% success rate"),e.R7$(),e.SpI(" ",t.successRate,"% ")}}function A(i,a){if(1&i&&(e.j41(0,"span",68),e.EFF(1),e.k0s()),2&i){const t=e.XpG().$implicit;e.R7$(),e.JRh(t.text)}}function B(i,a){if(1&i){const t=e.RV6();e.j41(0,"input",72),e.mxI("ngModelChange",function(r){e.eBV(t);const s=e.XpG(5);return e.DH7(s.amount,r)||(s.amount=r),e.Njj(r)}),e.k0s()}if(2&i){const t=e.XpG(5);e.R50("ngModel",t.amount)}}function U(i,a){if(1&i){const t=e.RV6();e.j41(0,"input",73),e.mxI("ngModelChange",function(r){e.eBV(t);const s=e.XpG(5);return e.DH7(s.date,r)||(s.date=r),e.Njj(r)}),e.k0s()}if(2&i){const t=e.XpG(5);e.R50("ngModel",t.date)}}function X(i,a){if(1&i&&(e.j41(0,"option",45),e.EFF(1),e.k0s()),2&i){const t=a.$implicit;e.Y8G("value",t),e.R7$(),e.JRh(t)}}function H(i,a){if(1&i){const t=e.RV6();e.j41(0,"select",74),e.bIt("ngModelChange",function(r){e.eBV(t);const s=e.XpG(2).$implicit,o=e.XpG(3);return e.Njj(o.onPlaceholderChange(s.name,r))}),e.DNE(1,X,2,2,"option",23),e.k0s()}if(2&i){const t=e.XpG(2).$implicit,n=e.XpG(3);e.Y8G("ngModel",n.placeholderValues[t.name]),e.R7$(),e.Y8G("ngForOf",n.getOptionsFor(t.name))("ngForTrackBy",n.trackByIndex)}}function Y(i,a){if(1&i&&(e.qex(0),e.DNE(1,B,1,1,"input",69)(2,U,1,1,"input",70)(3,H,2,3,"select",71),e.bVm()),2&i){const t=e.XpG().$implicit;e.R7$(),e.Y8G("ngIf","amount"===t.name),e.R7$(),e.Y8G("ngIf","date"===t.name),e.R7$(),e.Y8G("ngIf","amount"!==t.name&&"date"!==t.name)}}function O(i,a){if(1&i&&(e.qex(0),e.DNE(1,A,2,1,"span",66)(2,Y,4,3,"ng-container",67),e.bVm()),2&i){const t=a.$implicit;e.R7$(),e.Y8G("ngIf","text"===t.type),e.R7$(),e.Y8G("ngIf","placeholder"===t.type)}}function L(i,a){1&i&&(e.j41(0,"span",20),e.nrm(1,"div",75),e.EFF(2," Processing... "),e.k0s())}function z(i,a){1&i&&(e.j41(0,"span",20),e.nrm(1,"i",76),e.EFF(2," Submit "),e.k0s())}function J(i,a){if(1&i){const t=e.RV6();e.j41(0,"div",57)(1,"div",31)(2,"h4",58),e.EFF(3,"Configure Parameters"),e.k0s(),e.j41(4,"div",59)(5,"div",60),e.EFF(6,"Live Preview"),e.k0s(),e.j41(7,"div",61),e.DNE(8,O,3,2,"ng-container",62),e.k0s()(),e.j41(9,"div",3)(10,"button",63),e.bIt("click",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.saveAsTemplate())}),e.nrm(11,"i",64),e.EFF(12," Save Template "),e.k0s(),e.j41(13,"button",65),e.bIt("click",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.usePrompt())}),e.DNE(14,L,3,0,"span",19)(15,z,3,0,"span",19),e.k0s()()()()}if(2&i){const t=e.XpG(2);e.R7$(8),e.Y8G("ngForOf",t.previewParts)("ngForTrackBy",t.trackByPart),e.R7$(5),e.Y8G("disabled",t.isLoading||!t.isFormValid()),e.R7$(),e.Y8G("ngIf",t.isLoading),e.R7$(),e.Y8G("ngIf",!t.isLoading)}}function K(i,a){1&i&&(e.j41(0,"div",84),e.nrm(1,"div",85),e.j41(2,"p",86),e.EFF(3,"Processing your request..."),e.k0s(),e.j41(4,"div",87),e.nrm(5,"div",88),e.k0s()())}function Q(i,a){1&i&&(e.j41(0,"div",133),e.nrm(1,"div",134),e.j41(2,"span",135),e.EFF(3,"Receiving response..."),e.k0s(),e.j41(4,"div",136),e.nrm(5,"div",137)(6,"div",138)(7,"div",139),e.k0s()())}function W(i,a){if(1&i&&(e.j41(0,"div",140)(1,"div",141),e.EFF(2),e.k0s()()),2&i){const t=e.XpG(4);e.R7$(2),e.JRh(t.getResponseMetadata())}}function q(i,a){if(1&i){const t=e.RV6();e.j41(0,"button",142),e.bIt("click",function(){const r=e.eBV(t).$implicit,s=e.XpG(4);return e.Njj(s.setRating(r))}),e.nrm(1,"i",143),e.k0s()}if(2&i){const t=a.$implicit,n=e.XpG(4);e.HbH(t<=n.currentRating?"text-yellow-400 hover:text-yellow-500":"text-gray-300 hover:text-yellow-300")}}function Z(i,a){1&i&&(e.j41(0,"span"),e.EFF(1,"Thank you! This positive feedback helps improve template accuracy."),e.k0s())}function ee(i,a){1&i&&(e.j41(0,"span"),e.EFF(1,"Thank you for the feedback. We'll work to improve this template."),e.k0s())}function te(i,a){1&i&&(e.j41(0,"span"),e.EFF(1,"Thanks for reporting this issue. We'll review and improve this template."),e.k0s())}function ne(i,a){if(1&i&&(e.j41(0,"div",144)(1,"div",145),e.nrm(2,"i",146),e.j41(3,"span",147),e.DNE(4,Z,2,0,"span",67)(5,ee,2,0,"span",67)(6,te,2,0,"span",67),e.k0s()()()),2&i){const t=e.XpG(4);e.R7$(4),e.Y8G("ngIf",t.currentRating>=4),e.R7$(),e.Y8G("ngIf",3===t.currentRating),e.R7$(),e.Y8G("ngIf",t.currentRating<=2)}}function re(i,a){if(1&i){const t=e.RV6();e.j41(0,"div",89)(1,"div",6)(2,"div",90),e.nrm(3,"i"),e.EFF(4),e.k0s(),e.j41(5,"span",5),e.EFF(6),e.k0s()(),e.j41(7,"div",91)(8,"div",92),e.EFF(9,"Request Identifiers"),e.k0s(),e.j41(10,"div",93)(11,"div",20),e.nrm(12,"i",94),e.j41(13,"div")(14,"div",5),e.EFF(15,"Message UID"),e.k0s(),e.j41(16,"div",95),e.EFF(17),e.k0s()()(),e.j41(18,"div",20),e.nrm(19,"i",96),e.j41(20,"div")(21,"div",5),e.EFF(22,"Instruction ID"),e.k0s(),e.j41(23,"div",95),e.EFF(24),e.k0s()()()()(),e.j41(25,"div",97)(26,"div",98)(27,"div",99),e.EFF(28,"Amount"),e.k0s(),e.j41(29,"div",100),e.EFF(30),e.k0s()(),e.j41(31,"div",101)(32,"div",102),e.EFF(33,"Date"),e.k0s(),e.j41(34,"div",103),e.EFF(35),e.k0s()(),e.j41(36,"div",104)(37,"div",105),e.EFF(38,"Type"),e.k0s(),e.j41(39,"div",106),e.EFF(40),e.k0s()()(),e.j41(41,"div",107)(42,"div",81)(43,"div",108),e.nrm(44,"div",109),e.DNE(45,Q,8,0,"div",110),e.k0s()(),e.DNE(46,W,3,1,"div",111),e.k0s(),e.j41(47,"div",112)(48,"button",63),e.bIt("click",function(){e.eBV(t);const r=e.XpG(3);return e.Njj(r.exportReport())}),e.nrm(49,"i",113),e.EFF(50," Export Report "),e.k0s(),e.j41(51,"button",63),e.bIt("click",function(){e.eBV(t);const r=e.XpG(3);return e.Njj(r.createTicket())}),e.nrm(52,"i",114),e.EFF(53," Create Ticket "),e.k0s(),e.j41(54,"button",63),e.bIt("click",function(){e.eBV(t);const r=e.XpG(3);return e.Njj(r.scheduleReview())}),e.nrm(55,"i",115),e.EFF(56," Schedule Review "),e.k0s(),e.j41(57,"button",63),e.bIt("click",function(){e.eBV(t);const r=e.XpG(3);return e.Njj(r.shareResults())}),e.nrm(58,"i",116),e.EFF(59," Share "),e.k0s()(),e.j41(60,"div",117)(61,"div",3)(62,"div",118)(63,"h4",119),e.EFF(64,"Rate this response"),e.k0s(),e.j41(65,"p",120),e.EFF(66,"Help improve template accuracy by rating the quality of this result"),e.k0s(),e.j41(67,"div",20)(68,"div",121),e.DNE(69,q,2,2,"button",122),e.k0s(),e.j41(70,"div",123)(71,"button",124),e.bIt("click",function(){e.eBV(t);const r=e.XpG(3);return e.Njj(r.setRating(5))}),e.nrm(72,"i",125),e.EFF(73," Correct "),e.k0s(),e.j41(74,"button",124),e.bIt("click",function(){e.eBV(t);const r=e.XpG(3);return e.Njj(r.setRating(1))}),e.nrm(75,"i",126),e.EFF(76," Incorrect "),e.k0s()(),e.j41(77,"div",127)(78,"button",124),e.bIt("click",function(){e.eBV(t);const r=e.XpG(3);return e.Njj(r.setCompletionStatus("complete"))}),e.nrm(79,"i",128),e.EFF(80," Complete "),e.k0s(),e.j41(81,"button",124),e.bIt("click",function(){e.eBV(t);const r=e.XpG(3);return e.Njj(r.setCompletionStatus("incomplete"))}),e.nrm(82,"i",129),e.EFF(83," Incomplete "),e.k0s()()(),e.DNE(84,ne,7,3,"div",130),e.k0s(),e.j41(85,"div",131)(86,"div",5),e.EFF(87,"Template Success Rate"),e.k0s(),e.j41(88,"div",132),e.EFF(89),e.k0s(),e.j41(90,"div",5),e.EFF(91),e.k0s()()()()()}if(2&i){const t=e.XpG(3);e.R7$(2),e.Y8G("ngClass",t.getStatusBadgeClass()),e.R7$(),e.HbH(t.getStatusIcon()),e.R7$(),e.SpI(" ",t.getResultStatus()," "),e.R7$(2),e.JRh(t.getCurrentDateTime()),e.R7$(11),e.JRh(t.currentMsgUid),e.R7$(7),e.JRh(t.currentInstructionId),e.R7$(6),e.Lme("",(null==t.amount?null:t.amount.toLocaleString())||"N/A"," ",t.currency,""),e.R7$(5),e.JRh(t.date||"N/A"),e.R7$(5),e.JRh(t.getCategoryLabel(t.activeCategory)),e.R7$(4),e.Y8G("innerHTML",t.getFormattedResponse(),e.npT),e.R7$(),e.Y8G("ngIf",t.isStreaming),e.R7$(),e.Y8G("ngIf",t.getResponseMetadata()),e.R7$(23),e.Y8G("ngForOf",e.lJ4(29,E))("ngForTrackBy",t.trackByIndex),e.R7$(2),e.HbH(t.currentRating>=4?"bg-green-100 text-green-700 border-green-300":"bg-gray-100 text-gray-600 border-gray-300 hover:bg-green-50"),e.R7$(3),e.HbH(t.currentRating<=2?"bg-red-100 text-red-700 border-red-300":"bg-gray-100 text-gray-600 border-gray-300 hover:bg-red-50"),e.R7$(4),e.HbH("complete"===t.completionStatus?"bg-blue-100 text-blue-700 border-blue-300":"bg-gray-100 text-gray-600 border-gray-300 hover:bg-blue-50"),e.R7$(3),e.HbH("incomplete"===t.completionStatus?"bg-orange-100 text-orange-700 border-orange-300":"bg-gray-100 text-gray-600 border-gray-300 hover:bg-orange-50"),e.R7$(3),e.Y8G("ngIf",t.currentRating>0),e.R7$(4),e.HbH(t.getSuccessRateClass(t.getCurrentTemplateSuccessRate())),e.R7$(),e.SpI(" ",t.getCurrentTemplateSuccessRate(),"% "),e.R7$(2),e.SpI("",t.getCurrentTemplateUsageCount()," total uses")}}function ie(i,a){if(1&i){const t=e.RV6();e.j41(0,"div",77,0)(2,"div",30)(3,"div",78)(4,"div")(5,"h3",32),e.EFF(6,"Results"),e.k0s(),e.j41(7,"p",33),e.EFF(8),e.k0s()(),e.j41(9,"div",20)(10,"button",79),e.bIt("click",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.clearResults())}),e.nrm(11,"i",80),e.EFF(12," Clear Results "),e.k0s()()(),e.j41(13,"div",81),e.DNE(14,K,6,0,"div",82)(15,re,92,30,"div",83),e.k0s()()()}if(2&i){const t=e.XpG(2);e.R7$(8),e.JRh(t.lastQuery),e.R7$(6),e.Y8G("ngIf",t.isLoading),e.R7$(),e.Y8G("ngIf",!t.isLoading&&t.apiResponse)}}function se(i,a){if(1&i&&(e.j41(0,"div",156)(1,"div",121),e.nrm(2,"i",157),e.j41(3,"span",158),e.EFF(4),e.k0s()(),e.j41(5,"div",121),e.nrm(6,"i",159),e.j41(7,"span",158),e.EFF(8),e.k0s()()()),2&i){const t=e.XpG().$implicit;e.R7$(4),e.JRh(t.msgUid),e.R7$(4),e.JRh(t.instructionId||"N/A")}}function oe(i,a){if(1&i){const t=e.RV6();e.j41(0,"div",151),e.bIt("click",function(){const r=e.eBV(t).$implicit,s=e.XpG(3);return e.Njj(s.loadHistoryItem(r))}),e.j41(1,"div",152)(2,"div",118)(3,"div",51),e.EFF(4),e.k0s(),e.j41(5,"div",153),e.EFF(6),e.k0s(),e.DNE(7,se,9,2,"div",154),e.k0s(),e.j41(8,"div",20)(9,"span",155),e.EFF(10),e.k0s()()()()}if(2&i){const t=a.$implicit,n=e.XpG(3);e.R7$(4),e.JRh(t.query),e.R7$(2),e.JRh(n.formatDate(t.timestamp)),e.R7$(),e.Y8G("ngIf",t.msgUid),e.R7$(2),e.Y8G("ngClass",n.getHistoryStatusClass(t.status)),e.R7$(),e.SpI(" ",t.status," ")}}function ae(i,a){if(1&i){const t=e.RV6();e.j41(0,"div",148)(1,"div",149)(2,"h3",32),e.EFF(3,"Query History"),e.k0s(),e.j41(4,"button",79),e.bIt("click",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.toggleHistory())}),e.nrm(5,"i",80),e.k0s()(),e.j41(6,"div",30),e.DNE(7,oe,11,5,"div",150),e.k0s()()}if(2&i){const t=e.XpG(2);e.R7$(7),e.Y8G("ngForOf",t.queryHistory)}}function ce(i,a){if(1&i){const t=e.RV6();e.j41(0,"div",15)(1,"div",16),e.DNE(2,$,4,3,"button",17),e.k0s(),e.j41(3,"div",18),e.DNE(4,N,5,1,"div",19),e.j41(5,"div",6)(6,"div",20)(7,"label",21),e.EFF(8,"Type:"),e.k0s(),e.j41(9,"select",22),e.mxI("ngModelChange",function(r){e.eBV(t);const s=e.XpG();return e.DH7(s.activeCategory,r)||(s.activeCategory=r),e.Njj(r)}),e.bIt("change",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.onCategorySelect(r.activeCategory))}),e.DNE(10,D,2,3,"option",23),e.k0s()(),e.j41(11,"div",20)(12,"label",21),e.EFF(13,"Style:"),e.k0s(),e.j41(14,"select",24),e.mxI("ngModelChange",function(r){e.eBV(t);const s=e.XpG();return e.DH7(s.promptStyle,r)||(s.promptStyle=r),e.Njj(r)}),e.j41(15,"option",25),e.EFF(16,"Basic"),e.k0s(),e.j41(17,"option",26),e.EFF(18,"Conversational"),e.k0s(),e.j41(19,"option",27),e.EFF(20,"Scenario-based"),e.k0s(),e.j41(21,"option",28),e.EFF(22,"Comparative"),e.k0s()()()()(),e.j41(23,"div",29)(24,"div",30)(25,"div",31)(26,"h3",32),e.EFF(27,"Select Template"),e.k0s(),e.j41(28,"p",33),e.EFF(29),e.k0s()(),e.j41(30,"div",34),e.DNE(31,V,15,7,"label",35),e.k0s()(),e.DNE(32,J,16,5,"div",36),e.k0s(),e.DNE(33,ie,16,3,"div",37)(34,ae,8,1,"div",38),e.k0s()}if(2&i){const t=e.XpG();e.R7$(2),e.Y8G("ngForOf",t.instructionTypes)("ngForTrackBy",t.trackByKey),e.R7$(2),e.Y8G("ngIf",t.recentTemplates.length>0),e.R7$(5),e.R50("ngModel",t.activeCategory),e.R7$(),e.Y8G("ngForOf",t.getCurrentCategories())("ngForTrackBy",t.trackByKey),e.R7$(4),e.R50("ngModel",t.promptStyle),e.R7$(15),e.SpI("Choose a template for ",t.getCategoryLabel(t.activeCategory),""),e.R7$(2),e.Y8G("ngForOf",t.currentPrompts)("ngForTrackBy",t.trackByIndex),e.R7$(),e.Y8G("ngIf",t.selectedPromptIndex>=0),e.R7$(),e.Y8G("ngIf",t.showResults),e.R7$(),e.Y8G("ngIf",t.showHistory)}}function le(i,a){if(1&i){const t=e.RV6();e.j41(0,"div",168)(1,"div",169)(2,"div",170)(3,"span",171),e.EFF(4,"Prompt ready:"),e.k0s(),e.j41(5,"span",172),e.EFF(6),e.k0s()(),e.j41(7,"button",173),e.bIt("click",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.copyPrompt())}),e.nrm(8,"i",174),e.j41(9,"span"),e.EFF(10),e.k0s()(),e.j41(11,"button",175),e.bIt("click",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.sendPromptToIframe())}),e.nrm(12,"i",76),e.j41(13,"span"),e.EFF(14,"Send"),e.k0s()(),e.j41(15,"button",176),e.bIt("click",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.minimizePromptToast())}),e.nrm(16,"i",177),e.k0s(),e.j41(17,"button",178),e.bIt("click",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.dismissPromptToast())}),e.nrm(18,"i",80),e.k0s()()()}if(2&i){const t=e.XpG(2);e.R7$(6),e.JRh(t.incomingPrompt),e.R7$(4),e.JRh(t.copied?"Copied":"Copy")}}function pe(i,a){if(1&i){const t=e.RV6();e.j41(0,"div",179)(1,"div",180),e.nrm(2,"i",181),e.j41(3,"span",182),e.EFF(4,"Prompt ready"),e.k0s(),e.j41(5,"button",183),e.bIt("click",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.copyPrompt())}),e.nrm(6,"i",184),e.k0s(),e.j41(7,"button",185),e.bIt("click",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.expandPromptToast())}),e.nrm(8,"i",186),e.k0s(),e.j41(9,"button",178),e.bIt("click",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.dismissPromptToast())}),e.nrm(10,"i",80),e.k0s()()()}}function de(i,a){1&i&&(e.j41(0,"div",187)(1,"div",188),e.nrm(2,"div",189)(3,"div",190)(4,"div",191),e.k0s()())}function ue(i,a){1&i&&(e.j41(0,"div",192)(1,"div",193)(2,"div",194),e.EFF(3,"Unable to load embedded agent"),e.k0s(),e.j41(4,"div"),e.EFF(5,"It may be blocked by the site's embed policy (X-Frame-Options/CSP)."),e.k0s()()())}function me(i,a){if(1&i){const t=e.RV6();e.j41(0,"div",160)(1,"div",161),e.DNE(2,le,19,2,"div",162)(3,pe,11,0,"div",163)(4,de,5,0,"div",164)(5,ue,6,0,"div",165),e.j41(6,"div",166)(7,"iframe",167,1),e.bIt("load",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.onIframeLoad())}),e.k0s()()()()}if(2&i){const t=e.XpG();e.R7$(2),e.Y8G("ngIf",t.incomingPrompt&&t.showPromptToast&&!t.isMinimized),e.R7$(),e.Y8G("ngIf",t.incomingPrompt&&t.showPromptToast&&t.isMinimized),e.R7$(),e.Y8G("ngIf",!t.iframeLoaded&&!t.loadNotice),e.R7$(),e.Y8G("ngIf",t.loadNotice&&!t.iframeLoaded),e.R7$(2),e.AVh("opacity-0",!t.iframeLoaded),e.Y8G("src",t.agentUrlSafe,e.f$h)}}let ge=(()=>{class i{constructor(t,n,r,s){this.sanitizer=t,this.http=n,this.currencyService=r,this.hawkAgentService=s,this.isAgentMode=!1,this.showResults=!1,this.isLoading=!1,this.isStreaming=!1,this.apiResponse="",this.lastQuery="",this.currentMsgUid="",this.currentInstructionId="",this.completionStatus=null,this.msgUidCounter=21,this.instructionIdCounter=21,this.streamBuffer="",this.recentTemplates=[],this.queryHistory=[],this.showHistory=!1,this.currentRating=0,this.hasRated=!1,this.iframeLoaded=!1,this.agentUrl=C,this.agentOrigin=P,this.loadNotice=!1,this.incomingPrompt=null,this.copied=!1,this.showPromptToast=!1,this.isMinimized=!1,this.onMessage=o=>{},this.previewParts=[],this.currentPrompts=[],this.instructionTypes=[{key:"instructions",label:"Instructions & Processing",count:16},{key:"monitoring",label:"Monitoring & Status",count:12},{key:"risk",label:"Risk & Compliance",count:8},{key:"analysis",label:"Analysis & Reporting",count:10},{key:"resolution",label:"Problem Resolution",count:6},{key:"setup",label:"Configuration & Setup",count:4}],this.activeInstructionType="instructions",this.categories=[{key:"utilisation",label:"Utilisation Check",count:4,instructionType:"instructions"},{key:"inception",label:"Inception",count:4,instructionType:"instructions"},{key:"rollover",label:"Rollover",count:4,instructionType:"instructions"},{key:"termination",label:"Termination",count:4,instructionType:"instructions"},{key:"status",label:"Status Check",count:3,instructionType:"monitoring"},{key:"health",label:"Health Monitoring",count:4,instructionType:"monitoring"},{key:"alerts",label:"Alert Management",count:5,instructionType:"monitoring"},{key:"compliance",label:"Compliance Check",count:4,instructionType:"risk"},{key:"validation",label:"Risk Validation",count:4,instructionType:"risk"},{key:"reports",label:"Generate Reports",count:5,instructionType:"analysis"},{key:"metrics",label:"Performance Metrics",count:5,instructionType:"analysis"},{key:"troubleshoot",label:"Troubleshooting",count:3,instructionType:"resolution"},{key:"recovery",label:"Error Recovery",count:3,instructionType:"resolution"},{key:"config",label:"Configuration",count:2,instructionType:"setup"},{key:"setup",label:"Initial Setup",count:2,instructionType:"setup"}],this.activeCategory="utilisation",this.promptStyle="basic",this.promptsMap={utilisation:[{template:"Verify if we can utilise [amount] [currency] hedge for [date]. Perform Utilisation Check.",usageCount:156,successRate:95},{template:"Validate capacity to utilise [amount] [currency] hedge as of [date]. Perform Utilisation Check.",usageCount:142,successRate:92},{template:"Check hedging availability for [amount] [currency] across entity scope as of [date]. Perform Utilisation Check.",usageCount:89,successRate:88},{template:"Confirm if [amount] [currency] hedge can be processed across subsidiary entities for [date]. Perform Utilisation Check.",usageCount:67,successRate:91}],inception:[{template:"Create a new hedge instruction of [amount] [currency] starting [date]. Perform Inception.",usageCount:203,successRate:97},{template:"Validate and book [amount] [currency] hedge effective [date]. Perform Inception.",usageCount:178,successRate:94},{template:"Initiate hedge inception for [amount] [currency] across entity scope on [date]. Perform Inception.",usageCount:134,successRate:96},{template:"Initiate hedge inception for [amount] [currency] at subsidiary level on [date]. Perform Inception.",usageCount:98,successRate:93}],rollover:[{template:"Verify rollover of [amount] [currency] hedge as of [date]. Perform Rollover.",usageCount:187,successRate:89},{template:"Extend maturity and rollover [amount] [currency] hedge to [date]. Perform Rollover.",usageCount:165,successRate:87},{template:"Check if [amount] [currency] hedge can be rolled over for entity scope on [date]. Perform Rollover.",usageCount:123,successRate:90},{template:"Process rollover of [amount] [currency] hedge at subsidiary level for [date]. Perform Rollover.",usageCount:87,successRate:85}],termination:[{template:"Verify termination of [amount] [currency] hedge as of [date]. Perform Termination.",usageCount:145,successRate:92},{template:"Validate closure of [amount] [currency] hedge effective [date]. Perform Termination.",usageCount:132,successRate:94},{template:"Terminate [amount] [currency] hedge across entity scope on [date]. Perform Termination.",usageCount:98,successRate:91},{template:"Confirm hedge termination of [amount] [currency] at subsidiary level for [date]. Perform Termination.",usageCount:76,successRate:89}],status:[{template:"Check current status of [amount] [currency] hedge for [date]. Perform Status Check.",usageCount:89,successRate:96},{template:"Retrieve hedge status across all entities for [date]. Perform Status Check.",usageCount:67,successRate:94},{template:"Validate hedge processing status for [amount] [currency]. Perform Status Check.",usageCount:45,successRate:92}],health:[{template:"Perform health check on hedge systems for [date]. Perform Health Monitoring.",usageCount:78,successRate:98},{template:"Monitor system health across all hedge operations. Perform Health Monitoring.",usageCount:65,successRate:97},{template:"Check hedge infrastructure health and performance. Perform Health Monitoring.",usageCount:54,successRate:95},{template:"Validate system connectivity and data integrity. Perform Health Monitoring.",usageCount:43,successRate:99}],alerts:[{template:"Check active alerts for hedge operations on [date]. Perform Alert Management.",usageCount:123,successRate:91},{template:"Review critical alerts for [amount] [currency] positions. Perform Alert Management.",usageCount:98,successRate:89},{template:"Validate alert configurations and thresholds. Perform Alert Management.",usageCount:87,successRate:93},{template:"Process and acknowledge pending alerts. Perform Alert Management.",usageCount:76,successRate:95},{template:"Generate alert summary report for [date]. Perform Alert Management.",usageCount:54,successRate:97}]},this.selectedPromptIndex=0,this.currencies=[],this.currency="SGD",this.amount=null,this.date=(new Date).toISOString().split("T")[0],this.scopes=["Branch","Subsidiary","Associate","TMU"],this.subsidiaryLevels=["Entity","Subsidiary","Branch"],this.riskFactors=["FX Rate","Interest Rate","Commodity","Equity"],this.genericOptions=["Option A","Option B","Option C"],this.placeholderValues={},this.trackByIndex=(o,c)=>o,this.trackByKey=(o,c)=>c.key,this.trackByPart=(o,c)=>c.type+":"+(c.text??c.name??o)}generateMsgUID(){const n=`MSG_UID_${this.msgUidCounter.toString().padStart(4,"0")}`;return this.msgUidCounter++,n}generateInstructionId(){const n=`INST${this.instructionIdCounter.toString().padStart(4,"0")}`;return this.instructionIdCounter++,n}initializeCounters(){const t=localStorage.getItem("msgUidCounter"),n=localStorage.getItem("instructionIdCounter");this.msgUidCounter=t?parseInt(t):21,this.instructionIdCounter=n?parseInt(n):21}saveCounters(){localStorage.setItem("msgUidCounter",this.msgUidCounter.toString()),localStorage.setItem("instructionIdCounter",this.instructionIdCounter.toString())}resetIdCounters(t=21,n=21){this.msgUidCounter=t,this.instructionIdCounter=n,this.saveCounters(),console.log(`ID counters reset: MSG_UID starts at ${t}, INST starts at ${n}`)}ngOnInit(){this.initializeCounters(),this.loadCurrencies(),this.refreshPromptsForCategory(),this.initPlaceholdersForSelectedPrompt(),this.buildPreviewParts(),this.agentUrlSafe=this.sanitizer.bypassSecurityTrustResourceUrl(this.agentUrl),window.addEventListener("message",this.onMessage);const t=history?.state||{};t&&"string"==typeof t.presetPrompt&&t.presetPrompt.trim()&&(this.incomingPrompt=t.presetPrompt.trim(),this.showPromptToast=!0,this.isAgentMode=!0),this.noticeTimer=setTimeout(()=>{!this.iframeLoaded&&this.isAgentMode&&(this.loadNotice=!0)},4e3)}ngOnDestroy(){if(window.removeEventListener("message",this.onMessage),this.noticeTimer&&clearTimeout(this.noticeTimer),this.reader&&!this.reader.closed){try{this.reader.cancel()}catch(t){console.warn("Reader cleanup error:",t)}this.reader=void 0}this.isStreaming=!1}loadCurrencies(){this.currencyService.getCurrencyCodes().subscribe({next:t=>{this.currencies=t,t.includes("SGD")?this.currency="SGD":t.length>0&&(this.currency=t[0])},error:t=>{console.error("Error loading currencies:",t),this.currencies=["USD","EUR","GBP","JPY","SGD","AUD"]}})}refreshPromptsForCategory(){this.currentPrompts=this.promptsMap[this.activeCategory]||[],this.calculateRealUsageStats()}get selectedPromptBase(){return this.currentPrompts[this.selectedPromptIndex]?.template||""}selectPrompt(t){this.selectedPromptIndex=t,this.initPlaceholdersForSelectedPrompt(!0),this.buildPreviewParts()}selectFirstPrompt(){this.selectedPromptIndex=0,this.initPlaceholdersForSelectedPrompt(!0),this.buildPreviewParts()}buildPreviewParts(){const t=this.selectedPromptBase,n=/\[([^\]]+)\]/g,r=[];let o,s=0;for(;null!==(o=n.exec(t));){o.index>s&&r.push({type:"text",text:t.slice(s,o.index)});const c=o[1].trim().toLowerCase();r.push({type:"placeholder",name:c}),s=n.lastIndex}s<t.length&&r.push({type:"text",text:t.slice(s)}),this.previewParts=r}getOptionsFor(t){switch(t){case"currency":return this.currencies;case"entity scope":case"scope":return this.scopes;case"subsidiary level":return this.subsidiaryLevels;case"risk factor":return this.riskFactors;default:return this.genericOptions}}initPlaceholdersForSelectedPrompt(t=!1){const n=this.selectedPromptBase,r=/\[([^\]]+)\]/g,s={};let o;for(;null!==(o=r.exec(n));){const c=o[1].trim().toLowerCase();if(s[c]=!0,"amount"!==c&&!this.placeholderValues[c]){const d=this.getOptionsFor(c);this.placeholderValues[c]=d[0]??""}}t&&Object.keys(this.placeholderValues).forEach(c=>{"amount"!==c&&!s[c]&&delete this.placeholderValues[c]})}usePrompt(){const t=this.previewParts.map(n=>"text"===n.type?n.text:"amount"===n.name?(this.amount??0).toFixed(2):"date"===n.name?this.date:this.placeholderValues[n.name]??"").join("");this.currentMsgUid=this.generateMsgUID(),this.currentInstructionId=this.generateInstructionId(),this.saveCounters(),this.createDatabaseSession(t),this.lastQuery=t,this.showResults=!0,this.isLoading=!0,this.apiResponse="",this.scrollToResults(),this.currentRating=0,this.hasRated=!1,this.updateUsageCount(),this.addToRecentTemplates(),this.sendToDifyAgent(t)}createDatabaseSession(t){var n=this;return(0,_.A)(function*(){try{console.log("Creating database session with:",{promptText:t,msgUid:n.currentMsgUid,instructionId:n.currentInstructionId}),yield n.hawkAgentService.createSession(t,n.currentMsgUid,n.currentInstructionId),console.log("Database session created successfully")}catch(r){console.error("Error creating database session:",r)}})()}updateDatabaseSession(t,n,r,s){var o=this;return(0,_.A)(function*(){try{console.log("Updating database session:",{msgUid:o.currentMsgUid,status:t,conversationId:n,taskId:r,tokenUsage:s});const c={agent_status:t,agent_response:{text:o.apiResponse,conversation_id:n,task_id:r,...s&&{input_tokens:s.input_tokens||s.prompt_tokens||0,output_tokens:s.output_tokens||s.completion_tokens||0,total_tokens:s.total_tokens||(s.input_tokens||s.prompt_tokens||0)+(s.output_tokens||s.completion_tokens||0),usage:s}}};yield o.hawkAgentService.updateSession(o.currentMsgUid,c),console.log("Database session updated successfully")}catch(c){console.error("Error updating database session:",c)}})()}sendToDifyAgent(t){new b.Lr({Authorization:"Bearer app-KKtaMynVyn8tKbdV9VbbaeyR","Content-Type":"application/json"});const s={conversation_id:"",inputs:{msg_uid:this.currentMsgUid,instruction_id:this.currentInstructionId},query:`[MSG_UID: ${this.currentMsgUid}] [INSTRUCTION_ID: ${this.currentInstructionId}] ${t}`,user:"test-user",response_mode:"streaming"};this.streamBuffer="",this.apiResponse="",this.isStreaming=!0,fetch("https://api.dify.ai/v1/chat-messages",{method:"POST",headers:{Authorization:"Bearer app-KKtaMynVyn8tKbdV9VbbaeyR","Content-Type":"application/json"},body:JSON.stringify(s)}).then(o=>{if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);if(!o.body)throw new Error("Response body is null");this.isLoading=!1;const c=o.body.getReader();return this.reader=c,this.processStream(c)}).catch(o=>{console.error("Error sending to Dify:",o),this.isLoading=!1,this.isStreaming=!1,this.apiResponse=`Error: ${o.message}\n\nPlease check your network connection and API configuration.`})}processStream(t){var n=this;return(0,_.A)(function*(){const r=new TextDecoder;let s="",o="",c="",d=null;try{for(;;){const{done:h,value:u}=yield t.read();if(h){console.log("Stream completed"),n.isStreaming=!1,n.finishStream(s,o,d);break}c+=r.decode(u,{stream:!0});const g=c.split("\n");c=g.pop()||"";for(const y of g)if(y.startsWith("data: "))try{const l=JSON.parse(y.substring(6));if(!s&&l.conversation_id&&(s=l.conversation_id),!o&&l.task_id&&(o=l.task_id),"agent_message"===l.event&&l.answer&&(n.streamBuffer+=l.answer,n.apiResponse=n.streamBuffer),(l.metadata?.usage||l.usage)&&(d=l.metadata?.usage||l.usage,console.log("Token usage captured:",d)),"message_end"===l.event||"workflow_finished"===l.event)return console.log("Stream end event received:",l.event),console.log("Final token usage:",d),n.isStreaming=!1,void n.finishStream(s,o,d)}catch(l){console.warn("Failed to parse streaming data line:",y,l)}}}catch(h){console.error("Stream processing error:",h),n.isStreaming=!1,n.apiResponse+="\n\n[Stream interrupted due to error]",n.updateDatabaseSession("failed",s,o,d)}finally{t.releaseLock()}})()}finishStream(t,n,r){let s="\n\n---\n";s+=`Message UID: ${this.currentMsgUid}\n`,s+=`Instruction ID: ${this.currentInstructionId}\n`,t&&(s+=`Conversation ID: ${t}\n`),n&&(s+=`Task ID: ${n}`),r&&(s+=`\nInput Tokens: ${r.input_tokens||r.prompt_tokens||0}`,s+=`\nOutput Tokens: ${r.output_tokens||r.completion_tokens||0}`,s+=`\nTotal Tokens: ${r.total_tokens||(r.input_tokens||r.prompt_tokens||0)+(r.output_tokens||r.completion_tokens||0)}`),this.apiResponse+=s,this.updateDatabaseSession("completed",t,n,r),this.addToHistory(this.lastQuery,this.apiResponse)}clearResults(){if(this.showResults=!1,this.apiResponse="",this.lastQuery="",this.currentMsgUid="",this.currentInstructionId="",this.isLoading=!1,this.isStreaming=!1,this.streamBuffer="",this.currentRating=0,this.hasRated=!1,this.reader&&!this.reader.closed){try{this.reader.cancel()}catch(t){console.warn("Reader cleanup error in clearResults:",t)}this.reader=void 0}}getCleanResponse(){return this.apiResponse?this.apiResponse.split("\n\n---\n")[0]||this.apiResponse:""}getFormattedResponse(){if(!this.apiResponse)return this.sanitizer.bypassSecurityTrustHtml("");const r=this.getCleanResponse().replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/&lt;strong&gt;(.*?)&lt;\/strong&gt;/g,"<strong>$1</strong>").replace(/\n/g,"<br>");return this.sanitizer.bypassSecurityTrustHtml(r)}getResponseMetadata(){if(!this.apiResponse)return"";const t=this.apiResponse.split("\n\n---\n");return t.length>1?t[1].trim():""}getCategoryLabel(t){const n=this.categories.find(r=>r.key===t);return n?n.label:t}isFormValid(){const t=this.previewParts.filter(o=>"placeholder"===o.type),n=!t.some(o=>"amount"===o.name)||null!==this.amount&&this.amount>0,r=!t.some(o=>"date"===o.name)||!!this.date,s=t.filter(o=>"amount"!==o.name&&"date"!==o.name).every(o=>this.placeholderValues[o.name]);return n&&r&&s}getPlaceholderParts(){return this.previewParts.filter(t=>"placeholder"===t.type)}getCurrentDateTime(){return(new Date).toLocaleString()}formatDate(t){return t.toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}getResultStatus(){if(!this.apiResponse)return"Processing";const t=this.getCleanResponse().toLowerCase();return t.includes("approved")||t.includes("confirmed")?"Approved":t.includes("rejected")||t.includes("denied")?"Rejected":t.includes("pending")||t.includes("review")?"Pending Review":"Completed"}getStatusBadgeClass(){switch(this.getResultStatus()){case"Approved":return"bg-green-100 text-green-800 border border-green-200";case"Rejected":return"bg-red-100 text-red-800 border border-red-200";case"Pending Review":return"bg-yellow-100 text-yellow-800 border border-yellow-200";default:return"bg-blue-100 text-blue-800 border border-blue-200"}}getStatusIcon(){switch(this.getResultStatus()){case"Approved":return"pi pi-check-circle";case"Rejected":return"pi pi-times-circle";case"Pending Review":return"pi pi-clock";default:return"pi pi-info-circle"}}addToRecentTemplates(){const t={label:`Template ${this.selectedPromptIndex+1}`,category:this.activeCategory,index:this.selectedPromptIndex};this.recentTemplates=this.recentTemplates.filter(n=>!(n.category===t.category&&n.index===t.index)),this.recentTemplates.unshift(t),this.recentTemplates=this.recentTemplates.slice(0,5)}loadRecentTemplate(t){this.activeCategory=t.category,this.refreshPromptsForCategory(),this.selectedPromptIndex=t.index,this.selectPrompt(t.index)}addToHistory(t,n){const r={query:t,response:n,timestamp:new Date,status:this.getResultStatus(),msgUid:this.currentMsgUid,instructionId:this.currentInstructionId};this.queryHistory.unshift(r),this.queryHistory=this.queryHistory.slice(0,20)}toggleHistory(){this.showHistory=!this.showHistory}loadHistoryItem(t){this.lastQuery=t.query,this.apiResponse=t.response,this.currentMsgUid=t.msgUid||"",this.currentInstructionId=t.instructionId||"",this.showResults=!0,this.showHistory=!1}getHistoryStatusClass(t){switch(t){case"Approved":return"bg-green-100 text-green-800";case"Rejected":return"bg-red-100 text-red-800";case"Pending Review":return"bg-yellow-100 text-yellow-800";default:return"bg-blue-100 text-blue-800"}}saveAsTemplate(){console.log("Save template clicked")}exportReport(){console.log("Export report clicked")}createTicket(){console.log("Create ticket clicked")}scheduleReview(){console.log("Schedule review clicked")}shareResults(){console.log("Share results clicked")}setCompletionStatus(t){var n=this;return(0,_.A)(function*(){n.completionStatus=t;try{if(n.currentMsgUid&&n.currentInstructionId){if((yield n.hawkAgentService.getSessions()).find(o=>o.msg_uid===n.currentMsgUid)){const o="complete"===t?"completed":"failed";(new Date).toISOString(),console.log(`Task marked as ${t}, agent_status updated to ${o}`),n.updateTemplateMetricsFromCompletion(t)}}yield n.calculateRealUsageStats()}catch(r){console.error("Error saving completion status:",r)}})()}updateTemplateMetricsFromCompletion(t){if(this.selectedPromptIndex>=0&&this.currentPrompts[this.selectedPromptIndex]){const n=this.currentPrompts[this.selectedPromptIndex],r="complete"===t,o=Math.round(n.successRate*n.usageCount/100)+(r?1:0),c=n.usageCount+1;n.successRate=Math.round(o/c*100),n.usageCount=c,this.updateMasterTemplateData("both")}}setRating(t){this.currentRating=t,this.hasRated||(this.hasRated=!0,this.updateSuccessRate(t))}updateUsageCount(){this.selectedPromptIndex>=0&&this.currentPrompts[this.selectedPromptIndex]&&(this.currentPrompts[this.selectedPromptIndex].usageCount++,this.updateMasterTemplateData("usage"))}updateSuccessRate(t){if(this.selectedPromptIndex>=0&&this.currentPrompts[this.selectedPromptIndex]){const n=this.currentPrompts[this.selectedPromptIndex],c=Math.round((n.usageCount*n.successRate/100+(t>=4?1:0))/n.usageCount*100);n.successRate=c,this.updateMasterTemplateData("success")}}updateMasterTemplateData(t){if(this.selectedPromptIndex>=0){const n=this.currentPrompts[this.selectedPromptIndex];n&&(this.promptsMap[this.activeCategory][this.selectedPromptIndex]={...n})}}getCurrentTemplateSuccessRate(){return this.selectedPromptIndex>=0&&this.currentPrompts[this.selectedPromptIndex]?this.currentPrompts[this.selectedPromptIndex].successRate:0}getCurrentTemplateUsageCount(){return this.selectedPromptIndex>=0&&this.currentPrompts[this.selectedPromptIndex]?this.currentPrompts[this.selectedPromptIndex].usageCount:0}scrollToResults(){setTimeout(()=>{const t=this.resultsSectionRef?.nativeElement;t&&(t.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),setTimeout(()=>{try{const n=t.getBoundingClientRect(),r=window.scrollY+n.top-100;window.scrollTo({top:r,behavior:"smooth"})}catch{t.scrollIntoView()}},50))},300)}onInstructionTypeSelect(t){if(this.activeInstructionType===t)return;this.activeInstructionType=t;const n=this.categories.find(r=>r.instructionType===t);n&&(this.activeCategory=n.key,this.refreshPromptsForCategory(),this.selectFirstPrompt())}onCategorySelect(t){this.activeCategory!==t&&(this.activeCategory=t,this.refreshPromptsForCategory(),this.selectFirstPrompt())}getCurrentCategories(){return this.categories.filter(t=>t.instructionType===this.activeInstructionType)}getSuccessRateClass(t){return t>=95?"text-green-600":t>=90?"text-blue-600":t>=85?"text-yellow-600":"text-red-600"}formatUsageCount(t){return t>=1e3?Math.floor(t/1e3)+"K":t.toString()}calculateRealUsageStats(){var t=this;return(0,_.A)(function*(){try{const n=yield t.hawkAgentService.getSessions();console.log("All sessions from database:",n),t.currentPrompts.forEach((r,s)=>{const o=n.filter(u=>{const f=u.template_category===t.activeCategory,g=u.template_index===s+1;return console.log(`Template ${s+1}: category=${t.activeCategory}, session_category=${u.template_category}, session_template_index=${u.template_index}, matches=${f&&g}`),f&&g});console.log(`Template ${s+1} (${t.activeCategory}) - Found ${o.length} matching sessions`);const c=o.length,d=o.filter(u=>{const f="completed"===u.agent_status;return!("complete"!==u.metadata?.completion_status)||!("incomplete"===u.metadata?.completion_status)&&f}),h=c>0?Math.round(d.length/c*100):0;console.log(`Template ${s+1}: usageCount=${c}, successfulSessions=${d.length}, successRate=${h}%`),r.usageCount=c,r.successRate=h}),t.promptsMap[t.activeCategory]=[...t.currentPrompts],console.log("Updated promptsMap for category:",t.activeCategory,t.currentPrompts)}catch(n){console.error("Error calculating usage stats:",n)}})()}onPlaceholderChange(t,n){this.placeholderValues[t]=n}onIframeLoad(){this.iframeLoaded=!0,this.loadNotice=!1}dismissPromptToast(){this.showPromptToast=!1}minimizePromptToast(){this.isMinimized=!0}expandPromptToast(){this.isMinimized=!1}copyPrompt(){var t=this;return(0,_.A)(function*(){if(t.incomingPrompt)try{yield navigator.clipboard?.writeText(t.incomingPrompt),t.copied=!0,setTimeout(()=>t.copied=!1,1500)}catch{}})()}sendPromptToIframe(){if(!this.incomingPrompt)return;const t=this.agentFrameRef?.nativeElement?.contentWindow;if(!t)return;const n=[{type:"preset_input",text:this.incomingPrompt},{type:"set_input",text:this.incomingPrompt},{type:"prefill",text:this.incomingPrompt},{type:"init_message",text:this.incomingPrompt},{event:"set_input",value:this.incomingPrompt}];try{const r="*"===this.agentOrigin?"*":this.agentOrigin;for(const s of n)t.postMessage(s,r)}catch{}}static{this.\u0275fac=function(n){return new(n||i)(e.rXU(F.up),e.rXU(b.Qq),e.rXU(j),e.rXU(w.G))}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["app-hawk-prompt-templates"]],viewQuery:function(n,r){if(1&n&&(e.GBs(S,5),e.GBs(M,5)),2&n){let s;e.mGM(s=e.lsd())&&(r.agentFrameRef=s.first),e.mGM(s=e.lsd())&&(r.resultsSectionRef=s.first)}},standalone:!0,features:[e.aNF],decls:19,vars:10,consts:[["resultsSection",""],["agentFrame",""],[1,"p-6","space-y-4","min-h-full","flex","flex-col"],[1,"flex","items-center","justify-between"],[1,"text-xl","font-semibold","text-gray-900"],[1,"text-xs","text-gray-500"],[1,"flex","items-center","gap-3"],[1,"text-sm","text-gray-600"],[1,"inline-flex","items-center","cursor-pointer"],["type","checkbox",1,"sr-only",3,"ngModelChange","ngModel"],[1,"relative"],[1,"w-11","h-6","bg-gray-200","rounded-full","shadow-inner"],[1,"absolute","w-4","h-4","bg-white","rounded-full","shadow","inset-y-1","left-1","transition-transform","duration-200"],["class","space-y-6 max-w-full overflow-hidden flex-1 flex flex-col",4,"ngIf"],["class","space-y-6 flex-1 flex flex-col min-h-0",4,"ngIf"],[1,"space-y-6","max-w-full","overflow-hidden","flex-1","flex","flex-col"],[1,"p-2","flex","flex-wrap","gap-2"],["class","px-3 py-1.5 rounded-md text-sm transition-colors",3,"ngClass","click",4,"ngFor","ngForOf","ngForTrackBy"],[1,"flex","flex-col","sm:flex-row","gap-4","items-start","sm:items-center","justify-between"],["class","flex items-center gap-2",4,"ngIf"],[1,"flex","items-center","gap-2"],[1,"text-sm","font-medium","text-gray-700"],[1,"filter-input",2,"width","175px",3,"ngModelChange","change","ngModel"],[3,"value",4,"ngFor","ngForOf","ngForTrackBy"],[1,"filter-input","w-36",3,"ngModelChange","ngModel"],["value","basic"],["value","conversational"],["value","scenario"],["value","comparative"],[1,"bg-white","rounded-xl","shadow-sm","border","border-gray-200","overflow-hidden"],[1,"divide-y","divide-gray-100"],[1,"px-6","py-4"],[1,"text-lg","font-semibold","text-gray-900"],[1,"text-sm","text-gray-600","mt-1"],[1,"divide-y","divide-gray-50"],["class","flex items-center gap-4 px-6 py-4 cursor-pointer hover:bg-gray-50 transition-colors",4,"ngFor","ngForOf","ngForTrackBy"],["class","border-t border-gray-200 bg-gray-50",4,"ngIf"],["class","bg-white rounded-xl shadow-sm border border-gray-200 mt-6 w-full max-w-none overflow-hidden flex-shrink-0",4,"ngIf"],["class","bg-white rounded-xl shadow-sm border border-gray-200 mt-6",4,"ngIf"],[1,"px-3","py-1.5","rounded-md","text-sm","transition-colors",3,"click","ngClass"],[1,"text-xs","opacity-75"],[1,"text-xs","font-medium","text-gray-500","uppercase","tracking-wide"],[1,"flex","gap-2"],["class","px-2 py-1 text-xs bg-gray-100 hover:bg-gray-200 rounded-md text-gray-700 transition-colors",3,"click",4,"ngFor","ngForOf"],[1,"px-2","py-1","text-xs","bg-gray-100","hover:bg-gray-200","rounded-md","text-gray-700","transition-colors",3,"click"],[3,"value"],[1,"flex","items-center","gap-4","px-6","py-4","cursor-pointer","hover:bg-gray-50","transition-colors"],[1,"flex","items-center","justify-center"],["type","radio","name","prompt",1,"text-blue-600",3,"change","checked"],[1,"flex","items-center","gap-4","flex-1","min-w-0"],[1,"w-20","flex-shrink-0","text-center"],[1,"text-sm","font-medium","text-gray-900"],[1,"flex-1","min-w-0"],[1,"text-sm","text-gray-700","leading-relaxed"],[1,"w-24","flex-shrink-0","flex","items-center","justify-center","gap-2"],[1,"flex","items-center","justify-center","w-8","h-8","rounded-full","text-xs","font-medium","text-gray-700","bg-blue-100",3,"title"],[1,"flex","items-center","justify-center","w-8","h-8","rounded-full","text-xs","font-medium","text-gray-700","bg-green-100",3,"title"],[1,"border-t","border-gray-200","bg-gray-50"],[1,"text-md","font-semibold","text-gray-900","mb-4"],[1,"bg-white","rounded-lg","p-4","border","border-gray-300","mb-4"],[1,"text-xs","font-medium","text-gray-500","uppercase","tracking-wide","mb-2"],[1,"text-sm","text-gray-900","font-mono","leading-relaxed","flex","flex-wrap","items-center","gap-2"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"btn","btn-secondary",3,"click"],[1,"pi","pi-bookmark"],[1,"btn","btn-primary","btn-lg",3,"click","disabled"],["class","text-gray-800",4,"ngIf"],[4,"ngIf"],[1,"text-gray-800"],["type","number","class","inline-input bg-blue-50 border border-blue-300 rounded px-2 py-1 text-sm w-24 font-semibold","placeholder","0.00",3,"ngModel","ngModelChange",4,"ngIf"],["type","date","class","inline-input bg-blue-50 border border-blue-300 rounded px-2 py-1 text-sm w-36 font-semibold",3,"ngModel","ngModelChange",4,"ngIf"],["class","inline-input bg-blue-50 border border-blue-300 rounded px-2 py-1 text-sm w-auto min-w-32 font-semibold",3,"ngModel","ngModelChange",4,"ngIf"],["type","number","placeholder","0.00",1,"inline-input","bg-blue-50","border","border-blue-300","rounded","px-2","py-1","text-sm","w-24","font-semibold",3,"ngModelChange","ngModel"],["type","date",1,"inline-input","bg-blue-50","border","border-blue-300","rounded","px-2","py-1","text-sm","w-36","font-semibold",3,"ngModelChange","ngModel"],[1,"inline-input","bg-blue-50","border","border-blue-300","rounded","px-2","py-1","text-sm","w-auto","min-w-32","font-semibold",3,"ngModelChange","ngModel"],[1,"animate-spin","rounded-full","h-4","w-4","border-b-2","border-white"],[1,"pi","pi-send"],[1,"bg-white","rounded-xl","shadow-sm","border","border-gray-200","mt-6","w-full","max-w-none","overflow-hidden","flex-shrink-0"],[1,"px-6","py-4","flex","items-center","justify-between"],[1,"btn","btn-tertiary",3,"click"],[1,"pi","pi-times"],[1,"p-6","max-w-full","overflow-hidden"],["class","text-center py-12",4,"ngIf"],["class","space-y-6",4,"ngIf"],[1,"text-center","py-12"],[1,"animate-spin","rounded-full","h-12","w-12","border-b-2","border-blue-600","mx-auto"],[1,"mt-4","text-gray-600"],[1,"w-64","bg-gray-200","rounded-full","h-2","mx-auto","mt-2"],[1,"bg-blue-600","h-2","rounded-full","animate-pulse",2,"width","60%"],[1,"space-y-6"],[1,"flex","items-center","gap-2","px-3","py-1","rounded-full","text-sm","font-medium",3,"ngClass"],[1,"bg-gray-50","rounded-lg","p-4","border","border-gray-200","mb-4"],[1,"text-sm","font-medium","text-gray-700","mb-3"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-3"],[1,"pi","pi-id-card","text-gray-500"],[1,"font-mono","text-sm","font-semibold","text-gray-800"],[1,"pi","pi-bookmark","text-gray-500"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4"],[1,"bg-blue-50","rounded-lg","p-4","border","border-blue-200"],[1,"text-sm","font-medium","text-blue-900"],[1,"text-lg","font-semibold","text-blue-700"],[1,"bg-green-50","rounded-lg","p-4","border","border-green-200"],[1,"text-sm","font-medium","text-green-900"],[1,"text-lg","font-semibold","text-green-700"],[1,"bg-purple-50","rounded-lg","p-4","border","border-purple-200"],[1,"text-sm","font-medium","text-purple-900"],[1,"text-lg","font-semibold","text-purple-700"],[1,"bg-gradient-to-br","from-blue-50","to-indigo-50","rounded-xl","border","border-blue-200","overflow-hidden","w-full"],[1,"w-full","max-w-none","overflow-auto","max-h-96"],[1,"text-gray-800","leading-relaxed","text-sm","font-sans","w-full","prose","prose-sm","max-w-none",2,"word-break","break-word","overflow-wrap","anywhere","max-width","100%","font-family","inherit",3,"innerHTML"],["class","flex items-center gap-2 mt-3 p-3 bg-blue-50 rounded-lg border border-blue-200",4,"ngIf"],["class","px-6 py-3 bg-blue-100 border-t border-blue-200",4,"ngIf"],[1,"flex","flex-wrap","gap-3","mb-6"],[1,"pi","pi-download"],[1,"pi","pi-ticket"],[1,"pi","pi-calendar"],[1,"pi","pi-share-alt"],[1,"border-t","border-gray-200","pt-6"],[1,"flex-1"],[1,"text-sm","font-medium","text-gray-900","mb-2"],[1,"text-xs","text-gray-600","mb-3"],[1,"flex","items-center","gap-1"],["class","text-lg transition-colors duration-200",3,"class","click",4,"ngFor","ngForOf","ngForTrackBy"],[1,"flex","items-center","gap-2","ml-4"],[1,"px-3","py-1","text-xs","rounded-full","border","transition-colors",3,"click"],[1,"pi","pi-check-circle","mr-1"],[1,"pi","pi-times-circle","mr-1"],[1,"flex","items-center","gap-2","ml-4","border-l","border-gray-300","pl-4"],[1,"pi","pi-check","mr-1"],[1,"pi","pi-exclamation-triangle","mr-1"],["class","mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg",4,"ngIf"],[1,"text-right","ml-6"],[1,"text-lg","font-semibold"],[1,"flex","items-center","gap-2","mt-3","p-3","bg-blue-50","rounded-lg","border","border-blue-200"],[1,"animate-spin","rounded-full","h-4","w-4","border-b-2","border-blue-600"],[1,"text-sm","text-blue-700","font-medium"],[1,"flex","gap-1","ml-2"],[1,"w-1","h-1","bg-blue-500","rounded-full","animate-pulse"],[1,"w-1","h-1","bg-blue-500","rounded-full","animate-pulse",2,"animation-delay","0.2s"],[1,"w-1","h-1","bg-blue-500","rounded-full","animate-pulse",2,"animation-delay","0.4s"],[1,"px-6","py-3","bg-blue-100","border-t","border-blue-200"],[1,"text-xs","text-blue-700","font-mono"],[1,"text-lg","transition-colors","duration-200",3,"click"],[1,"pi","pi-star-fill"],[1,"mt-3","p-3","bg-blue-50","border","border-blue-200","rounded-lg"],[1,"flex","items-center","gap-2","text-sm"],[1,"pi","pi-info-circle","text-blue-600"],[1,"text-blue-800"],[1,"bg-white","rounded-xl","shadow-sm","border","border-gray-200","mt-6"],[1,"px-6","py-4","border-b","border-gray-200","flex","items-center","justify-between"],["class","px-6 py-4 hover:bg-gray-50 cursor-pointer",3,"click",4,"ngFor","ngForOf"],[1,"px-6","py-4","hover:bg-gray-50","cursor-pointer",3,"click"],[1,"flex","items-start","justify-between"],[1,"text-xs","text-gray-500","mt-1"],["class","flex items-center gap-4 mt-2",4,"ngIf"],[1,"px-2","py-1","text-xs","rounded-full",3,"ngClass"],[1,"flex","items-center","gap-4","mt-2"],[1,"pi","pi-id-card","text-xs","text-gray-400"],[1,"text-xs","font-mono","text-gray-600"],[1,"pi","pi-bookmark","text-xs","text-gray-400"],[1,"space-y-6","flex-1","flex","flex-col","min-h-0"],[1,"bg-white","rounded-lg","border","border-gray-200","overflow-hidden","relative","flex-1","min-h-0"],["class","absolute z-30 top-4 right-4 max-w-xl pointer-events-none",4,"ngIf"],["class","absolute z-30 top-4 right-4 pointer-events-none",4,"ngIf"],["class","absolute inset-0 p-6",4,"ngIf"],["class","absolute inset-0 p-6 flex items-center justify-center",4,"ngIf"],[1,"w-full","h-full","flex-1","min-h-0"],["allow","microphone; clipboard-write;","frameborder","0",1,"transition-opacity","duration-300",2,"width","100%","height","100%","min-height","700px","display","block",3,"load","src"],[1,"absolute","z-30","top-4","right-4","max-w-xl","pointer-events-none"],[1,"flex","items-center","gap-3","bg-gray-900/90","text-white","rounded-md","px-3","py-2","shadow-lg","border","border-gray-800","pointer-events-auto"],[1,"text-sm","truncate","flex-1"],[1,"font-medium"],[1,"ml-1"],["title","Copy to clipboard",1,"btn","btn-secondary",3,"click"],[1,"pi","pi-copy"],[1,"btn","btn-primary",3,"click"],["title","Minimize",1,"btn","btn-tertiary",3,"click"],[1,"pi","pi-minus"],["title","Dismiss",1,"btn","btn-tertiary",3,"click"],[1,"absolute","z-30","top-4","right-4","pointer-events-none"],[1,"flex","items-center","gap-2","bg-gray-900/90","text-white","rounded-full","px-3","py-1.5","shadow-md","border","border-gray-800","pointer-events-auto"],[1,"pi","pi-comment"],[1,"text-xs","truncate","max-w-[260px]"],["title","Copy",1,"btn","btn-secondary",3,"click"],[1,"pi","pi-copy","text-xs"],["title","Expand",1,"btn","btn-primary",3,"click"],[1,"pi","pi-angle-up"],[1,"absolute","inset-0","p-6"],[1,"animate-pulse","space-y-4"],[1,"h-4","bg-gray-200","rounded","w-1/3"],[1,"h-4","bg-gray-200","rounded","w-1/2"],[1,"h-64","bg-gray-200","rounded"],[1,"absolute","inset-0","p-6","flex","items-center","justify-center"],[1,"text-center","text-sm","text-gray-600"],[1,"mb-2","font-medium","text-gray-800"]],template:function(n,r){1&n&&(e.j41(0,"div",2)(1,"div",3)(2,"div")(3,"h2",4),e.EFF(4),e.k0s(),e.j41(5,"div",5),e.EFF(6,"HAWK Agent"),e.k0s()(),e.j41(7,"div",6)(8,"span",7),e.EFF(9,"Template Mode"),e.k0s(),e.j41(10,"label",8)(11,"input",9),e.mxI("ngModelChange",function(o){return e.DH7(r.isAgentMode,o)||(r.isAgentMode=o),o}),e.k0s(),e.j41(12,"div",10),e.nrm(13,"div",11)(14,"div",12),e.k0s()(),e.j41(15,"span",7),e.EFF(16,"Agent Mode"),e.k0s()()(),e.DNE(17,ce,35,13,"div",13)(18,me,9,7,"div",14),e.k0s()),2&n&&(e.R7$(4),e.JRh(r.isAgentMode?"Agent Mode":"Template Mode"),e.R7$(7),e.R50("ngModel",r.isAgentMode),e.R7$(2),e.AVh("bg-blue-600",r.isAgentMode),e.R7$(),e.AVh("transform",r.isAgentMode)("translate-x-5",r.isAgentMode),e.R7$(3),e.Y8G("ngIf",!r.isAgentMode),e.R7$(),e.Y8G("ngIf",r.isAgentMode))},dependencies:[v.MD,v.YU,v.Sq,v.bT,m.YN,m.xH,m.y7,m.me,m.Q0,m.Zm,m.wz,m.BC,m.vS,I.P],styles:[".line-clamp-2[_ngcontent-%COMP%]{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis}"]})}}return i})()}}]);