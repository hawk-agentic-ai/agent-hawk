"use strict";(self.webpackChunkhedge_accounting_sfx=self.webpackChunkhedge_accounting_sfx||[]).push([[391],{9391:(le,x,_)=>{_.r(x),_.d(x,{PromptTemplatesV2Component:()=>re});var y=_(467),g=_(177),u=_(4341),e=_(4438);function F(r,a){if(1&r&&(e.j41(0,"option",10),e.EFF(1),e.k0s()),2&r){const t=a.$implicit;e.Y8G("value",t.value),e.R7$(),e.JRh(t.label)}}function k(r,a){if(1&r){const t=e.RV6();e.j41(0,"div")(1,"label",2),e.EFF(2,"Family"),e.k0s(),e.j41(3,"select",7),e.bIt("ngModelChange",function(s){e.eBV(t);const i=e.XpG();return e.Njj(i.familyChange.emit(s))}),e.j41(4,"option",8),e.EFF(5,"All"),e.k0s(),e.DNE(6,F,2,2,"option",9),e.k0s()()}if(2&r){const t=e.XpG();e.R7$(3),e.Y8G("ngModel",t.selectedFamily),e.R7$(3),e.Y8G("ngForOf",t.families)}}function w(r,a){if(1&r){const t=e.RV6();e.j41(0,"button",11),e.bIt("click",function(){const s=e.eBV(t).$implicit,i=e.XpG();return e.Njj(i.categoryChange.emit(s.value))}),e.j41(1,"span",12),e.EFF(2),e.k0s(),e.j41(3,"span",13),e.EFF(4),e.k0s()()}if(2&r){const t=a.$implicit,n=e.XpG();e.AVh("bg-blue-50",n.selectedCategory===t.value),e.R7$(2),e.JRh(t.label),e.R7$(2),e.JRh(t.count)}}let R=(()=>{class r{constructor(){this.families=[],this.categories=[],this.selectedFamily="",this.selectedCategory="",this.search="",this.hideFamily=!1,this.familyChange=new e.bkB,this.categoryChange=new e.bkB,this.searchChange=new e.bkB}get categoriesTotal(){return this.categories.reduce((t,n)=>t+(n.count||0),0)}static{this.\u0275fac=function(n){return new(n||r)}}static{this.\u0275cmp=e.VBU({type:r,selectors:[["app-pt-filters"]],inputs:{families:"families",categories:"categories",selectedFamily:"selectedFamily",selectedCategory:"selectedCategory",search:"search",hideFamily:"hideFamily"},outputs:{familyChange:"familyChange",categoryChange:"categoryChange",searchChange:"searchChange"},standalone:!0,features:[e.aNF],decls:11,vars:3,consts:[[1,"space-y-3"],[4,"ngIf"],[1,"block","text-xs","font-medium","text-gray-600","mb-1"],["type","text","placeholder","Search templates...",1,"filter-input","w-full",3,"ngModelChange","ngModel"],[1,"block","text-xs","font-medium","text-gray-600","mb-2"],[1,"space-y-1","max-h-[320px]","overflow-y-auto","pr-1"],["class","w-full px-3 py-2 rounded text-left text-sm hover:bg-gray-50",3,"bg-blue-50","click",4,"ngFor","ngForOf"],[1,"filter-input","w-full",3,"ngModelChange","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"w-full","px-3","py-2","rounded","text-left","text-sm","hover:bg-gray-50",3,"click"],[1,"mr-2"],[1,"text-xs","text-gray-500"]],template:function(n,s){1&n&&(e.j41(0,"div",0),e.DNE(1,k,7,2,"div",1),e.j41(2,"div")(3,"label",2),e.EFF(4,"Search"),e.k0s(),e.j41(5,"input",3),e.bIt("ngModelChange",function(l){return s.searchChange.emit(l)}),e.k0s()(),e.j41(6,"div")(7,"label",4),e.EFF(8,"Categories"),e.k0s(),e.j41(9,"div",5),e.DNE(10,w,5,4,"button",6),e.k0s()()()),2&n&&(e.R7$(),e.Y8G("ngIf",!s.hideFamily),e.R7$(4),e.Y8G("ngModel",s.search),e.R7$(5),e.Y8G("ngForOf",s.categories))},dependencies:[g.MD,g.Sq,g.bT,u.YN,u.xH,u.y7,u.me,u.wz,u.BC,u.vS],encapsulation:2})}}return r})();function I(r,a){if(1&r&&(e.j41(0,"span",12),e.EFF(1),e.k0s()),2&r){const t=e.XpG(),n=t.$implicit,s=t.index,i=e.XpG();e.R7$(),e.SpI("",i.getSuccess(n,s),"% success")}}function S(r,a){if(1&r&&(e.j41(0,"span",13),e.EFF(1),e.k0s()),2&r){const t=e.XpG().$implicit;e.R7$(),e.SpI("Dynamic (",(null==t.input_fields?null:t.input_fields.length)||0,")")}}function j(r,a){if(1&r&&(e.j41(0,"span",14),e.EFF(1),e.k0s()),2&r){const t=e.XpG().$implicit;e.R7$(),e.SpI("",t.usage_count," uses")}}function $(r,a){if(1&r){const t=e.RV6();e.j41(0,"div",3),e.bIt("click",function(){const s=e.eBV(t).index,i=e.XpG();return e.Njj(i.select.emit(s))}),e.j41(1,"div",4)(2,"div",5),e.EFF(3),e.k0s(),e.j41(4,"span",6),e.EFF(5),e.k0s()(),e.j41(6,"div",7),e.EFF(7),e.k0s(),e.j41(8,"div",8),e.DNE(9,I,2,1,"span",9)(10,S,2,1,"span",10)(11,j,2,1,"span",11),e.k0s()()}if(2&r){const t=a.$implicit,n=a.index,s=e.XpG();e.AVh("border-blue-500",s.selectedIndex===n),e.R7$(3),e.JRh(t.name),e.R7$(2),e.JRh(t.template_category),e.R7$(2),e.JRh(t.description||t.prompt_text),e.R7$(2),e.Y8G("ngIf",null!=s.getSuccess(t,n)),e.R7$(),e.Y8G("ngIf",null==t.input_fields?null:t.input_fields.length),e.R7$(),e.Y8G("ngIf",null!=t.usage_count)}}function E(r,a){1&r&&(e.j41(0,"div",15),e.EFF(1,"No templates found"),e.k0s())}let M=(()=>{class r{constructor(){this.templates=[],this.selectedIndex=-1,this.successMap={},this.select=new e.bkB}getSuccess(t,n){return this.successMap[t.id||`idx:${n}`]??null}static{this.\u0275fac=function(n){return new(n||r)}}static{this.\u0275cmp=e.VBU({type:r,selectors:[["app-pt-card-list"]],inputs:{templates:"templates",selectedIndex:"selectedIndex",successMap:"successMap"},outputs:{select:"select"},standalone:!0,features:[e.aNF],decls:3,vars:2,consts:[[1,"grid","gap-3"],["class","border rounded-md p-3 hover:border-blue-300 cursor-pointer transition-colors",3,"border-blue-500","click",4,"ngFor","ngForOf"],["class","text-sm text-gray-500 p-4 text-center border rounded",4,"ngIf"],[1,"border","rounded-md","p-3","hover:border-blue-300","cursor-pointer","transition-colors",3,"click"],[1,"flex","items-center","justify-between"],[1,"text-sm","font-medium","text-gray-900","truncate"],[1,"text-xs","px-2","py-0.5","rounded-full","bg-gray-100","text-gray-700"],[1,"text-xs","text-gray-600","mt-1","line-clamp-2"],[1,"mt-2","flex","items-center","gap-2"],["class","text-[11px] px-2 py-0.5 rounded-full bg-green-50 text-green-700",4,"ngIf"],["class","text-[11px] px-2 py-0.5 rounded-full bg-blue-50 text-blue-700",4,"ngIf"],["class","text-[11px] px-2 py-0.5 rounded-full bg-purple-50 text-purple-700",4,"ngIf"],[1,"text-[11px]","px-2","py-0.5","rounded-full","bg-green-50","text-green-700"],[1,"text-[11px]","px-2","py-0.5","rounded-full","bg-blue-50","text-blue-700"],[1,"text-[11px]","px-2","py-0.5","rounded-full","bg-purple-50","text-purple-700"],[1,"text-sm","text-gray-500","p-4","text-center","border","rounded"]],template:function(n,s){1&n&&(e.j41(0,"div",0),e.DNE(1,$,12,8,"div",1)(2,E,2,0,"div",2),e.k0s()),2&n&&(e.R7$(),e.Y8G("ngForOf",s.templates),e.R7$(),e.Y8G("ngIf",!(null!=s.templates&&s.templates.length)))},dependencies:[g.MD,g.Sq,g.bT],encapsulation:2})}}return r})();var G=_(8662),P=_(2316),v=_(4885);function V(r,a){if(1&r&&(e.j41(0,"option",24),e.EFF(1),e.k0s()),2&r){const t=a.$implicit;e.Y8G("value",t),e.R7$(),e.JRh(t)}}function D(r,a){if(1&r&&(e.qex(0),e.DNE(1,V,2,2,"option",23),e.bVm()),2&r){const t=e.XpG(5);e.R7$(),e.Y8G("ngForOf",t.currencyOptions)}}function A(r,a){if(1&r&&(e.j41(0,"option",24),e.EFF(1),e.k0s()),2&r){const t=a.$implicit,n=e.XpG(3).$implicit,s=e.XpG(3);e.Y8G("value",s.entityOptionValueFor(n,t)),e.R7$(),e.JRh(t.label)}}function N(r,a){if(1&r&&e.DNE(0,A,2,2,"option",23),2&r){const t=e.XpG(5);e.Y8G("ngForOf",t.entityOptions)}}function Y(r,a){if(1&r){const t=e.RV6();e.qex(0),e.j41(1,"select",21),e.mxI("ngModelChange",function(s){e.eBV(t);const i=e.XpG().$implicit,l=e.XpG(3);return e.DH7(l.values[i],s)||(l.values[i]=s),e.Njj(s)}),e.bIt("ngModelChange",function(){e.eBV(t);const s=e.XpG(4);return e.Njj(s.computeFilled())}),e.j41(2,"option",22),e.EFF(3,"-- Select --"),e.k0s(),e.DNE(4,D,2,1,"ng-container",9)(5,N,1,1,"ng-template",null,3,e.C5r),e.k0s(),e.bVm()}if(2&r){const t=e.sdS(6),n=e.XpG().$implicit,s=e.XpG(3);e.R7$(),e.R50("ngModel",s.values[n]),e.R7$(3),e.Y8G("ngIf",n.toLowerCase().includes("currency"))("ngIfElse",t)}}function X(r,a){if(1&r){const t=e.RV6();e.j41(0,"input",25),e.mxI("ngModelChange",function(s){e.eBV(t);const i=e.XpG().$implicit,l=e.XpG(3);return e.DH7(l.values[i],s)||(l.values[i]=s),e.Njj(s)}),e.bIt("ngModelChange",function(){e.eBV(t);const s=e.XpG(4);return e.Njj(s.computeFilled())}),e.k0s()}if(2&r){const t=e.XpG().$implicit,n=e.XpG(3);e.Y8G("type",n.getType(t)),e.R50("ngModel",n.values[t]),e.Y8G("placeholder",n.getPlaceholder(t))}}function B(r,a){if(1&r&&(e.j41(0,"label",19)(1,"span",20),e.EFF(2),e.k0s(),e.DNE(3,Y,7,3,"ng-container",9)(4,X,1,3,"ng-template",null,2,e.C5r),e.k0s()),2&r){const t=a.$implicit,n=e.sdS(5),s=e.XpG(3);e.R7$(2),e.JRh(t),e.R7$(),e.Y8G("ngIf",s.isSelect(t))("ngIfElse",n)}}function O(r,a){if(1&r&&(e.j41(0,"div")(1,"div",10),e.EFF(2,"Input Parameters"),e.k0s(),e.j41(3,"div",17),e.DNE(4,B,6,3,"label",18),e.k0s()()),2&r){const t=e.XpG(2);e.R7$(4),e.Y8G("ngForOf",t.fields)}}function U(r,a){1&r&&(e.j41(0,"div",26),e.EFF(1,"No input parameters detected from the prompt."),e.k0s())}function L(r,a){1&r&&(e.j41(0,"div",27),e.nrm(1,"div",28),e.j41(2,"span",29),e.EFF(3,"Streaming..."),e.k0s()())}function H(r,a){if(1&r){const t=e.RV6();e.qex(0),e.j41(1,"div")(2,"div",10),e.EFF(3,"Prompt Text (live)"),e.k0s(),e.j41(4,"pre",11),e.EFF(5),e.k0s()(),e.DNE(6,O,5,1,"div",9)(7,U,2,0,"ng-template",null,1,e.C5r),e.j41(9,"div",12)(10,"div",13),e.DNE(11,L,4,0,"div",14),e.j41(12,"button",15),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.send())}),e.nrm(13,"i",16),e.j41(14,"span"),e.EFF(15,"Submit"),e.k0s()()()(),e.bVm()}if(2&r){const t=e.sdS(8),n=e.XpG();e.R7$(5),e.JRh(n.filledPrompt||(n.template?n.template.prompt_text:"")),e.R7$(),e.Y8G("ngIf",null==n.fields?null:n.fields.length)("ngIfElse",t),e.R7$(5),e.Y8G("ngIf",n.streaming),e.R7$(),e.Y8G("disabled",n.streaming)}}function J(r,a){1&r&&(e.j41(0,"div",6),e.EFF(1,"Choose a template to see details."),e.k0s())}let q=(()=>{class r{send(){this.onSend.emit({text:this.filledPrompt||this.template?.prompt_text||"",values:this.values})}getType(t){const n=(t||"").toLowerCase();return n.includes("date")?"date":n.includes("amount")||n.includes("qty")||n.includes("quantity")||n.includes("rate")?"number":"text"}getPlaceholder(t){const n=(t||"").toLowerCase();return n.includes("date")?"YYYY-MM-DD":n.includes("currency")?"e.g., USD":n.includes("amount")||n.includes("qty")||n.includes("quantity")?"e.g., 100000":n.includes("rate")?"e.g., 0.05":n.includes("entity")?"e.g., Entity A":`Enter ${t}`}isSelect(t){const n=(t||"").toLowerCase(),s=n.replace(/\s+/g,"_");return n.includes("currency")||"entity"===n||s.includes("entity_id")||s.includes("entity_code")||s.includes("entity_name")}getSelectOptions(t){const n=(t||"").toLowerCase(),s=n.replace(/\s+/g,"_");return n.includes("currency")?this.currencyOptions:"entity"===n||s.includes("entity_id")||s.includes("entity_code")||s.includes("entity_name")?this.entityOptions:[]}constructor(t,n,s){this.currencySvc=t,this.entitySvc=n,this.ptSvc=s,this.template=null,this.fields=[],this.onSend=new e.bkB,this.responseText="",this.streaming=!1,this.values={},this.filledPrompt="",this.currencyOptions=[],this.entityOptions=[],this.copied=!1}ngOnInit(){try{this.currencySvc.getCurrencyCodes().subscribe(t=>this.currencyOptions=t||[])}catch{}try{this.entitySvc.entities$.subscribe(t=>{const n=(t||[]).map(s=>({label:`${s.entity_name} (${s.legal_entity_code})`,value:s.legal_entity_code}));this.entityOptions=n})}catch{}}ngOnChanges(t){(t.template||t.fields)&&(this.values={},(this.fields||[]).forEach(n=>this.values[n]=this.values[n]??""),this.computeFilled())}computeFilled(){const t=this.template?.prompt_text||"",n=this.values||{},s={};Object.keys(n).forEach(i=>{const l=n[i]??"",p=String(i),c=p.trim(),o=c.toLowerCase(),h=c.replace(/\s+/g,"_"),f=c.replace(/_/g," "),d=o.replace(/\s+/g,"_"),b=o.replace(/_/g," ");[p,c,o,h,f,d,b].forEach(m=>{s[m]=l})}),this.filledPrompt=this.ptSvc.fillTemplate(t,s)}escapeReg(t){return t.replace(/[.*+?^${}()|[\\]\\]/g,"\\$&")}entityOptionValueFor(t,n){const s=(t||"").toLowerCase(),i=s.replace(/\s+/g,"_");return i.includes("entity_name")?n.label:i.includes("entity_code")||i.includes("entity_id")?n.value:"entity"===s?n.label:n.value}static{this.\u0275fac=function(n){return new(n||r)(e.rXU(G.P),e.rXU(P.r),e.rXU(v.r))}}static{this.\u0275cmp=e.VBU({type:r,selectors:[["app-pt-preview"]],inputs:{template:"template",fields:"fields",responseText:"responseText",streaming:"streaming"},outputs:{onSend:"onSend"},standalone:!0,features:[e.OA$,e.aNF],decls:10,vars:3,consts:[["empty",""],["noParams",""],["textField",""],["entityOpts",""],[1,"h-full","flex","flex-col"],[1,"border-b","pb-2","mb-2"],[1,"text-sm","text-gray-500"],[1,"text-base","font-semibold","text-gray-900","truncate"],[1,"flex-1","min-h-0","overflow-auto","space-y-3"],[4,"ngIf","ngIfElse"],[1,"text-xs","text-gray-500","mb-1"],[1,"bg-gray-50","border","rounded","p-2","text-xs","whitespace-pre-wrap"],[1,"pt-2","mt-2","border-t","flex","items-center","justify-end"],[1,"flex","items-center","gap-2"],["class","flex items-center gap-2 mr-2",4,"ngIf"],[1,"btn","btn-primary",3,"click","disabled"],[1,"pi","pi-send"],[1,"grid","grid-cols-1","gap-2"],["class","text-xs",4,"ngFor","ngForOf"],[1,"text-xs"],[1,"block","text-[11px]","text-gray-600","mb-1"],[1,"filter-input","w-full",3,"ngModelChange","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"filter-input","w-full",3,"ngModelChange","type","ngModel","placeholder"],[1,"text-xs","text-gray-500"],[1,"flex","items-center","gap-2","mr-2"],[1,"animate-spin","rounded-full","h-4","w-4","border-b-2","border-blue-600"],[1,"text-xs","text-blue-700"]],template:function(n,s){if(1&n&&(e.j41(0,"div",4)(1,"div",5)(2,"div",6),e.EFF(3,"Template"),e.k0s(),e.j41(4,"div",7),e.EFF(5),e.k0s()(),e.j41(6,"div",8),e.DNE(7,H,16,5,"ng-container",9)(8,J,2,0,"ng-template",null,0,e.C5r),e.k0s()()),2&n){const i=e.sdS(9);e.R7$(5),e.JRh((null==s.template?null:s.template.name)||"Select a template"),e.R7$(2),e.Y8G("ngIf",s.template)("ngIfElse",i)}},dependencies:[g.MD,g.Sq,g.bT,u.YN,u.xH,u.y7,u.me,u.wz,u.BC,u.vS],encapsulation:2})}}return r})();var C=_(345);const z=()=>[1,2,3,4,5];function K(r,a){1&r&&(e.j41(0,"div",29),e.nrm(1,"div",30),e.j41(2,"span",31),e.EFF(3,"Receiving response..."),e.k0s(),e.j41(4,"div",32),e.nrm(5,"div",33)(6,"div",34)(7,"div",35),e.k0s()())}function W(r,a){if(1&r&&(e.j41(0,"div",36)(1,"div",37),e.EFF(2),e.k0s()()),2&r){const t=e.XpG();e.R7$(2),e.JRh(t.getResponseMetadata())}}function Q(r,a){if(1&r){const t=e.RV6();e.j41(0,"button",38),e.bIt("click",function(){const s=e.eBV(t).$implicit,i=e.XpG();return e.Njj(i.rate.emit(s))}),e.nrm(1,"i",39),e.k0s()}if(2&r){const t=a.$implicit,n=e.XpG();e.HbH(t<=n.rating?"text-yellow-400 hover:text-yellow-500":"text-gray-300 hover:text-yellow-300")}}let Z=(()=>{class r{constructor(t){this.sanitizer=t,this.responseText="",this.streaming=!1,this.rating=0,this.completion=null,this.export=new e.bkB,this.ticket=new e.bkB,this.schedule=new e.bkB,this.share=new e.bkB,this.rate=new e.bkB,this.setCompletion=new e.bkB}getCleanResponse(){return this.responseText?this.responseText.split("\n\n---\n")[0]||this.responseText:""}getFormattedResponse(){if(!this.responseText)return this.sanitizer.bypassSecurityTrustHtml("");let n=this.getCleanResponse().replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>");n=this.convertTablesToHtml(n);const s=n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"&quot;").replace(/'/g,"&#39;").replace(/&lt;strong&gt;(.*?)&lt;\/strong&gt;/g,"<strong>$1</strong>").replace(/&lt;table([^&]*)&gt;/g,"<table$1>").replace(/&lt;\/table&gt;/g,"</table>").replace(/&lt;thead([^&]*)&gt;/g,"<thead$1>").replace(/&lt;\/thead&gt;/g,"</thead>").replace(/&lt;tbody([^&]*)&gt;/g,"<tbody$1>").replace(/&lt;\/tbody&gt;/g,"</tbody>").replace(/&lt;tr([^&]*)&gt;/g,"<tr$1>").replace(/&lt;\/tr&gt;/g,"</tr>").replace(/&lt;th([^&]*)&gt;/g,"<th$1>").replace(/&lt;\/th&gt;/g,"</th>").replace(/&lt;td([^&]*)&gt;/g,"<td$1>").replace(/&lt;\/td&gt;/g,"</td>").replace(/\n/g,"<br>");return this.sanitizer.bypassSecurityTrustHtml(s)}getResponseMetadata(){if(!this.responseText)return"";const t=this.responseText.split("\n\n---\n");return t.length>1?t[1].trim():""}convertTablesToHtml(t){const n=t.split("\n");let s="",i=!1,l=[];for(let p=0;p<n.length;p++){const c=n[p].trim();if(c.startsWith("|")&&c.endsWith("|")&&c.includes("|")){i||(i=!0,l=[]);const o=c.split("|").slice(1,-1).map(d=>d.trim());l.push(o);const h=p+1<n.length?n[p+1].trim():"",f=/^\|[\s\-:]+\|$/.test(h);if(p===n.length-1||!n[p+1].trim().startsWith("|")||f){f&&p++;let d='<table class="min-w-full divide-y divide-gray-200 border border-gray-300 rounded-lg overflow-hidden my-4">';if(l.length>0&&(d+='<thead class="bg-gray-50"><tr>',l[0].forEach(b=>{d+=`<th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-200">${b}</th>`}),d+="</tr></thead>"),l.length>1){d+='<tbody class="bg-white divide-y divide-gray-200">';for(let b=1;b<l.length;b++)d+='<tr class="hover:bg-gray-50">',l[b].forEach(m=>{d+=`<td class="px-4 py-3 text-sm text-gray-900 border-b border-gray-100">${m}</td>`}),d+="</tr>";d+="</tbody>"}d+="</table>",s+=d,i=!1,l=[]}}else{if(i){if(l.length>0){let o='<table class="min-w-full divide-y divide-gray-200 border border-gray-300 rounded-lg overflow-hidden my-4">';o+='<tbody class="bg-white divide-y divide-gray-200">',l.forEach(h=>{o+='<tr class="hover:bg-gray-50">',h.forEach(f=>{o+=`<td class="px-4 py-3 text-sm text-gray-900 border-b border-gray-100">${f}</td>`}),o+="</tr>"}),o+="</tbody></table>",s+=o}i=!1,l=[]}s+=c+"\n"}}return s}static{this.\u0275fac=function(n){return new(n||r)(e.rXU(C.up))}}static{this.\u0275cmp=e.VBU({type:r,selectors:[["app-pt-results"]],inputs:{responseText:"responseText",streaming:"streaming",rating:"rating",completion:"completion"},outputs:{export:"export",ticket:"ticket",schedule:"schedule",share:"share",rate:"rate",setCompletion:"setCompletion"},standalone:!0,features:[e.aNF],decls:50,vars:13,consts:[[1,"flex","flex-col","h-full"],[1,"px-2","py-1","border-b","border-gray-100"],[1,"text-sm","font-semibold","text-gray-900"],[1,"flex-1","overflow-auto"],[1,"p-2"],[1,"text-gray-800","leading-relaxed","text-sm","font-sans","w-full","prose","prose-sm","max-w-none",2,"word-break","break-word","overflow-wrap","anywhere","max-width","100%","font-family","inherit",3,"innerHTML"],["class","flex items-center gap-2 mt-3 p-3 bg-blue-50 rounded-lg border border-blue-200",4,"ngIf"],["class","px-3 py-2 bg-blue-100 border-t border-blue-200",4,"ngIf"],[1,"px-2","py-2","border-t","border-gray-100","flex","flex-wrap","gap-2"],[1,"btn","btn-secondary",3,"click"],[1,"pi","pi-download"],[1,"pi","pi-ticket"],[1,"pi","pi-calendar"],[1,"pi","pi-share-alt"],[1,"px-2","py-3","border-t","border-gray-100"],[1,"flex","items-center","justify-between"],[1,"flex-1"],[1,"text-sm","font-medium","text-gray-900","mb-2"],[1,"text-xs","text-gray-600","mb-3"],[1,"flex","items-center","gap-2"],[1,"flex","items-center","gap-1"],["class","text-lg transition-colors duration-200",3,"class","click",4,"ngFor","ngForOf"],[1,"flex","items-center","gap-2","ml-4"],[1,"px-3","py-1","text-xs","rounded-full","border","transition-colors",3,"click"],[1,"pi","pi-check-circle","mr-1"],[1,"pi","pi-times-circle","mr-1"],[1,"flex","items-center","gap-2","ml-4","border-l","border-gray-300","pl-4"],[1,"pi","pi-check","mr-1"],[1,"pi","pi-exclamation-triangle","mr-1"],[1,"flex","items-center","gap-2","mt-3","p-3","bg-blue-50","rounded-lg","border","border-blue-200"],[1,"animate-spin","rounded-full","h-4","w-4","border-b-2","border-blue-600"],[1,"text-sm","text-blue-700","font-medium"],[1,"flex","gap-1","ml-2"],[1,"w-1","h-1","bg-blue-500","rounded-full","animate-pulse"],[1,"w-1","h-1","bg-blue-500","rounded-full","animate-pulse",2,"animation-delay","0.2s"],[1,"w-1","h-1","bg-blue-500","rounded-full","animate-pulse",2,"animation-delay","0.4s"],[1,"px-3","py-2","bg-blue-100","border-t","border-blue-200"],[1,"text-xs","text-blue-700","font-mono"],[1,"text-lg","transition-colors","duration-200",3,"click"],[1,"pi","pi-star-fill"]],template:function(n,s){1&n&&(e.j41(0,"div",0)(1,"div",1)(2,"h3",2),e.EFF(3,"Results"),e.k0s()(),e.j41(4,"div",3)(5,"div",4),e.nrm(6,"div",5),e.DNE(7,K,8,0,"div",6),e.k0s(),e.DNE(8,W,3,1,"div",7),e.k0s(),e.j41(9,"div",8)(10,"button",9),e.bIt("click",function(){return s.export.emit()}),e.nrm(11,"i",10),e.j41(12,"span"),e.EFF(13,"Export Report"),e.k0s()(),e.j41(14,"button",9),e.bIt("click",function(){return s.ticket.emit()}),e.nrm(15,"i",11),e.j41(16,"span"),e.EFF(17,"Create Ticket"),e.k0s()(),e.j41(18,"button",9),e.bIt("click",function(){return s.schedule.emit()}),e.nrm(19,"i",12),e.j41(20,"span"),e.EFF(21,"Schedule Review"),e.k0s()(),e.j41(22,"button",9),e.bIt("click",function(){return s.share.emit()}),e.nrm(23,"i",13),e.j41(24,"span"),e.EFF(25,"Share"),e.k0s()()(),e.j41(26,"div",14)(27,"div",15)(28,"div",16)(29,"h4",17),e.EFF(30,"Rate this response"),e.k0s(),e.j41(31,"p",18),e.EFF(32,"Help improve template accuracy by rating the quality of this result"),e.k0s(),e.j41(33,"div",19)(34,"div",20),e.DNE(35,Q,2,2,"button",21),e.k0s(),e.j41(36,"div",22)(37,"button",23),e.bIt("click",function(){return s.rate.emit(5)}),e.nrm(38,"i",24),e.EFF(39," Correct "),e.k0s(),e.j41(40,"button",23),e.bIt("click",function(){return s.rate.emit(1)}),e.nrm(41,"i",25),e.EFF(42," Incorrect "),e.k0s()(),e.j41(43,"div",26)(44,"button",23),e.bIt("click",function(){return s.setCompletion.emit("complete")}),e.nrm(45,"i",27),e.EFF(46," Complete "),e.k0s(),e.j41(47,"button",23),e.bIt("click",function(){return s.setCompletion.emit("incomplete")}),e.nrm(48,"i",28),e.EFF(49," Incomplete "),e.k0s()()()()()()()),2&n&&(e.R7$(6),e.Y8G("innerHTML",s.getFormattedResponse(),e.npT),e.R7$(),e.Y8G("ngIf",s.streaming),e.R7$(),e.Y8G("ngIf",s.getResponseMetadata()),e.R7$(27),e.Y8G("ngForOf",e.lJ4(12,z)),e.R7$(2),e.HbH(s.rating>=4?"bg-green-100 text-green-700 border-green-300":"bg-gray-100 text-gray-600 border-gray-300 hover:bg-green-50"),e.R7$(3),e.HbH(s.rating<=2?"bg-red-100 text-red-700 border-red-300":"bg-gray-100 text-gray-600 border-gray-300 hover:bg-red-50"),e.R7$(4),e.HbH("complete"===s.completion?"bg-blue-100 text-blue-700 border-blue-300":"bg-gray-100 text-gray-600 border-gray-300 hover:bg-blue-50"),e.R7$(3),e.HbH("incomplete"===s.completion?"bg-orange-100 text-orange-700 border-orange-300":"bg-gray-100 text-gray-600 border-gray-300 hover:bg-orange-50"))},dependencies:[g.MD,g.Sq,g.bT],encapsulation:2})}}return r})();var ee=_(4211),T=_(7488),te=_(6806);function ne(r,a){if(1&r){const t=e.RV6();e.j41(0,"button",23),e.bIt("click",function(){const s=e.eBV(t).$implicit,i=e.XpG();return e.Njj(i.onFamilyChange(s.value))}),e.EFF(1),e.k0s()}if(2&r){const t=a.$implicit,n=e.XpG();e.AVh("bg-blue-600",n.selectedFamily===t.value)("text-white",n.selectedFamily===t.value)("border-blue-600",n.selectedFamily===t.value)("bg-white",n.selectedFamily!==t.value)("text-gray-700",n.selectedFamily!==t.value)("border-gray-300",n.selectedFamily!==t.value),e.R7$(),e.JRh(t.label)}}function se(r,a){1&r&&(e.j41(0,"div",24),e.EFF(1,"Loading templates..."),e.k0s())}function ie(r,a){if(1&r){const t=e.RV6();e.j41(0,"app-pt-card-list",25),e.bIt("select",function(s){e.eBV(t);const i=e.XpG();return e.Njj(i.select(s))}),e.k0s()}if(2&r){const t=e.XpG();e.Y8G("templates",t.filtered)("selectedIndex",t.selectedIndex)("successMap",t.successRates)}}let re=(()=>{class r{constructor(t,n,s,i,l){this.svc=t,this.route=n,this.router=s,this.sessions=i,this.sanitizer=l,this.families=[],this.categories=[],this.selectedFamily="",this.selectedCategory="",this.search="",this.loading=!1,this.responseText="",this.isLoading=!1,this.isStreaming=!1,this.streamBuffer="",this.reader=null,this.currentMsgUid="",this.currentInstructionId="",this.all=[],this.filtered=[],this.selectedIndex=-1,this.currentRating=0,this.completionStatus=null,this.isAgentMode=!1,this.successRates={},this.agentUrlSafe=this.sanitizer.bypassSecurityTrustResourceUrl(ee.Xh)}ngOnInit(){var t=this;return(0,y.A)(function*(){const n=localStorage.getItem("pt.family")||"",s=localStorage.getItem("pt.category")||"",i=localStorage.getItem("pt.search")||"",l=parseInt(localStorage.getItem("pt.index")||"-1",10);t.route.queryParams.subscribe(function(){var p=(0,y.A)(function*(c){t.loading=!0;try{t.families=yield t.svc.getUniqueFamilyTypes();const o=t.families.find(f=>(f.label||"").toLowerCase().includes("instructions"))?.value||"";if(t.selectedFamily=(c.family??n)||o,t.selectedCategory=c.category??s,t.search=c.search??i,yield t.refreshTemplates(),yield t.refreshCategories(),!t.selectedCategory&&t.categories?.length){const f=t.categories.find(d=>(d.label||"").toLowerCase().includes("inception"))?.value;t.selectedCategory=f||t.categories[0]?.value||""}t.applyFilters();const h=null!=c.template?parseInt(c.template,10):NaN;t.selectedIndex=Number.isFinite(h)?h:Number.isFinite(l)?l:-1,t.selectedIndex>=t.filtered.length&&(t.selectedIndex=-1)}finally{t.loading=!1}});return function(c){return p.apply(this,arguments)}}())})()}onFamilyChange(t){var n=this;return(0,y.A)(function*(){n.selectedFamily=t||"",n.selectedCategory="",yield n.refreshTemplates(),yield n.refreshCategories(),n.categories&&n.categories.length&&(n.selectedCategory=n.categories[0].value),n.applyFilters(),n.selectedIndex=n.filtered&&n.filtered.length?0:-1,n.refreshSuccessRates().catch(()=>{}),n.persistAndSyncUrl()})()}onCategoryChange(t){var n=this;return(0,y.A)(function*(){n.selectedCategory=t||"",n.applyFilters(),n.selectedIndex=n.filtered&&n.filtered.length?0:-1,n.refreshSuccessRates().catch(()=>{}),n.persistAndSyncUrl()})()}onSearchChange(t){this.search=t||"",this.applyFilters(),this.persistAndSyncUrl()}refreshTemplates(){var t=this;return(0,y.A)(function*(){t.all=t.selectedFamily?yield t.svc.getTemplatesByFamilyType(t.selectedFamily):yield t.svc.searchTemplates(t.search||"")})()}refreshCategories(){var t=this;return(0,y.A)(function*(){if(!t.selectedFamily)return void(t.categories=[]);const n=yield t.svc.getTemplateCategoriesByFamily(t.selectedFamily),s={};t.all.forEach(i=>{const l=i.template_category||"";s[l]=(s[l]||0)+1}),t.categories=n.map(i=>({...i,count:s[i.value]||0}))})()}applyFilters(){const t=(this.search||"").toLowerCase();this.filtered=this.all.filter(n=>{const s=!this.selectedCategory||n.template_category===this.selectedCategory,i=!t||(n.name||"").toLowerCase().includes(t)||(n.description||"").toLowerCase().includes(t)||(n.prompt_text||"").toLowerCase().includes(t);return s&&i}),this.filtered=(this.filtered||[]).slice(0,8),0===this.filtered.length&&(this.selectedIndex=-1),this.refreshSuccessRates().catch(()=>{})}select(t){this.selectedIndex=t,this.persistAndSyncUrl()}get selectedTemplate(){return(this.selectedIndex>=0?this.filtered[this.selectedIndex]:null)||null}get selectedFields(){const t=this.selectedTemplate?.input_fields||[],n=Array.isArray(t)?t.map(c=>null==c?"":String(c)):[],s=this.svc.getInputFields(this.selectedTemplate?.prompt_text||"")||[],i=new Set,l=[],p=c=>{const o=(c||"").trim();return!(!o||"[object Object]"===o||o.length>80||!/[a-zA-Z]/.test(o))};return(s||[]).forEach(c=>{const o=String(c||"").trim(),h=o.toLowerCase();p(o)&&!i.has(h)&&(i.add(h),l.push(o))}),(n||[]).forEach(c=>{const o=String(c||"").trim(),h=o.toLowerCase();p(o)&&!i.has(h)&&(i.add(h),l.push(o))}),l}submit(t){var n=this;return(0,y.A)(function*(){const i=n.svc.fillTemplate(t?.text||"",t?.values||{});if(!i)return;n.responseText="",n.currentMsgUid=n.generateMsgUID(),n.currentInstructionId=n.generateInstructionId(),yield n.sessions.createSession(i,n.currentMsgUid,n.currentInstructionId,n.selectedCategory||"template",n.selectedIndex+1);const l=n.selectedTemplate?.id;l&&n.svc.incrementUsageCount(l).catch(()=>{}),n.sendToDifyAgent(i)})()}exportReport(){console.log("Export report clicked")}createTicket(){console.log("Create ticket clicked")}scheduleReview(){console.log("Schedule review clicked")}shareResults(){console.log("Share results clicked")}generateMsgUID(){return"MSG-"+Date.now()+"-"+Math.random().toString(36).slice(2,8).toUpperCase()}generateInstructionId(){return"INSTR-"+Date.now()+"-"+Math.random().toString(36).slice(2,8).toUpperCase()}updateDatabaseSession(t,n){var s=this;return(0,y.A)(function*(){try{yield s.sessions.updateSession(s.currentMsgUid,{agent_status:t,agent_response:{text:s.responseText,...n?{usage:n}:{}}})}catch(i){console.error("update session error",i)}})()}sendToDifyAgent(t){const s={conversation_id:"",inputs:{msg_uid:this.currentMsgUid,instruction_id:this.currentInstructionId},query:`[MSG_UID: ${this.currentMsgUid}] [INSTRUCTION_ID: ${this.currentInstructionId}] ${t}`,user:"test-user",response_mode:"streaming"};this.streamBuffer="",this.responseText="",this.isStreaming=!0,this.isLoading=!0,fetch("https://api.dify.ai/v1/chat-messages",{method:"POST",headers:{Authorization:"Bearer app-KKtaMynVyn8tKbdV9VbbaeyR","Content-Type":"application/json"},body:JSON.stringify(s)}).then(i=>{if(!i.ok)throw new Error(`HTTP ${i.status}`);if(!i.body)throw new Error("Empty response body");return this.isLoading=!1,this.reader=i.body.getReader(),this.processStream(this.reader)}).catch(i=>{console.error("Dify error:",i),this.isLoading=!1,this.isStreaming=!1,this.responseText=`Error: ${i?.message||i}`,this.updateDatabaseSession("failed").catch(()=>{})})}processStream(t){var n=this;return(0,y.A)(function*(){const s=new TextDecoder;let i="",l="",p="",c=null;try{for(;;){const{value:o,done:h}=yield t.read();if(h){n.isStreaming=!1,n.finishStream(l,p,c);break}if(!o)continue;i+=s.decode(o,{stream:!0});const d=i.split("\n");i=d.pop()||"";for(const b of d)if(b.startsWith("data: "))try{const m=JSON.parse(b.substring(6));if(!l&&m.conversation_id&&(l=m.conversation_id),!p&&m.task_id&&(p=m.task_id),"agent_message"===m.event&&m.answer&&(n.streamBuffer+=m.answer,n.responseText=n.streamBuffer),(m.metadata?.usage||m.usage)&&(c=m.metadata?.usage||m.usage),"message_end"===m.event||"workflow_finished"===m.event)return n.isStreaming=!1,void n.finishStream(l,p,c)}catch{}}}catch(o){console.error("stream error",o),n.isStreaming=!1,n.responseText+="\n\n[Stream interrupted due to error]",n.updateDatabaseSession("failed").catch(()=>{})}finally{t.releaseLock()}})()}finishStream(t,n,s){let i="\n\n---\n";i+=`Message UID: ${this.currentMsgUid}\n`,i+=`Instruction ID: ${this.currentInstructionId}`,t&&(i+=`\nConversation ID: ${t}`),n&&(i+=`\nTask ID: ${n}`),s&&(i+=`\nInput Tokens: ${s.input_tokens||s.prompt_tokens||0}`,i+=`\nOutput Tokens: ${s.output_tokens||s.completion_tokens||0}`,i+=`\nTotal Tokens: ${s.total_tokens||(s.input_tokens||s.prompt_tokens||0)+(s.output_tokens||s.completion_tokens||0)}`),this.responseText+=i,this.updateDatabaseSession("completed",s).catch(()=>{}),this.refreshSuccessRates().catch(()=>{})}setRating(t){this.currentRating=t;try{this.sessions.updateSession(this.currentMsgUid,{metadata:{rating:t}})}catch{}}setCompletionStatus(t){this.completionStatus=t;const n="complete"===t?"completed":"failed";try{this.sessions.updateSession(this.currentMsgUid,{agent_status:n,metadata:{completion_status:t}}),this.refreshSuccessRates().catch(()=>{})}catch{}}refreshSuccessRates(){var t=this;return(0,y.A)(function*(){if(t.successRates={},t.selectedCategory)try{const n=yield t.sessions.getSessions(),s={};(n||[]).forEach(i=>{if(i.template_category===t.selectedCategory){const l=i.template_index||0;s[l]=s[l]||{total:0,success:0},s[l].total++,(!i.metadata||"complete"!==i.metadata.completion_status&&"incomplete"!==i.metadata.completion_status?"completed"===i.agent_status:"complete"===i.metadata.completion_status)&&s[l].success++}}),t.filtered.forEach((i,l)=>{const p=s[l+1];if(p&&p.total>0){const c=Math.round(p.success/p.total*100);t.successRates[i.id||`idx:${l}`]=c}})}catch{}})()}onAgentModeToggle(t){this.isAgentMode=!!t,this.isAgentMode&&this.router.navigate(["/hawk-agent/agent-mode"])}persistAndSyncUrl(){localStorage.setItem("pt.family",this.selectedFamily||""),localStorage.setItem("pt.category",this.selectedCategory||""),localStorage.setItem("pt.search",this.search||""),localStorage.setItem("pt.index",String(this.selectedIndex));const t={};this.selectedFamily&&(t.family=this.selectedFamily),this.selectedCategory&&(t.category=this.selectedCategory),this.search&&(t.search=this.search),this.selectedIndex>=0&&(t.template=this.selectedIndex),this.router.navigate([],{queryParams:t,queryParamsHandling:"merge"})}onKeydown(t){this.filtered?.length&&("ArrowDown"===t.key&&(this.selectedIndex=Math.min(this.filtered.length-1,Math.max(0,this.selectedIndex)+1),t.preventDefault(),this.persistAndSyncUrl()),"ArrowUp"===t.key&&(this.selectedIndex=Math.max(0,(this.selectedIndex<0?0:this.selectedIndex)-1),t.preventDefault(),this.persistAndSyncUrl()),"Enter"===t.key&&(this.submit({text:this.selectedTemplate?.prompt_text||"",values:{}}),t.preventDefault()))}static{this.\u0275fac=function(n){return new(n||r)(e.rXU(v.r),e.rXU(T.nX),e.rXU(T.Ix),e.rXU(te.G),e.rXU(C.up))}}static{this.\u0275cmp=e.VBU({type:r,selectors:[["app-hawk-prompt-templates-v2"]],hostBindings:function(n,s){1&n&&e.bIt("keydown",function(l){return s.onKeydown(l)})},standalone:!0,features:[e.aNF],decls:30,vars:24,consts:[[1,"p-6","min-h-full","flex","flex-col"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-xl","font-semibold","text-gray-900"],[1,"text-xs","text-gray-500"],[1,"flex","items-center","gap-3"],[1,"text-sm",3,"ngClass"],[1,"inline-flex","items-center","cursor-pointer"],["type","checkbox",1,"sr-only",3,"ngModelChange","ngModel"],["role","switch",1,"relative"],[1,"w-12","h-7","rounded-full","transition-colors","duration-200","shadow-inner","ring-1",3,"ngClass"],[1,"absolute","top-0.5","left-0.5","w-6","h-6","bg-white","rounded-full","shadow","transform","transition","duration-200"],[1,"mb-3","overflow-x-auto"],[1,"flex","gap-2"],["class","px-3 py-1.5 rounded-full border text-sm whitespace-nowrap",3,"bg-blue-600","text-white","border-blue-600","bg-white","text-gray-700","border-gray-300","click",4,"ngFor","ngForOf"],[1,"flex-1","grid","gap-4",2,"grid-template-columns","280px 1fr 400px","min-height","0"],[1,"bg-white","border","rounded-lg","p-3","overflow-auto"],[3,"familyChange","categoryChange","searchChange","families","categories","selectedFamily","selectedCategory","search","hideFamily"],[1,"bg-white","border","rounded-lg","p-3","overflow-auto","min-h-0",2,"max-height","520px"],["class","text-sm text-gray-500",4,"ngIf"],[3,"templates","selectedIndex","successMap","select",4,"ngIf"],[3,"onSend","template","fields","streaming"],[1,"mt-4","bg-white","border","rounded-lg","p-3","overflow-auto"],[3,"export","ticket","schedule","share","rate","setCompletion","responseText","streaming","rating","completion"],[1,"px-3","py-1.5","rounded-full","border","text-sm","whitespace-nowrap",3,"click"],[1,"text-sm","text-gray-500"],[3,"select","templates","selectedIndex","successMap"]],template:function(n,s){1&n&&(e.j41(0,"div",0)(1,"div",1)(2,"div")(3,"h2",2),e.EFF(4),e.k0s(),e.j41(5,"div",3),e.EFF(6,"HAWK Agent"),e.k0s()(),e.j41(7,"div",4)(8,"span",5),e.EFF(9,"Template Mode"),e.k0s(),e.j41(10,"label",6)(11,"input",7),e.bIt("ngModelChange",function(l){return s.onAgentModeToggle(l)}),e.k0s(),e.j41(12,"div",8),e.nrm(13,"div",9)(14,"div",10),e.k0s()(),e.j41(15,"span",5),e.EFF(16,"Agent Mode"),e.k0s()()(),e.j41(17,"div",11)(18,"div",12),e.DNE(19,ne,2,13,"button",13),e.k0s()(),e.j41(20,"div",14)(21,"div",15)(22,"app-pt-filters",16),e.bIt("familyChange",function(l){return s.onFamilyChange(l)})("categoryChange",function(l){return s.onCategoryChange(l)})("searchChange",function(l){return s.onSearchChange(l)}),e.k0s()(),e.j41(23,"div",17),e.DNE(24,se,2,0,"div",18)(25,ie,1,3,"app-pt-card-list",19),e.k0s(),e.j41(26,"div",15)(27,"app-pt-preview",20),e.bIt("onSend",function(l){return s.submit(l)}),e.k0s()()(),e.j41(28,"div",21)(29,"app-pt-results",22),e.bIt("export",function(){return s.exportReport()})("ticket",function(){return s.createTicket()})("schedule",function(){return s.scheduleReview()})("share",function(){return s.shareResults()})("rate",function(l){return s.setRating(l)})("setCompletion",function(l){return s.setCompletionStatus(l)}),e.k0s()()()),2&n&&(e.R7$(4),e.JRh(s.isAgentMode?"Agent Mode":"Template Mode"),e.R7$(4),e.Y8G("ngClass",s.isAgentMode?"text-gray-400":"text-blue-700 font-medium"),e.R7$(3),e.Y8G("ngModel",s.isAgentMode),e.R7$(),e.BMQ("aria-checked",s.isAgentMode),e.R7$(),e.Y8G("ngClass",s.isAgentMode?"bg-blue-600 ring-blue-600":"bg-gray-300 ring-gray-300"),e.R7$(),e.AVh("translate-x-5",s.isAgentMode),e.R7$(),e.Y8G("ngClass",s.isAgentMode?"text-blue-700 font-medium":"text-gray-400"),e.R7$(4),e.Y8G("ngForOf",s.families),e.R7$(3),e.Y8G("families",s.families)("categories",s.categories)("selectedFamily",s.selectedFamily)("selectedCategory",s.selectedCategory)("search",s.search)("hideFamily",!0),e.R7$(2),e.Y8G("ngIf",s.loading),e.R7$(),e.Y8G("ngIf",!s.loading),e.R7$(2),e.Y8G("template",s.selectedTemplate)("fields",s.selectedFields)("streaming",s.isStreaming),e.R7$(2),e.Y8G("responseText",s.responseText)("streaming",s.isStreaming)("rating",s.currentRating)("completion",s.completionStatus))},dependencies:[g.MD,g.YU,g.Sq,g.bT,u.YN,u.Zm,u.BC,u.vS,R,M,q,Z],encapsulation:2})}}return r})()}}]);