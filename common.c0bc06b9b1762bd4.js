"use strict";(self.webpackChunkhedge_accounting_sfx=self.webpackChunkhedge_accounting_sfx||[]).push([[76],{4211:(b,f,l)=>{l.d(f,{X0:()=>a,kz:()=>u});const a={allocation:{name:"HAWK Allocation Agent",description:"Stage 1A: Pre\u2011utilization check & feasibility assessment",url:"https://udify.app/chat/uPrwnPv2TV6UKQ9X",apiKey:"app-cxzVbRQUUDofTjx1nDfajpRX",stages:["1A"],scope:["utilization","feasibility","capacity"]},booking:{name:"HAWK Booking Agent",description:"Stage 1B/2/3: Booking, execution & GL posting",url:"https://udify.app/chat/jAkq2aHd4HTx5BxS",apiKey:"app-MHztrttE0Ty6jOqykQrp6rL2",stages:["1B","2","3"],scope:["booking","murex","gl_posting","trade_execution"]},analytics:{name:"HAWK Analytics Agent",description:"Analytics & reporting: effectiveness, exposure, trends",url:"https://udify.app/chat/SE9xbNvBsPQkZGua",apiKey:"app-KKtaMynVyn8tKbdV9VbbaeyR",stages:["cross"],scope:["analytics","reporting","effectiveness"]},config:{name:"HAWK Configuration Agent",description:"Configuration & setup (thresholds, buffers, mappings)",url:"https://udify.app/chat/REPLACE_CONFIG_CHAT_ID",apiKey:"app-x1QM74ZNV2mLqfH0jArH0tjn",stages:["config"],scope:["configuration","setup"]}},u="allocation",_=a[u].url;(()=>{try{return new URL(_).origin}catch{return"*"}})()},6031:(b,f,l)=>{l.d(f,{P:()=>m});var a=l(467),u=l(7129),_=l(4438);let m=(()=>{class c{constructor(){this.supabase=(0,u.b)(),this.table="currency_configuration"}list(s){var t=this;return(0,a.A)(function*(){let e=t.supabase.from(t.table).select("*");if(s?.search){const i=s.search.trim();i&&(e=e.or(`currency_code.ilike.%${i}%,currency_name.ilike.%${i}%`))}s?.type&&(e=e.eq("currency_type",s.type)),null!=s?.active&&(e=e.eq("active_flag",s.active)),e=e.order("currency_code",{ascending:!0});const{data:r,error:n}=yield e;if(n)throw n;return r||[]})()}getByCode(s){var t=this;return(0,a.A)(function*(){const{data:e,error:r}=yield t.supabase.from(t.table).select("*").eq("currency_code",s).single();if(r)throw r;return e})()}updateByCode(s,t){var e=this;return(0,a.A)(function*(){const{error:r}=yield e.supabase.from(e.table).update(t).eq("currency_code",s);if(r)throw r;return!0})()}deleteByCode(s){var t=this;return(0,a.A)(function*(){const{error:e}=yield t.supabase.from(t.table).delete().eq("currency_code",s);if(e)throw e;return!0})()}static{this.\u0275fac=function(t){return new(t||c)}}static{this.\u0275prov=_.jDH({token:c,factory:c.\u0275fac,providedIn:"root"})}}return c})()},2316:(b,f,l)=>{l.d(f,{r:()=>c});var a=l(467),u=l(4412),_=l(7129),m=l(4438);let c=(()=>{class g{constructor(){this.entitySubject=new u.t([]),this.entities$=this.entitySubject.asObservable(),this.supabase=(0,_.b)(),this.fetchEntities(),this.subscribeRealtime()}fetchEntities(){var t=this;return(0,a.A)(function*(){const{data:e,error:r}=yield t.supabase.from("entity_master").select("*");!r&&e&&t.entitySubject.next(e)})()}subscribeRealtime(){this.channel=this.supabase.channel("entity_master_changes").on("postgres_changes",{event:"*",schema:"public",table:"entity_master"},t=>{this.fetchEntities()}).subscribe()}addEntity(t){var e=this;return(0,a.A)(function*(){yield e.supabase.from("entity_master").insert([t])})()}updateEntity(t,e){var r=this;return(0,a.A)(function*(){yield r.supabase.from("entity_master").update(e).eq("entity_id",t)})()}deleteEntity(t){var e=this;return(0,a.A)(function*(){yield e.supabase.from("entity_master").delete().eq("entity_id",t)})()}static{this.\u0275fac=function(e){return new(e||g)}}static{this.\u0275prov=m.jDH({token:g,factory:g.\u0275fac,providedIn:"root"})}}return g})()},5032:(b,f,l)=>{l.d(f,{i:()=>m});var a=l(467),u=l(7129),_=l(4438);let m=(()=>{class c{constructor(){this.supabase=(0,u.b)(),this.table="hedging_framework"}list(s){var t=this;return(0,a.A)(function*(){let e=t.supabase.from(t.table).select("*");if(s?.search?.trim()){const i=s.search.trim();e=e.or(`framework_id.ilike.%${i}%,entity_id.ilike.%${i}%,currency_code.ilike.%${i}%`)}s?.type&&(e=e.eq("framework_type",s.type)),s?.active&&(e=e.eq("active_flag",s.active)),e=e.order("modified_date",{ascending:!1});const{data:r,error:n}=yield e;if(n)throw n;return r||[]})()}getById(s){var t=this;return(0,a.A)(function*(){const{data:e,error:r}=yield t.supabase.from(t.table).select("*").eq("framework_id",s).single();if(r)throw r;return e})()}updateById(s,t){var e=this;return(0,a.A)(function*(){const{error:r}=yield e.supabase.from(e.table).update(t).eq("framework_id",s);if(r)throw r;return!0})()}insert(s){var t=this;return(0,a.A)(function*(){const{error:e}=yield t.supabase.from(t.table).insert(s);if(e)throw e;return!0})()}deleteById(s){var t=this;return(0,a.A)(function*(){const{error:e}=yield t.supabase.from(t.table).delete().eq("framework_id",s);if(e)throw e;return!0})()}static{this.\u0275fac=function(t){return new(t||c)}}static{this.\u0275prov=_.jDH({token:c,factory:c.\u0275fac,providedIn:"root"})}}return c})()},4885:(b,f,l)=>{l.d(f,{r:()=>c});var a=l(467),u=l(4412),_=l(7129),m=l(4438);let c=(()=>{class g{constructor(){this.templatesSubject=new u.t([]),this.templates$=this.templatesSubject.asObservable(),this.loadTemplates()}loadTemplates(){var t=this;return(0,a.A)(function*(){try{console.log(" Loading templates from Supabase...");const e=(0,_.b)(),{data:r,error:n}=yield e.from("prompt_templates").select("*").eq("status","active").order("display_order",{ascending:!0});if(n)throw console.error(" Supabase query error:",n),n;console.log(` Loaded ${(r||[]).length} templates from database`),r&&r.length>0&&(console.log(" Sample template:",r[0]),console.log(" Available families:",[...new Set(r.map(i=>i.family_type))])),t.templatesSubject.next(r||[])}catch(e){console.error(" Error loading prompt templates:",e),console.warn(" Loading fallback templates...");const r=t.getFallbackTemplates();console.log(` Using ${r.length} fallback templates`),t.templatesSubject.next(r)}})()}getFallbackTemplates(){return[{id:"fallback-1",name:"Hedge Analysis Template",family_type:"hedge_accounting",template_category:"analysis",description:"Basic hedge analysis template",prompt_text:"Analyze {{hedge_type}} effectiveness for {{entity}} covering {{currency}} exposure of {{amount}}.",input_fields:["hedge_type","entity","currency","amount"],status:"active",display_order:1},{id:"fallback-2",name:"Risk Assessment Template",family_type:"risk_management",template_category:"assessment",description:"Basic risk assessment template",prompt_text:"Assess {{risk_type}} risk for {{portfolio}} with exposure {{amount}} in {{currency}}.",input_fields:["risk_type","portfolio","amount","currency"],status:"active",display_order:2}]}addTemplate(t){var e=this;return(0,a.A)(function*(){try{const r=(0,_.b)(),n=e.extractInputFields(t.prompt_text||""),{error:i}=yield r.from("prompt_templates").insert([{...t,input_fields:n,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString(),created_by:"current_user",updated_by:"current_user"}]);if(i)throw i;yield e.loadTemplates()}catch(r){throw console.error("Error adding template:",r),r}})()}updateTemplate(t,e){var r=this;return(0,a.A)(function*(){try{const n=(0,_.b)(),i=r.extractInputFields(e.prompt_text||""),{error:o}=yield n.from("prompt_templates").update({...e,input_fields:i,updated_at:(new Date).toISOString(),updated_by:"current_user"}).eq("id",t);if(o)throw o;yield r.loadTemplates()}catch(n){throw console.error("Error updating template:",n),n}})()}deleteTemplate(t){var e=this;return(0,a.A)(function*(){try{const r=(0,_.b)(),{error:n}=yield r.from("prompt_templates").delete().eq("id",t);if(n)throw n;yield e.loadTemplates()}catch(r){throw console.error("Error deleting template:",r),r}})()}incrementUsageCount(t){var e=this;return(0,a.A)(function*(){try{const r=(0,_.b)(),{error:n}=yield r.rpc("increment_template_usage",{template_id:t});if(n)throw n;yield e.loadTemplates()}catch(r){console.error("Error incrementing usage count:",r)}})()}getTemplatesByFamilyType(t){return(0,a.A)(function*(){try{console.log(` Loading templates for family: ${t}`);const e=(0,_.b)(),{data:r,error:n}=yield e.from("prompt_templates").select("*").eq("family_type",t).eq("status","active").order("display_order",{ascending:!0});if(n)throw console.error(" Templates by family query error:",n),n;return console.log(` Found ${(r||[]).length} templates for family ${t}`),r||[]}catch(e){return console.error(" Error getting templates by family type:",e),[]}})()}searchTemplates(t,e){return(0,a.A)(function*(){try{let n=(0,_.b)().from("prompt_templates").select("*").eq("status","active");e&&(n=n.eq("family_type",e)),t&&(n=n.or(`name.ilike.%${t}%,description.ilike.%${t}%,template_filters.ilike.%${t}%`));const{data:i,error:o}=yield n.order("display_order",{ascending:!0});if(o)throw o;return i||[]}catch(r){return console.error("Error searching templates:",r),[]}})()}extractInputFields(t){const e=[],r=new Set;let n;const i=y=>y.trim().toLowerCase().replace(/\s+/g," "),o=/\{\{([^}]+)\}\}/g;for(;null!==(n=o.exec(t));){const d=(n[1]||"").trim().split("|")[0].trim(),v=i(d);v&&!r.has(v)&&(r.add(v),e.push(d))}const p=/\[([^\]]+)\]/g;for(;null!==(n=p.exec(t));){const y=(n[1]||"").trim(),d=i(y);d&&!r.has(d)&&(r.add(d),e.push(y))}return e.filter(y=>{const d=(y||"").trim();return!(!d||d.length>80||d.includes("\n")||d.includes("|")||d.includes("<")||d.includes(">")||d.startsWith("http")||d.split(/\s+/).filter(Boolean).length>6||!/[a-zA-Z]/.test(d))})}getInputFields(t){return this.extractInputFields(t)}extractFieldNamesFromTemplate(t){const e=[];t.input_fields&&Array.isArray(t.input_fields)&&t.input_fields.forEach(o=>{"string"==typeof o?e.push(o.trim()):o&&"object"==typeof o&&o.name&&e.push(o.name.trim())});const r=this.extractInputFields(t.prompt_text||""),n=new Set,i=[];return[...e,...r].forEach(o=>{const p=o.toLowerCase().trim().replace(/\s+/g," ");!n.has(p)&&o.trim()&&(n.add(p),i.push(o.trim()))}),e.length+r.length!==i.length&&console.log(`Field extraction for "${t.name}": Found ${i.length} unique fields from ${e.length+r.length} total`),i}fillTemplate(t,e){const r=o=>o.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");let n=t;const i=e||{};for(const o of Object.keys(i)){const p=i[o]??`{{${o}}}`,h=Array.from(new Set([String(o),String(o).trim(),String(o).replace(/\s+/g,"_"),String(o).replace(/_/g," ")]));for(const y of h){const d=r(y),v=new RegExp(`\\{\\{\\s*${d}(?:[^}]*)\\}\\}`,"gi"),E=new RegExp(`\\[\\s*${d}\\s*\\]`,"gi");n=n.replace(v,p).replace(E,p)}}return n}getUniqueFamilyTypes(){var t=this;return(0,a.A)(function*(){try{console.log(" Loading family types from Supabase...");const e=(0,_.b)(),{data:r,error:n}=yield e.from("prompt_templates").select("family_type").eq("status","active");if(n)throw console.error(" Family types query error:",n),n;const i=[...new Set((r||[]).map(p=>p.family_type))];console.log(" Found family types:",i);const o=i.map(p=>({label:t.formatFamilyLabel(p),value:p}));return console.log(" Formatted families:",o),o}catch(e){return console.error(" Error getting unique family types:",e),[{label:"Hedge Accounting",value:"hedge_accounting"},{label:"Risk Management",value:"risk_management"}]}})()}getTemplateCategoriesByFamily(t){var e=this;return(0,a.A)(function*(){try{console.log(` Loading categories for family: ${t}`);const r=(0,_.b)(),{data:n,error:i}=yield r.from("prompt_templates").select("template_category").eq("family_type",t).eq("status","active");if(i)throw console.error(" Categories query error:",i),i;const o=[...new Set((n||[]).map(h=>h.template_category))];console.log(` Found categories for ${t}:`,o);const p=o.map(h=>({label:e.formatCategoryLabel(h),value:h}));return console.log(" Formatted categories:",p),p}catch(r){return console.error(" Error getting template categories:",r),[]}})()}formatFamilyLabel(t){return{hedge_accounting:"Hedge Accounting",risk_management:"Risk Management",compliance:"Compliance",reporting:"Reporting",analysis:"Analysis",operations:"Operations","Instructions & Processing":"Instructions & Processing","Risk & Compliance":"Risk & Compliance","Analysis & Reporting":"Analysis & Reporting","Problem Resolution":"Problem Resolution","Configuration & Setup":"Configuration & Setup","Monitoring & Status":"Monitoring & Status"}[t]||this.formatCategoryLabel(t)}formatCategoryLabel(t){return t.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())}static{this.\u0275fac=function(e){return new(e||g)}}static{this.\u0275prov=m.jDH({token:g,factory:g.\u0275fac,providedIn:"root"})}}return g})()},6806:(b,f,l)=>{l.d(f,{G:()=>m});var a=l(467),u=l(7129),_=l(4438);let m=(()=>{class c{createSession(s,t,e,r,n){return(0,a.A)(function*(){const i={msg_uid:t,instruction_id:e,user_id:"test-user",session_type:"agent"===r?"agent":"template",agent_status:"pending",template_category:r||"template",template_index:n||1,metadata:{prompt_text:s}};console.log("\u{1f680} Creating session with payload:",i);try{const o=(0,u.b)();console.log("\u{1f4e1} Supabase client initialized:",!!o);const{data:p,error:h}=yield o.from("hawk_agent_sessions").upsert([i],{onConflict:"msg_uid"}).select();if(console.log("\u2705 Supabase upsert result:",{data:p,error:h}),h)throw console.error("\u274c Supabase error details:",{message:h.message,details:h.details,hint:h.hint,code:h.code}),h;console.log("\u2705 Session created successfully:",p)}catch(o){console.error("\u274c createSession: Failed to save to Supabase:",o),console.error("\u{1f50d} Check if hawk_agent_sessions table exists and has correct permissions"),console.error("\u{1f4ca} Payload that failed:",i),console.error("\u{1f517} Full error object:",JSON.stringify(o,null,2))}return{msg_uid:t,instruction_id:e,user_id:"test-user",session_type:"agent"===r?"agent":"template",agent_status:"pending",template_category:r||"template",template_index:n||1,metadata:{prompt_text:s},created_at:(new Date).toISOString()}})()}getSessions(){return(0,a.A)(function*(){try{const s=(0,u.b)(),{data:t,error:e}=yield s.from("hawk_agent_sessions").select("*").order("created_at",{ascending:!1});if(e)throw e;return t||[]}catch(s){return console.error("\u274c getSessions: Failed to fetch from Supabase:",s),console.error("\u{1f50d} Check if hawk_agent_sessions table exists and has correct permissions"),[]}})()}updateSession(s,t){return(0,a.A)(function*(){try{const e=(0,u.b)(),{error:r}=yield e.from("hawk_agent_sessions").update(t).eq("msg_uid",s);if(r)throw r}catch(e){console.warn("updateSession: non-fatal error:",e)}})()}static{this.\u0275fac=function(t){return new(t||c)}}static{this.\u0275prov=_.jDH({token:c,factory:c.\u0275fac,providedIn:"root"})}}return c})()},285:(b,f,l)=>{l.d(f,{M:()=>m});var a=l(467),u=l(7129),_=l(4438);let m=(()=>{class c{constructor(){this.table="hedge_business_events"}list(s){var t=this;return(0,a.A)(function*(){try{let r=(0,u.b)().from(t.table).select("*").order("created_date",{ascending:!1});if(r=r.limit(s?.limit?s.limit:1e3),s?.search?.trim()){const o=s.search.trim();r=r.or(`event_id.ilike.%${o}%,instruction_id.ilike.%${o}%,event_type.ilike.%${o}%,event_status.ilike.%${o}%,assigned_booking_model.ilike.%${o}%`)}s?.status&&(r=r.eq("event_status",s.status)),s?.fromDate&&(r=r.gte("created_date",s.fromDate)),s?.toDate&&(r=r.lte("created_date",s.toDate));const{data:n,error:i}=yield r;if(i)throw i;return n||[]}catch(e){return console.error("Failed to load hedge_business_events",e),[]}})()}subscribeRealtime(s){try{const t=(0,u.b)();this.channel=t.channel("hedge_business_events_changes").on("postgres_changes",{event:"*",schema:"public",table:this.table},()=>s()).subscribe()}catch(t){console.warn("Realtime subscription unavailable for hedge_business_events",t)}}add(s){var t=this;return(0,a.A)(function*(){const e=(0,u.b)(),{error:r}=yield e.from(t.table).insert([s]);if(r)throw r})()}updateById(s,t){var e=this;return(0,a.A)(function*(){const r=(0,u.b)(),{error:n}=yield r.from(e.table).update(t).eq("event_id",s);if(n)throw n})()}deleteById(s){var t=this;return(0,a.A)(function*(){const e=(0,u.b)(),{error:r}=yield e.from(t.table).delete().eq("event_id",s);if(r)throw r})()}unsubscribeRealtime(){this.channel&&((0,u.b)().removeChannel(this.channel),this.channel=null)}static{this.\u0275fac=function(t){return new(t||c)}}static{this.\u0275prov=_.jDH({token:c,factory:c.\u0275fac,providedIn:"root"})}}return c})()},2242:(b,f,l)=>{l.d(f,{S:()=>c,u:()=>g});var a=l(4438),u=l(177),_=l(4341),m=l(5779);let c=(()=>{class s{el;ngModel;cd;config;variant="outlined";filled;constructor(e,r,n,i){this.el=e,this.ngModel=r,this.cd=n,this.config=i}ngAfterViewInit(){this.updateFilledState(),this.cd.detectChanges()}ngDoCheck(){this.updateFilledState()}onInput(){this.updateFilledState()}updateFilledState(){this.filled=this.el.nativeElement.value&&this.el.nativeElement.value.length||this.ngModel&&this.ngModel.model}static \u0275fac=function(r){return new(r||s)(a.rXU(a.aKT),a.rXU(_.vS,8),a.rXU(a.gRc),a.rXU(m.r1))};static \u0275dir=a.FsC({type:s,selectors:[["","pInputText",""]],hostAttrs:[1,"p-inputtext","p-component","p-element"],hostVars:4,hostBindings:function(r,n){1&r&&a.bIt("input",function(o){return n.onInput(o)}),2&r&&a.AVh("p-filled",n.filled)("p-variant-filled","filled"===n.variant||"filled"===n.config.inputStyle())},inputs:{variant:"variant"}})}return s})(),g=(()=>{class s{static \u0275fac=function(r){return new(r||s)};static \u0275mod=a.$C({type:s});static \u0275inj=a.G2t({imports:[u.MD]})}return s})()}}]);