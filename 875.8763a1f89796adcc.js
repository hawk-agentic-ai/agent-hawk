"use strict";(self.webpackChunkhedge_accounting_sfx=self.webpackChunkhedge_accounting_sfx||[]).push([[875],{4875:(Dt,S,m)=>{m.r(S),m.d(S,{EnhancedPromptTemplatesV2Component:()=>St});var h=m(467),y=m(177),f=m(4341),e=m(4438);function U(i,a){if(1&i&&(e.j41(0,"option",10),e.EFF(1),e.k0s()),2&i){const t=a.$implicit;e.Y8G("value",t.value),e.R7$(),e.JRh(t.label)}}function X(i,a){if(1&i){const t=e.RV6();e.j41(0,"div")(1,"label",2),e.EFF(2,"Family"),e.k0s(),e.j41(3,"select",7),e.bIt("ngModelChange",function(s){e.eBV(t);const r=e.XpG();return e.Njj(r.familyChange.emit(s))}),e.j41(4,"option",8),e.EFF(5,"All"),e.k0s(),e.DNE(6,U,2,2,"option",9),e.k0s()()}if(2&i){const t=e.XpG();e.R7$(3),e.Y8G("ngModel",t.selectedFamily),e.R7$(3),e.Y8G("ngForOf",t.families)}}function L(i,a){if(1&i){const t=e.RV6();e.j41(0,"button",11),e.bIt("click",function(){const s=e.eBV(t).$implicit,r=e.XpG();return e.Njj(r.categoryChange.emit(s.value))}),e.j41(1,"span",12),e.EFF(2),e.k0s(),e.j41(3,"span",13),e.EFF(4),e.k0s()()}if(2&i){const t=a.$implicit,n=e.XpG();e.AVh("bg-blue-50",n.selectedCategory===t.value),e.R7$(2),e.JRh(t.label),e.R7$(2),e.JRh(t.count)}}let Y=(()=>{class i{constructor(){this.families=[],this.categories=[],this.selectedFamily="",this.selectedCategory="",this.search="",this.hideFamily=!1,this.familyChange=new e.bkB,this.categoryChange=new e.bkB,this.searchChange=new e.bkB}get categoriesTotal(){return this.categories.reduce((t,n)=>t+(n.count||0),0)}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["app-pt-filters"]],inputs:{families:"families",categories:"categories",selectedFamily:"selectedFamily",selectedCategory:"selectedCategory",search:"search",hideFamily:"hideFamily"},outputs:{familyChange:"familyChange",categoryChange:"categoryChange",searchChange:"searchChange"},standalone:!0,features:[e.aNF],decls:11,vars:3,consts:[[1,"space-y-3"],[4,"ngIf"],[1,"block","text-xs","font-medium","text-gray-600","mb-1"],["type","text","placeholder","Search templates...",1,"filter-input","w-full",3,"ngModelChange","ngModel"],[1,"block","text-xs","font-medium","text-gray-600","mb-2"],[1,"space-y-1","max-h-[320px]","overflow-y-auto","pr-1"],["class","w-full px-3 py-2 rounded text-left text-sm hover:bg-gray-50",3,"bg-blue-50","click",4,"ngFor","ngForOf"],[1,"filter-input","w-full",3,"ngModelChange","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"w-full","px-3","py-2","rounded","text-left","text-sm","hover:bg-gray-50",3,"click"],[1,"mr-2"],[1,"text-xs","text-gray-500"]],template:function(n,s){1&n&&(e.j41(0,"div",0),e.DNE(1,X,7,2,"div",1),e.j41(2,"div")(3,"label",2),e.EFF(4,"Search"),e.k0s(),e.j41(5,"input",3),e.bIt("ngModelChange",function(o){return s.searchChange.emit(o)}),e.k0s()(),e.j41(6,"div")(7,"label",4),e.EFF(8,"Categories"),e.k0s(),e.j41(9,"div",5),e.DNE(10,L,5,4,"button",6),e.k0s()()()),2&n&&(e.R7$(),e.Y8G("ngIf",!s.hideFamily),e.R7$(4),e.Y8G("ngModel",s.search),e.R7$(5),e.Y8G("ngForOf",s.categories))},dependencies:[y.MD,y.Sq,y.bT,f.YN,f.xH,f.y7,f.me,f.wz,f.BC,f.vS],encapsulation:2})}}return i})();function K(i,a){if(1&i&&(e.j41(0,"span",12),e.EFF(1),e.k0s()),2&i){const t=e.XpG(),n=t.$implicit,s=t.index,r=e.XpG();e.R7$(),e.SpI("",r.getSuccess(n,s),"% success")}}function z(i,a){if(1&i&&(e.j41(0,"span",13),e.EFF(1),e.k0s()),2&i){const t=e.XpG().$implicit;e.R7$(),e.SpI("Dynamic (",(null==t.input_fields?null:t.input_fields.length)||0,")")}}function J(i,a){if(1&i&&(e.j41(0,"span",14),e.EFF(1),e.k0s()),2&i){const t=e.XpG().$implicit;e.R7$(),e.SpI("",t.usage_count," uses")}}function W(i,a){if(1&i){const t=e.RV6();e.j41(0,"div",3),e.bIt("click",function(){const s=e.eBV(t).index,r=e.XpG();return e.Njj(r.select.emit(s))}),e.j41(1,"div",4)(2,"div",5),e.EFF(3),e.k0s(),e.j41(4,"span",6),e.EFF(5),e.k0s()(),e.j41(6,"div",7),e.EFF(7),e.k0s(),e.j41(8,"div",8),e.DNE(9,K,2,1,"span",9)(10,z,2,1,"span",10)(11,J,2,1,"span",11),e.k0s()()}if(2&i){const t=a.$implicit,n=a.index,s=e.XpG();e.AVh("border-blue-500",s.selectedIndex===n),e.R7$(3),e.JRh(t.name),e.R7$(2),e.JRh(t.template_category),e.R7$(2),e.JRh(t.description||t.prompt_text),e.R7$(2),e.Y8G("ngIf",null!=s.getSuccess(t,n)),e.R7$(),e.Y8G("ngIf",null==t.input_fields?null:t.input_fields.length),e.R7$(),e.Y8G("ngIf",null!=t.usage_count)}}function q(i,a){1&i&&(e.j41(0,"div",15),e.EFF(1,"No templates found"),e.k0s())}let Z=(()=>{class i{constructor(){this.templates=[],this.selectedIndex=-1,this.successMap={},this.select=new e.bkB}getSuccess(t,n){return this.successMap[t.id||`idx:${n}`]??null}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["app-pt-card-list"]],inputs:{templates:"templates",selectedIndex:"selectedIndex",successMap:"successMap"},outputs:{select:"select"},standalone:!0,features:[e.aNF],decls:3,vars:2,consts:[[1,"grid","gap-3"],["class","border rounded-md p-3 hover:border-blue-300 cursor-pointer transition-colors",3,"border-blue-500","click",4,"ngFor","ngForOf"],["class","text-sm text-gray-500 p-4 text-center border rounded",4,"ngIf"],[1,"border","rounded-md","p-3","hover:border-blue-300","cursor-pointer","transition-colors",3,"click"],[1,"flex","items-center","justify-between"],[1,"text-sm","font-medium","text-gray-900","truncate"],[1,"text-xs","px-2","py-0.5","rounded-full","bg-gray-100","text-gray-700"],[1,"text-xs","text-gray-600","mt-1","line-clamp-2"],[1,"mt-2","flex","items-center","gap-2"],["class","text-[11px] px-2 py-0.5 rounded-full bg-green-50 text-green-700",4,"ngIf"],["class","text-[11px] px-2 py-0.5 rounded-full bg-blue-50 text-blue-700",4,"ngIf"],["class","text-[11px] px-2 py-0.5 rounded-full bg-purple-50 text-purple-700",4,"ngIf"],[1,"text-[11px]","px-2","py-0.5","rounded-full","bg-green-50","text-green-700"],[1,"text-[11px]","px-2","py-0.5","rounded-full","bg-blue-50","text-blue-700"],[1,"text-[11px]","px-2","py-0.5","rounded-full","bg-purple-50","text-purple-700"],[1,"text-sm","text-gray-500","p-4","text-center","border","rounded"]],template:function(n,s){1&n&&(e.j41(0,"div",0),e.DNE(1,W,12,8,"div",1)(2,q,2,0,"div",2),e.k0s()),2&n&&(e.R7$(),e.Y8G("ngForOf",s.templates),e.R7$(),e.Y8G("ngIf",!(null!=s.templates&&s.templates.length)))},dependencies:[y.MD,y.Sq,y.bT],encapsulation:2})}}return i})();var R=m(7673),Q=m(8359);class ee extends Q.yU{constructor(a,t){super()}schedule(a,t=0){return this}}const w={setInterval(i,a,...t){const{delegate:n}=w;return n?.setInterval?n.setInterval(i,a,...t):setInterval(i,a,...t)},clearInterval(i){const{delegate:a}=w;return(a?.clearInterval||clearInterval)(i)},delegate:void 0};var te=m(7908);const I={now:()=>(I.delegate||Date).now(),delegate:void 0};class T{constructor(a,t=T.now){this.schedulerActionCtor=a,this.now=t}schedule(a,t=0,n){return new this.schedulerActionCtor(this,a).schedule(n,t)}}T.now=I.now;const A=new class se extends T{constructor(a,t=T.now){super(a,t),this.actions=[],this._active=!1}flush(a){const{actions:t}=this;if(this._active)return void t.push(a);let n;this._active=!0;do{if(n=a.execute(a.state,a.delay))break}while(a=t.shift());if(this._active=!1,n){for(;a=t.shift();)a.unsubscribe();throw n}}}(class ne extends ee{constructor(a,t){super(a,t),this.scheduler=a,this.work=t,this.pending=!1}schedule(a,t=0){var n;if(this.closed)return this;this.state=a;const s=this.id,r=this.scheduler;return null!=s&&(this.id=this.recycleAsyncId(r,s,t)),this.pending=!0,this.delay=t,this.id=null!==(n=this.id)&&void 0!==n?n:this.requestAsyncId(r,this.id,t),this}requestAsyncId(a,t,n=0){return w.setInterval(a.flush.bind(a,this),n)}recycleAsyncId(a,t,n=0){if(null!=n&&this.delay===n&&!1===this.pending)return t;null!=t&&w.clearInterval(t)}execute(a,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const n=this._execute(a,t);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(a,t){let s,n=!1;try{this.work(a)}catch(r){n=!0,s=r||new Error("Scheduled action threw falsy error")}if(n)return this.unsubscribe(),s}unsubscribe(){if(!this.closed){const{id:a,scheduler:t}=this,{actions:n}=t;this.work=this.state=this.scheduler=null,this.pending=!1,(0,te.o)(n,this),null!=a&&(this.id=this.recycleAsyncId(t,a,null)),this.delay=null,super.unsubscribe()}}}),re=A;var ie=m(8793),$=m(6697),oe=m(9974),ae=m(4360),le=m(5343),de=m(3703),pe=m(1397),ue=m(8750);function M(i,a){return a?t=>(0,ie.x)(a.pipe((0,$.s)(1),function ce(){return(0,oe.N)((i,a)=>{i.subscribe((0,ae._)(a,le.l))})}()),t.pipe(M(i))):(0,pe.Z)((t,n)=>(0,ue.Tg)(i(t,n)).pipe((0,$.s)(1),(0,de.u)(t)))}var ge=m(1985),me=m(9470);function P(i,a=A){const t=function fe(i=0,a,t=re){let n=-1;return null!=a&&((0,me.m)(a)?t=a:n=a),new ge.c(s=>{let r=function he(i){return i instanceof Date&&!isNaN(i)}(i)?+i-t.now():i;r<0&&(r=0);let o=0;return t.schedule(function(){s.closed||(s.next(o++),0<=n?this.schedule(void 0,n):s.complete())},r)})}(i,a);return M(()=>t)}var D=m(6354),_e=m(1626);let ye=(()=>{class i{constructor(t){this.http=t,this.mockCurrencyConfig=[{id:"1",currencyCode:"SGD",currencyName:"Singapore Dollar",isActive:!0,priority:1},{id:"2",currencyCode:"USD",currencyName:"US Dollar",isActive:!0,priority:2},{id:"3",currencyCode:"EUR",currencyName:"Euro",isActive:!0,priority:3},{id:"4",currencyCode:"GBP",currencyName:"British Pound",isActive:!0,priority:4},{id:"5",currencyCode:"JPY",currencyName:"Japanese Yen",isActive:!0,priority:5},{id:"6",currencyCode:"AUD",currencyName:"Australian Dollar",isActive:!0,priority:6},{id:"7",currencyCode:"HKD",currencyName:"Hong Kong Dollar",isActive:!0,priority:7},{id:"8",currencyCode:"CNY",currencyName:"Chinese Yuan",isActive:!0,priority:8},{id:"9",currencyCode:"INR",currencyName:"Indian Rupee",isActive:!0,priority:9},{id:"10",currencyCode:"KRW",currencyName:"South Korean Won",isActive:!0,priority:10},{id:"11",currencyCode:"TWD",currencyName:"Taiwan Dollar",isActive:!0,priority:11},{id:"12",currencyCode:"THB",currencyName:"Thai Baht",isActive:!0,priority:12},{id:"13",currencyCode:"MYR",currencyName:"Malaysian Ringgit",isActive:!0,priority:13},{id:"14",currencyCode:"CAD",currencyName:"Canadian Dollar",isActive:!0,priority:14},{id:"15",currencyCode:"CHF",currencyName:"Swiss Franc",isActive:!0,priority:15}]}getCurrencyCodes(){return(0,R.of)(this.mockCurrencyConfig).pipe(P(300),(0,D.T)(t=>t.filter(n=>n.isActive).sort((n,s)=>n.priority-s.priority).map(n=>n.currencyCode)))}getCurrencyConfigs(){return(0,R.of)(this.mockCurrencyConfig).pipe(P(300),(0,D.T)(t=>t.filter(n=>n.isActive)))}static{this.\u0275fac=function(n){return new(n||i)(e.KVO(_e.Qq))}}static{this.\u0275prov=e.jDH({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var ve=m(2316),G=m(4885),be=m(285);function xe(i,a){if(1&i&&(e.j41(0,"option",26),e.EFF(1),e.k0s()),2&i){const t=a.$implicit;e.Y8G("value",t),e.R7$(),e.JRh(t)}}function ke(i,a){if(1&i&&(e.qex(0),e.DNE(1,xe,2,2,"option",25),e.bVm()),2&i){const t=e.XpG(5);e.R7$(),e.Y8G("ngForOf",t.currencyOptions)}}function Ce(i,a){if(1&i&&(e.j41(0,"option",26),e.EFF(1),e.k0s()),2&i){const t=a.$implicit;e.Y8G("value",t.value),e.R7$(),e.JRh(t.label)}}function Te(i,a){if(1&i&&(e.qex(0),e.DNE(1,Ce,2,2,"option",25),e.bVm()),2&i){const t=e.XpG(6);e.R7$(),e.Y8G("ngForOf",t.entityTypeOptions)}}function we(i,a){if(1&i&&(e.j41(0,"option",26),e.EFF(1),e.k0s()),2&i){const t=a.$implicit;e.Y8G("value",t.value),e.R7$(),e.JRh(t.label)}}function Fe(i,a){if(1&i&&(e.qex(0),e.DNE(1,we,2,2,"option",25),e.bVm()),2&i){const t=e.XpG(7);e.R7$(),e.Y8G("ngForOf",t.eventIdOptions)}}function Ee(i,a){if(1&i&&(e.j41(0,"option",26),e.EFF(1),e.k0s()),2&i){const t=a.$implicit,n=e.XpG(5).$implicit,s=e.XpG(3);e.Y8G("value",s.entityOptionValueFor(n,t)),e.R7$(),e.JRh(t.label)}}function je(i,a){if(1&i&&e.DNE(0,Ee,2,2,"option",25),2&i){const t=e.XpG(7);e.Y8G("ngForOf",t.entityOptions)}}function Se(i,a){if(1&i&&e.DNE(0,Fe,2,1,"ng-container",11)(1,je,1,1,"ng-template",null,5,e.C5r),2&i){const t=e.sdS(2),n=e.XpG(3).$implicit,s=e.XpG(3);e.Y8G("ngIf",s.isEventIdField(n))("ngIfElse",t)}}function Re(i,a){if(1&i&&e.DNE(0,Te,2,1,"ng-container",11)(1,Se,3,2,"ng-template",null,4,e.C5r),2&i){const t=e.sdS(2),n=e.XpG(2).$implicit,s=e.XpG(3);e.Y8G("ngIf",s.isEntityTypeField(n))("ngIfElse",t)}}function Ie(i,a){if(1&i){const t=e.RV6();e.qex(0),e.j41(1,"select",23),e.mxI("ngModelChange",function(s){e.eBV(t);const r=e.XpG().$implicit,o=e.XpG(3);return e.DH7(o.values[r],s)||(o.values[r]=s),e.Njj(s)}),e.bIt("ngModelChange",function(){e.eBV(t);const s=e.XpG(4);return e.Njj(s.computeFilled())}),e.j41(2,"option",24),e.EFF(3,"-- Select --"),e.k0s(),e.DNE(4,ke,2,1,"ng-container",11)(5,Re,3,2,"ng-template",null,3,e.C5r),e.k0s(),e.bVm()}if(2&i){const t=e.sdS(6),n=e.XpG().$implicit,s=e.XpG(3);e.R7$(),e.R50("ngModel",s.values[n]),e.R7$(3),e.Y8G("ngIf",s.isCurrencyField(n))("ngIfElse",t)}}function Ae(i,a){if(1&i){const t=e.RV6();e.j41(0,"input",27),e.mxI("ngModelChange",function(s){e.eBV(t);const r=e.XpG().$implicit,o=e.XpG(3);return e.DH7(o.values[r],s)||(o.values[r]=s),e.Njj(s)}),e.bIt("ngModelChange",function(){e.eBV(t);const s=e.XpG(4);return e.Njj(s.computeFilled())}),e.k0s()}if(2&i){const t=e.XpG().$implicit,n=e.XpG(3);e.Y8G("type",n.getType(t)),e.R50("ngModel",n.values[t]),e.Y8G("placeholder",n.getPlaceholder(t))}}function $e(i,a){if(1&i&&(e.j41(0,"label",21)(1,"span",22),e.EFF(2),e.k0s(),e.DNE(3,Ie,7,3,"ng-container",11)(4,Ae,1,3,"ng-template",null,2,e.C5r),e.k0s()),2&i){const t=a.$implicit,n=e.sdS(5),s=e.XpG(3);e.R7$(2),e.JRh(t),e.R7$(),e.Y8G("ngIf",s.isSelect(t))("ngIfElse",n)}}function Me(i,a){if(1&i&&(e.j41(0,"div")(1,"div",12),e.EFF(2,"Input Parameters"),e.k0s(),e.j41(3,"div",19),e.DNE(4,$e,6,3,"label",20),e.k0s()()),2&i){const t=e.XpG(2);e.R7$(4),e.Y8G("ngForOf",t.fields)}}function Pe(i,a){1&i&&(e.j41(0,"div",28),e.EFF(1,"No input parameters detected from the prompt."),e.k0s())}function De(i,a){1&i&&(e.j41(0,"div",29),e.nrm(1,"div",30),e.j41(2,"span",31),e.EFF(3,"Streaming..."),e.k0s()())}function Ge(i,a){if(1&i){const t=e.RV6();e.qex(0),e.j41(1,"div")(2,"div",12),e.EFF(3,"Prompt Text (live)"),e.k0s(),e.j41(4,"pre",13),e.EFF(5),e.k0s()(),e.DNE(6,Me,5,1,"div",11)(7,Pe,2,0,"ng-template",null,1,e.C5r),e.j41(9,"div",14)(10,"div",15),e.DNE(11,De,4,0,"div",16),e.j41(12,"button",17),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.send())}),e.nrm(13,"i",18),e.j41(14,"span"),e.EFF(15,"Submit"),e.k0s()()()(),e.bVm()}if(2&i){const t=e.sdS(8),n=e.XpG();e.R7$(5),e.JRh(n.filledPrompt||(n.template?n.template.prompt_text:"")),e.R7$(),e.Y8G("ngIf",null==n.fields?null:n.fields.length)("ngIfElse",t),e.R7$(5),e.Y8G("ngIf",n.streaming),e.R7$(),e.Y8G("disabled",n.streaming)}}function Ve(i,a){1&i&&(e.j41(0,"div",8),e.EFF(1,"Choose a template to see details."),e.k0s())}let He=(()=>{class i{send(){this.onSend.emit({text:this.filledPrompt||this.template?.prompt_text||"",values:this.values})}getType(t){const n=(t||"").toLowerCase();return n.includes("date")?"date":n.includes("amount")||n.includes("qty")||n.includes("quantity")||n.includes("rate")?"number":"text"}getPlaceholder(t){const n=(t||"").toLowerCase(),s=n.replace(/\s+/g,"_");return n.includes("date")?"YYYY-MM-DD":n.includes("currency")?"e.g., USD":n.includes("amount")||n.includes("qty")||n.includes("quantity")?"e.g., 100000":n.includes("rate")?"e.g., 0.05":s.includes("entity_type")||n.includes("entity_type")?"e.g., Branch":n.includes("entity")?"e.g., Entity A":`Enter ${t}`}isSelect(t){const n=(t||"").toLowerCase(),s=n.replace(/\s+/g,"_");return n.includes("currency")||"entity"===n||s.includes("entity_id")||s.includes("entity_code")||s.includes("entity_name")||s.includes("entity_type")||n.includes("entity_type")||s.includes("event_id")||n.includes("event_id")}getSelectOptions(t){const n=(t||"").toLowerCase(),s=n.replace(/\s+/g,"_");return n.includes("currency")?this.currencyOptions:s.includes("entity_type")||n.includes("entity_type")?this.entityTypeOptions:"entity"===n||s.includes("entity_id")||s.includes("entity_code")||s.includes("entity_name")?this.entityOptions:[]}constructor(t,n,s,r,o){this.currencySvc=t,this.entitySvc=n,this.ptSvc=s,this.cdr=r,this.hedgeEventsSvc=o,this.template=null,this.fields=[],this.onSend=new e.bkB,this.responseText="",this.streaming=!1,this.values={},this.filledPrompt="",this.currencyOptions=[],this.entityOptions=[],this.entityTypeOptions=[],this.eventIdOptions=[],this.copied=!1}ngOnInit(){try{this.currencySvc.getCurrencyCodes().subscribe(t=>this.currencyOptions=t||[])}catch{}try{this.entitySvc.entities$.subscribe(t=>{const n=(t||[]).map(s=>({label:`${s.entity_name} (${s.legal_entity_code})`,value:s.legal_entity_code}));this.entityOptions=n})}catch{}this.entityTypeOptions=[{label:"Branch",value:"Branch"},{label:"Subsidiary",value:"Subsidiary"},{label:"Association",value:"Association"},{label:"TMU",value:"TMU"}],this.loadEventIds()}ngOnChanges(t){let n=!1;if(t.template){const s=t.template.previousValue,r=t.template.currentValue;s?.id!==r?.id&&(console.log("Template changed from",s?.name,"to",r?.name),this.values={},n=!0)}if(t.fields){const s=t.fields.previousValue||[],r=t.fields.currentValue||[];if(JSON.stringify(s)!==JSON.stringify(r)){console.log("Fields changed from",s,"to",r);const l={...this.values};r.forEach(c=>{c in l||(l[c]="")}),Object.keys(l).forEach(c=>{r.includes(c)||delete l[c]}),this.values=l,n=!0}}n&&this.computeFilled()}computeFilled(){const t=this.template?.prompt_text||"",n=this.values||{};if(!t)return void(this.filledPrompt="");const s={};Object.keys(n).forEach(r=>{const o=n[r]??"",l=String(r),c=l.trim(),d=c.toLowerCase(),p=c.replace(/\s+/g,"_"),u=c.replace(/_/g," "),_=d.replace(/\s+/g,"_"),g=d.replace(/_/g," ");[l,c,d,p,u,_,g].forEach(v=>{s[v]=o})}),this.filledPrompt=this.ptSvc.fillTemplate(t,s),(!this.filledPrompt||this.filledPrompt===t)&&(this.filledPrompt=this.manualFillTemplate(t,s)),console.log("Template filling:",{template:this.template?.name,originalText:t.substring(0,100)+"...",values:n,expanded:s,result:this.filledPrompt.substring(0,100)+"..."}),this.cdr.detectChanges()}manualFillTemplate(t,n){let s=t;return Object.keys(n).forEach(r=>{const o=n[r]||"";[new RegExp(`\\{\\{\\s*${this.escapeRegex(r)}\\s*\\}\\}`,"gi"),new RegExp(`\\[\\s*${this.escapeRegex(r)}\\s*\\]`,"gi")].forEach(c=>{s=s.replace(c,o)})}),s}escapeRegex(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}escapeReg(t){return t.replace(/[.*+?^${}()|[\\]\\]/g,"\\$&")}entityOptionValueFor(t,n){const s=(t||"").toLowerCase(),r=s.replace(/\s+/g,"_");return r.includes("entity_name")?n.label:r.includes("entity_code")||r.includes("entity_id")?n.value:"entity"===s?n.label:n.value}isCurrencyField(t){return(t||"").toLowerCase().includes("currency")}isEntityTypeField(t){const n=(t||"").toLowerCase();return n.replace(/\s+/g,"_").includes("entity_type")||n.includes("entity_type")}isEventIdField(t){const n=(t||"").toLowerCase();return n.replace(/\s+/g,"_").includes("event_id")||n.includes("event_id")}loadEventIds(){var t=this;return(0,h.A)(function*(){try{const n=yield t.hedgeEventsSvc.list({limit:1e3});t.eventIdOptions=n.map(s=>({label:`${s.event_id} (${s.event_type} - ${s.event_status})`,value:s.event_id||""})).filter(s=>s.value)}catch(n){console.error("Error loading event IDs:",n),t.eventIdOptions=[]}})()}static{this.\u0275fac=function(n){return new(n||i)(e.rXU(ye),e.rXU(ve.r),e.rXU(G.r),e.rXU(e.gRc),e.rXU(be.M))}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["app-pt-preview"]],inputs:{template:"template",fields:"fields",responseText:"responseText",streaming:"streaming"},outputs:{onSend:"onSend"},standalone:!0,features:[e.OA$,e.aNF],decls:10,vars:3,consts:[["empty",""],["noParams",""],["textField",""],["checkEntityType",""],["checkEventId",""],["entityOpts",""],[1,"h-full","flex","flex-col"],[1,"border-b","pb-2","mb-2"],[1,"text-sm","text-gray-500"],[1,"text-base","font-semibold","text-gray-900","truncate"],[1,"flex-1","min-h-0","overflow-auto","space-y-3"],[4,"ngIf","ngIfElse"],[1,"text-xs","text-gray-500","mb-1"],[1,"bg-gray-50","border","rounded","p-2","text-xs","whitespace-pre-wrap"],[1,"pt-2","mt-2","border-t","flex","items-center","justify-end"],[1,"flex","items-center","gap-2"],["class","flex items-center gap-2 mr-2",4,"ngIf"],[1,"btn-primary",3,"click","disabled"],[1,"pi","pi-send","text-xs"],[1,"grid","grid-cols-1","gap-2"],["class","text-xs",4,"ngFor","ngForOf"],[1,"text-xs"],[1,"block","text-[11px]","text-gray-600","mb-1"],[1,"filter-input","w-full",3,"ngModelChange","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"filter-input","w-full",3,"ngModelChange","type","ngModel","placeholder"],[1,"text-xs","text-gray-500"],[1,"flex","items-center","gap-2","mr-2"],[1,"animate-spin","rounded-full","h-4","w-4","border-b-2","border-blue-600"],[1,"text-xs","text-blue-700"]],template:function(n,s){if(1&n&&(e.j41(0,"div",6)(1,"div",7)(2,"div",8),e.EFF(3,"Template"),e.k0s(),e.j41(4,"div",9),e.EFF(5),e.k0s()(),e.j41(6,"div",10),e.DNE(7,Ge,16,5,"ng-container",11)(8,Ve,2,0,"ng-template",null,0,e.C5r),e.k0s()()),2&n){const r=e.sdS(9);e.R7$(5),e.JRh((null==s.template?null:s.template.name)||"Select a template"),e.R7$(2),e.Y8G("ngIf",s.template)("ngIfElse",r)}},dependencies:[y.MD,y.Sq,y.bT,f.YN,f.xH,f.y7,f.me,f.wz,f.BC,f.vS],encapsulation:2})}}return i})();var V=m(345);const Ne=()=>[1,2,3,4,5];function Be(i,a){1&i&&(e.j41(0,"div",33),e.nrm(1,"div",34),e.j41(2,"span",35),e.EFF(3,"Receiving response..."),e.k0s(),e.j41(4,"div",36),e.nrm(5,"div",37)(6,"div",38)(7,"div",39),e.k0s()())}function Oe(i,a){if(1&i){const t=e.RV6();e.j41(0,"button",40),e.bIt("click",function(){const s=e.eBV(t).$implicit,r=e.XpG();return e.Njj(r.rate.emit(s))}),e.nrm(1,"i",41),e.k0s()}if(2&i){const t=a.$implicit,n=e.XpG();e.HbH(t<=n.rating?"text-yellow-400 hover:text-yellow-500":"text-gray-300 hover:text-yellow-300")}}let Ue=(()=>{class i{constructor(t){this.sanitizer=t,this.responseText="",this.streaming=!1,this.rating=0,this.completion=null,this.feedback="",this.export=new e.bkB,this.ticket=new e.bkB,this.schedule=new e.bkB,this.share=new e.bkB,this.rate=new e.bkB,this.setCompletion=new e.bkB,this.feedbackChange=new e.bkB}getCleanResponse(){return this.responseText?this.responseText.split("\n\n---\n")[0]||this.responseText:""}getFormattedResponse(){if(!this.responseText)return this.sanitizer.bypassSecurityTrustHtml("");let t=this.responseText;t=t.replace(/data:\s*\{[^}]*"event"[^}]*\}/g,"").replace(/\{[^}]*"conversation_id"[^}]*\}/g,"").replace(/\\\\/g,"").replace(/\\n/g,"\n").replace(/\\/g,"").trim();let n=this.convertTablesToHtml(t);return n=n.split(/(<table[^>]*>.*?<\/table>)/gs).map((r,o)=>o%2==1&&r.includes("<table")?r:r.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/^([\ud83d\udd25\u26a1\u2705\ud83d\udcca\ud83d\udd0d\ud83d\udca1\u26a0\ufe0f\ud83d\ude80\ud83d\udcc8\ud83d\udcc9\ud83d\udcb0\ud83c\udfaf\ud83d\udd27\u2b50])\s*(.*$)/gm,'<div class="mb-2"><strong class="text-blue-600">$1</strong> $2</div>').replace(/^\*\s+(.*$)/gm,'<div class="ml-4">\u2022 $1</div>').replace(/^(\d+\.\s+)(.*$)/gm,'<div class="ml-4 mb-1"><strong>$1</strong>$2</div>').replace(/---\n/g,'<hr class="my-4 border-gray-300">').replace(/\n/g,"<br>")).join(""),this.sanitizer.bypassSecurityTrustHtml(n)}getResponseMetadata(){if(!this.responseText)return"";const t=this.responseText.split("\n\n---\n");return t.length>1?t[1].trim():""}convertTablesToHtml(t){let n=this.cleanStreamingData(t),s=this.parseJsonEmbeddedTables(n);return s=this.parseMarkdownTables(s),s=this.parseStructuredData(s),s=this.parseSpaceSeparatedTables(s),s}parseJsonEmbeddedTables(t){return t.replace(/\{[^}]*\"[^"]*\":\s*\[[^\]]*\][^}]*\}/g,n=>{try{const s=JSON.parse(n),r=Object.values(s).filter(l=>Array.isArray(l));if(r.length>0){const l=r[0];if(l.length>0&&"object"==typeof l[0])return this.buildJsonTable(l)}const o=Object.entries(s);if(o.length>=2)return this.buildKeyValueTable(o.map(([l,c])=>`${l}: ${c}`))}catch{}return n})}buildJsonTable(t){if(0===t.length)return"";const s=Object.keys(t[0]);let r='<table class="min-w-full divide-y divide-gray-200 border border-gray-300 rounded-lg overflow-hidden my-4">';return r+='<thead class="bg-gray-50"><tr>',s.forEach(o=>{r+=`<th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-200">${this.escapeHtml(o)}</th>`}),r+="</tr></thead>",r+='<tbody class="bg-white divide-y divide-gray-200">',t.forEach(o=>{r+='<tr class="hover:bg-gray-50">',s.forEach(l=>{r+=`<td class="px-4 py-3 text-sm text-gray-900 border-b border-gray-100">${this.escapeHtml(String(o[l]||""))}</td>`}),r+="</tr>"}),r+="</tbody></table>",r}cleanStreamingData(t){return t.replace(/data:\s*data:\s*\{[^}]*\}/g,"").replace(/data:\s*\{[^}]*\}/g,"").replace(/\{"event"[^}]*\}/g,"").replace(/\{[^}]*"conversation_id"[^}]*\}/g,"").replace(/\\n/g,"\n").replace(/\\"/g,'"').replace(/\\\\/g,"").replace(/^data:\s*$/gm,"").replace(/^\s*data:\s*$/gm,"").replace(/\n{3,}/g,"\n\n").trim()}parseMarkdownTables(t){const n=t.split("\n");let s="",r=[];for(let o=0;o<n.length;o++){const l=n[o].trim();if(l.startsWith("|")&&l.endsWith("|")&&l.split("|").length>=3){r.push(l);const c=o+1<n.length?n[o+1].trim():"",d=c.startsWith("|")&&c.endsWith("|");if(/^\|[\s\-:]+\|$/.test(c)){o++;continue}(!d||o===n.length-1)&&r.length>0&&(s+=this.buildMarkdownTableHtml(r)+"\n",r=[])}else r.length>0&&(s+=this.buildMarkdownTableHtml(r)+"\n",r=[]),s+=l+"\n"}return s}parseStructuredData(t){return t.replace(/^(\w+):\s*([^\n]+?)(\s{2,}(\w+):\s*([^\n]+?))*$/gm,n=>{const s=n.match(/(\w+):\s*([^\s]+)/g);return s&&s.length>=2?this.buildKeyValueTable(s):n})}parseSpaceSeparatedTables(t){const n=t.split("\n");let s="",r=[];for(let o=0;o<n.length;o++){const l=n[o].trim();if(this.looksLikeTableData(l)){r.push(l);const c=o+1<n.length?n[o+1].trim():"";(!this.looksLikeTableData(c)||o===n.length-1)&&(s+=r.length>=2?this.buildSpaceSeparatedTable(r)+"\n":r.join("\n")+"\n",r=[])}else r.length>=2?s+=this.buildSpaceSeparatedTable(r)+"\n":r.length>0&&(s+=r.join("\n")+"\n"),r=[],s+=l+"\n"}return s}looksLikeTableData(t){if(!t||t.length<10)return!1;const n=t.split(/\s{2,}/).filter(l=>l.trim().length>0);if(n.length<2)return!1;const s=n.some(l=>/\d/.test(l)),r=n.length>=3,o=/entity|currency|amount|rate|position|nav|allocation/i.test(t);return s&&r||o}buildMarkdownTableHtml(t){if(0===t.length)return"";let n='<table class="min-w-full divide-y divide-gray-200 border border-gray-300 rounded-lg overflow-hidden my-4">';const r=t[0].split("|").slice(1,-1).map(o=>o.trim());n+='<thead class="bg-gray-50"><tr>',r.forEach(o=>{n+=`<th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-200">${this.escapeHtml(o)}</th>`}),n+="</tr></thead>",n+='<tbody class="bg-white divide-y divide-gray-200">';for(let o=1;o<t.length;o++){const c=t[o].split("|").slice(1,-1).map(d=>d.trim());n+='<tr class="hover:bg-gray-50">',c.forEach(d=>{n+=`<td class="px-4 py-3 text-sm text-gray-900 border-b border-gray-100">${this.escapeHtml(d)}</td>`}),n+="</tr>"}return n+="</tbody></table>",n}buildKeyValueTable(t){let n='<table class="min-w-full divide-y divide-gray-200 border border-gray-300 rounded-lg overflow-hidden my-4">';return n+='<tbody class="bg-white divide-y divide-gray-200">',t.forEach(s=>{const[r,o]=s.split(":").map(l=>l.trim());n+='<tr class="hover:bg-gray-50">',n+=`<td class="px-4 py-3 text-sm font-medium text-gray-500 border-b border-gray-100">${this.escapeHtml(r)}</td>`,n+=`<td class="px-4 py-3 text-sm text-gray-900 border-b border-gray-100">${this.escapeHtml(o)}</td>`,n+="</tr>"}),n+="</tbody></table>",n}buildSpaceSeparatedTable(t){if(t.length<2)return t.join("\n");const n=this.analyzeColumns(t);if(n.length<2)return t.join("\n");let s='<table class="min-w-full divide-y divide-gray-200 border border-gray-300 rounded-lg overflow-hidden my-4">';const r=this.isLikelyHeader(t[0]);if(r){const l=this.splitIntoColumns(t[0],n);s+='<thead class="bg-gray-50"><tr>',l.forEach(c=>{s+=`<th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-200">${this.escapeHtml(c)}</th>`}),s+="</tr></thead>"}return s+='<tbody class="bg-white divide-y divide-gray-200">',(r?t.slice(1):t).forEach(l=>{const c=this.splitIntoColumns(l,n);s+='<tr class="hover:bg-gray-50">',c.forEach(d=>{s+=`<td class="px-4 py-3 text-sm text-gray-900 border-b border-gray-100">${this.escapeHtml(d)}</td>`}),s+="</tr>"}),s+="</tbody></table>",s}analyzeColumns(t){const n=new Set;return t.forEach(s=>{let r=0;for(;r<s.length;){const o=s.slice(r).match(/\s{2,}/);if(!o||void 0===o.index)break;n.add(r+o.index),r+=o.index+o[0].length}}),Array.from(n).sort((s,r)=>s-r)}splitIntoColumns(t,n){const s=[];let r=0;for(const o of n)o>r&&(s.push(t.slice(r,o).trim()),r=o);return r<t.length&&s.push(t.slice(r).trim()),s.filter(o=>o.length>0)}isLikelyHeader(t){const n=t.toLowerCase();return["entity","currency","amount","rate","position","nav","allocation","id","name","type","status"].some(r=>n.includes(r))}escapeHtml(t){const n=document.createElement("div");return n.textContent=t,n.innerHTML}copyResults(){if(!this.responseText||""===this.responseText.trim())return;let t=this.responseText.replace(/data:\s*\{[^}]*"event"[^}]*\}/g,"").replace(/\{[^}]*"conversation_id"[^}]*\}/g,"").replace(/\\\\/g,"").replace(/\\n/g,"\n").replace(/\\/g,"").replace(/\*\*(.*?)\*\*/g,"$1").trim();navigator.clipboard.writeText(t).then(()=>{console.log("Results copied to clipboard");const n=document.querySelector('[title="Copy results to clipboard"]');if(n){const s=n.innerHTML;n.innerHTML='<i class="pi pi-check text-xs"></i><span>Copied!</span>',n.classList.add("bg-green-100","text-green-700","border-green-300"),n.classList.remove("bg-gray-100","text-gray-700","border-gray-300"),setTimeout(()=>{n.innerHTML=s,n.classList.remove("bg-green-100","text-green-700","border-green-300"),n.classList.add("bg-gray-100","text-gray-700","border-gray-300")},2e3)}}).catch(n=>{console.error("Failed to copy to clipboard:",n);const s=document.createElement("textarea");s.value=t,s.style.position="fixed",s.style.left="-999999px",s.style.top="-999999px",document.body.appendChild(s),s.focus(),s.select();try{document.execCommand("copy"),console.log("Results copied to clipboard (fallback method)")}catch(r){console.error("Fallback copy failed:",r)}document.body.removeChild(s)})}static{this.\u0275fac=function(n){return new(n||i)(e.rXU(V.up))}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["app-pt-results"]],inputs:{responseText:"responseText",streaming:"streaming",rating:"rating",completion:"completion",feedback:"feedback"},outputs:{export:"export",ticket:"ticket",schedule:"schedule",share:"share",rate:"rate",setCompletion:"setCompletion",feedbackChange:"feedbackChange"},standalone:!0,features:[e.aNF],decls:57,vars:14,consts:[[1,"flex","flex-col","h-full"],[1,"px-2","py-1","border-b","border-gray-100","flex","items-center","justify-between"],[1,"text-sm","font-semibold","text-gray-900"],["title","Copy results to clipboard",1,"px-2","py-1","text-xs","bg-gray-100","hover:bg-gray-200","text-gray-700","rounded","border","border-gray-300","flex","items-center","gap-1","transition-colors",3,"click","disabled"],[1,"pi","pi-copy","text-xs"],[1,"flex-1","overflow-auto"],[1,"p-2"],[1,"text-gray-800","leading-relaxed","text-base","font-sans","w-full","prose","prose-base","max-w-none",2,"word-break","break-word","overflow-wrap","anywhere","max-width","100%","font-family","inherit","font-size","16px","line-height","1.6",3,"innerHTML"],["class","flex items-center gap-2 mt-3 p-3 bg-blue-50 rounded-lg border border-blue-200",4,"ngIf"],[1,"px-2","py-3","border-t","border-border","flex","flex-wrap","gap-3"],[1,"btn-secondary",3,"click"],[1,"pi","pi-download","text-xs"],[1,"pi","pi-ticket","text-xs"],[1,"pi","pi-calendar","text-xs"],[1,"pi","pi-share-alt","text-xs"],[1,"px-2","py-3","border-t","border-gray-100"],[1,"flex","items-center","justify-between"],[1,"flex-1"],[1,"text-sm","font-medium","text-gray-900","mb-2"],[1,"text-xs","text-gray-600","mb-3"],[1,"flex","items-center","gap-2"],[1,"flex","items-center","gap-1"],["class","text-lg transition-colors duration-200",3,"class","click",4,"ngFor","ngForOf"],[1,"flex","items-center","gap-2","ml-4"],[1,"px-3","py-1","text-xs","rounded-full","border","transition-colors",3,"click"],[1,"pi","pi-check-circle","mr-1"],[1,"pi","pi-times-circle","mr-1"],[1,"flex","items-center","gap-2","ml-4","border-l","border-gray-300","pl-4"],[1,"pi","pi-check","mr-1"],[1,"pi","pi-exclamation-triangle","mr-1"],[1,"mt-4"],[1,"block","text-xs","font-medium","text-gray-600","mb-1"],["rows","4","placeholder","Describe why the response was correct/incorrect, or any notes for improvement...",1,"filter-input","w-full",3,"ngModelChange","ngModel"],[1,"flex","items-center","gap-2","mt-3","p-3","bg-blue-50","rounded-lg","border","border-blue-200"],[1,"animate-spin","rounded-full","h-4","w-4","border-b-2","border-blue-600"],[1,"text-sm","text-blue-700","font-medium"],[1,"flex","gap-1","ml-2"],[1,"w-1","h-1","bg-blue-500","rounded-full","animate-pulse"],[1,"w-1","h-1","bg-blue-500","rounded-full","animate-pulse",2,"animation-delay","0.2s"],[1,"w-1","h-1","bg-blue-500","rounded-full","animate-pulse",2,"animation-delay","0.4s"],[1,"text-lg","transition-colors","duration-200",3,"click"],[1,"pi","pi-star-fill"]],template:function(n,s){1&n&&(e.j41(0,"div",0)(1,"div",1)(2,"h3",2),e.EFF(3,"Results"),e.k0s(),e.j41(4,"button",3),e.bIt("click",function(){return s.copyResults()}),e.nrm(5,"i",4),e.j41(6,"span"),e.EFF(7,"Copy"),e.k0s()()(),e.j41(8,"div",5)(9,"div",6),e.nrm(10,"div",7),e.DNE(11,Be,8,0,"div",8),e.k0s()(),e.j41(12,"div",9)(13,"button",10),e.bIt("click",function(){return s.export.emit()}),e.nrm(14,"i",11),e.j41(15,"span"),e.EFF(16,"Export Report"),e.k0s()(),e.j41(17,"button",10),e.bIt("click",function(){return s.ticket.emit()}),e.nrm(18,"i",12),e.j41(19,"span"),e.EFF(20,"Create Ticket"),e.k0s()(),e.j41(21,"button",10),e.bIt("click",function(){return s.schedule.emit()}),e.nrm(22,"i",13),e.j41(23,"span"),e.EFF(24,"Schedule Review"),e.k0s()(),e.j41(25,"button",10),e.bIt("click",function(){return s.share.emit()}),e.nrm(26,"i",14),e.j41(27,"span"),e.EFF(28,"Share"),e.k0s()()(),e.j41(29,"div",15)(30,"div",16)(31,"div",17)(32,"h4",18),e.EFF(33,"Rate this response"),e.k0s(),e.j41(34,"p",19),e.EFF(35,"Help improve template accuracy by rating the quality of this result"),e.k0s(),e.j41(36,"div",20)(37,"div",21),e.DNE(38,Oe,2,2,"button",22),e.k0s(),e.j41(39,"div",23)(40,"button",24),e.bIt("click",function(){return s.rate.emit(5)}),e.nrm(41,"i",25),e.EFF(42," Correct "),e.k0s(),e.j41(43,"button",24),e.bIt("click",function(){return s.rate.emit(1)}),e.nrm(44,"i",26),e.EFF(45," Incorrect "),e.k0s()(),e.j41(46,"div",27)(47,"button",24),e.bIt("click",function(){return s.setCompletion.emit("complete")}),e.nrm(48,"i",28),e.EFF(49," Complete "),e.k0s(),e.j41(50,"button",24),e.bIt("click",function(){return s.setCompletion.emit("incomplete")}),e.nrm(51,"i",29),e.EFF(52," Incomplete "),e.k0s()()(),e.j41(53,"div",30)(54,"label",31),e.EFF(55,"Reason / Feedback (optional)"),e.k0s(),e.j41(56,"textarea",32),e.bIt("ngModelChange",function(o){return s.feedbackChange.emit(o)}),e.k0s()()()()()()),2&n&&(e.R7$(4),e.Y8G("disabled",!s.responseText||""===s.responseText.trim()),e.R7$(6),e.Y8G("innerHTML",s.getFormattedResponse(),e.npT),e.R7$(),e.Y8G("ngIf",s.streaming),e.R7$(27),e.Y8G("ngForOf",e.lJ4(13,Ne)),e.R7$(2),e.HbH(s.rating>=4?"bg-green-100 text-green-700 border-green-300":"bg-gray-100 text-gray-600 border-gray-300 hover:bg-green-50"),e.R7$(3),e.HbH(s.rating<=2?"bg-red-100 text-red-700 border-red-300":"bg-gray-100 text-gray-600 border-gray-300 hover:bg-red-50"),e.R7$(4),e.HbH("complete"===s.completion?"bg-blue-100 text-blue-700 border-blue-300":"bg-gray-100 text-gray-600 border-gray-300 hover:bg-blue-50"),e.R7$(3),e.HbH("incomplete"===s.completion?"bg-orange-100 text-orange-700 border-orange-300":"bg-gray-100 text-gray-600 border-gray-300 hover:bg-orange-50"),e.R7$(6),e.Y8G("ngModel",s.feedback))},dependencies:[y.MD,y.Sq,y.bT,f.YN,f.me,f.BC,f.vS],styles:[".streaming-table[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slideIn .3s ease-out}.animate-fadeIn[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .5s ease-in forwards;opacity:0}@keyframes _ngcontent-%COMP%_slideIn{0%{transform:translateY(-10px);opacity:0}to{transform:translateY(0);opacity:1}}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translate(-5px)}to{opacity:1;transform:translate(0)}}.streaming-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{border-left:3px solid transparent;transition:border-color .3s ease}.streaming-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{border-left-color:#3b82f6;background-color:#f8fafc}.streaming-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr.animate-fadeIn[_ngcontent-%COMP%]{border-left-color:#10b981}"]})}}return i})();var F=m(4211);var Xe=m(6806),x=m(7129);let Le=(()=>{class i{createConversation(t,n,s){return(0,h.A)(function*(){const r={conversation_id:t,user_id:"test-user",title:s,messages:[{role:"user",content:n,timestamp:(new Date).toISOString()}],message_count:1,status:"active"};console.log("\u{1f680} Creating conversation:",t);try{const o=(0,x.b)(),{data:l,error:c}=yield o.from("hawk_agent_conversations").insert([r]).select().single();if(c)throw console.error("\u274c Error creating conversation:",c),c;return console.log("\u2705 Conversation created successfully:",l),l}catch(o){throw console.error("\u274c Failed to create conversation:",o),o}})()}addMessage(t,n,s){return(0,h.A)(function*(){try{const r=(0,x.b)(),{data:o,error:l}=yield r.from("hawk_agent_conversations").select("messages, message_count").eq("conversation_id",t).single();if(l||!o)throw console.error("\u274c Error fetching conversation:",l),l;s&&"assistant"===n.role&&(n.thinking_time=s);const c=[...o.messages,n],{error:d}=yield r.from("hawk_agent_conversations").update({messages:c,message_count:c.length,updated_at:(new Date).toISOString()}).eq("conversation_id",t);if(d)throw console.error("\u274c Error updating conversation:",d),d;console.log("\u2705 Message added to conversation:",t)}catch(r){throw console.error("\u274c Failed to add message:",r),r}})()}getConversations(){return(0,h.A)(function*(t="test-user"){try{const n=(0,x.b)(),{data:s,error:r}=yield n.from("hawk_agent_conversations").select("*").eq("user_id",t).eq("status","active").order("updated_at",{ascending:!1});if(r)throw console.error("\u274c Error fetching conversations:",r),r;return console.log(`\u2705 Loaded ${s?.length||0} conversations`),s||[]}catch(n){return console.error("\u274c Failed to load conversations:",n),[]}}).apply(this,arguments)}getConversation(t){return(0,h.A)(function*(){try{const n=(0,x.b)(),{data:s,error:r}=yield n.from("hawk_agent_conversations").select("*").eq("conversation_id",t).single();return r?(console.error("\u274c Error fetching conversation:",r),null):s}catch(n){return console.error("\u274c Failed to load conversation:",n),null}})()}deleteConversation(t){return(0,h.A)(function*(){try{const n=(0,x.b)(),{error:s}=yield n.from("hawk_agent_conversations").update({status:"archived",updated_at:(new Date).toISOString()}).eq("conversation_id",t);if(s)throw console.error("\u274c Error archiving conversation:",s),s;console.log("\u2705 Conversation archived:",t)}catch(n){throw console.error("\u274c Failed to archive conversation:",n),n}})()}searchConversations(t){return(0,h.A)(function*(n,s="test-user"){try{const r=(0,x.b)(),{data:o,error:l}=yield r.from("hawk_agent_conversations").select("*").eq("user_id",s).eq("status","active").or(`title.ilike.%${n}%,messages::text.ilike.%${n}%`).order("updated_at",{ascending:!1});if(l)throw console.error("\u274c Error searching conversations:",l),l;return console.log(`\u2705 Found ${o?.length||0} conversations matching "${n}"`),o||[]}catch(r){return console.error("\u274c Failed to search conversations:",r),[]}}).apply(this,arguments)}generateConversationTitle(t){if(!t)return"New Conversation";let n=t.length>60?t.substring(0,57)+"...":t;return n=n.replace(/\s+/g," ").trim(),n||"Untitled Conversation"}generateConversationId(){return"conv_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275prov=e.jDH({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var H=m(7488),Ye=m(4412);let Ke=(()=>{class i{constructor(){this.supabase=(0,x.b)(),this.cache=new Map,this.performanceMetricsSubject=new Ye.t(null),this.performanceMetrics$=this.performanceMetricsSubject.asObservable(),this.CACHE_TTL={static_config:144e5,currency_rates:864e5,entity_positions:72e5,hedge_data:18e5,prompt_context:9e5},setInterval(()=>this.cleanExpiredCache(),6e5)}fetchOptimizedHedgeData(t,n){var s=this;return(0,h.A)(function*(r,o,l={}){const c=Date.now(),d=!1!==l.useCache,p=s.analyzePromptRequirements(o);console.log(" Prompt Analysis:",p);const u=s.generateCacheKey("prompt_context",{currency:r,prompt:s.hashString(o),options:l});if(d){const g=s.getFromCache(u);if(g)return console.log(" Cache hit for optimized data"),{contextData:g,metrics:{total_time_ms:Date.now()-c,data_fetch_time_ms:0,context_prep_time_ms:5,dify_response_time_ms:0,data_reduction_percent:0,cache_used:!0}}}const _=Date.now();try{const g=[s.fetchEntities(r,l.currencyType,p),s.fetchPositions(r,l.navType,p),s.fetchCurrencyConfig(r)],[v,k,Rt]=yield Promise.all(g),N=s.extractEntityIds(v,k),B=[s.fetchAllocations(r,N,p),s.fetchHedgeInstruments(r,l,p),s.fetchCurrencyRates(r,p)];p.requires_recent_data&&B.push(s.fetchRecentHedgeEvents(N,p),s.fetchRecentInstructions(r,p));const C=yield Promise.all(B),It=Date.now()-_,At=Date.now(),O=s.estimateDataSize([v,k,C]),E=s.structureOptimizedContext({entities:v,positions:k,allocations:C[0]||[],hedge_instruments:C[1]||[],currency_rates:C[2]||[],recent_hedge_events:C[3]||[],recent_instructions:C[4]||[],currency_config:Rt},p),Mt=(O-s.estimateDataSize([E]))/O*100,Pt=Date.now()-At;d&&s.setCache(u,E,s.CACHE_TTL.prompt_context);const j={total_time_ms:Date.now()-c,data_fetch_time_ms:It,context_prep_time_ms:Pt,dify_response_time_ms:0,data_reduction_percent:Math.max(0,Mt),cache_used:!1};return s.performanceMetricsSubject.next(j),console.log(" Client-side optimization metrics:",j),{contextData:E,metrics:j}}catch(g){throw console.error(" Client-side optimization failed:",g),g}}).apply(this,arguments)}analyzePromptRequirements(t){const n=t.toLowerCase(),r=[...new Set((t.match(/\b(usd|eur|gbp|jpy|sgd|aud|chf|cad|hkd|cny|inr|krw|thb|myr|php|twd|nzd)\b/gi)||[]).map(v=>v.toUpperCase()))],l=[...new Set(t.match(/\b[A-Z]{2,6}\d{2,4}\b/g)||[])],c=[];/cash flow hedge|coh/i.test(n)&&c.push("COH"),/fair value hedge|mtm/i.test(n)&&c.push("MTM"),/net investment hedge|nih/i.test(n)&&c.push("NIH");const d=[];/\bcoi\b|core operating/i.test(n)&&d.push("COI"),/\bre\b|real estate/i.test(n)&&d.push("RE");let p="focused";return["comprehensive","detailed","full","complete","all","analysis","report"].some(v=>n.includes(v))?p="comprehensive":["current","status","quick","simple","brief"].some(v=>n.includes(v))&&(p="minimal"),{currencies:r,entities:l,hedge_methods:c,nav_types:d,complexity:p,requires_recent_data:/recent|latest|current|today|this week|this month/i.test(n)}}fetchEntities(t,n,s){var r=this;return(0,h.A)(function*(){const o=r.generateCacheKey("entities",{currency:t,type:n}),l=r.getFromCache(o);if(l)return l;let c=r.supabase.from("entity_master").select("*, currency_configuration(currency_type)").eq("currency_code",t);n&&(c=c.eq("currency_configuration.currency_type",n)),c=c.limit("minimal"===s?.complexity?5:"comprehensive"===s?.complexity?50:20);const{data:p,error:u}=yield c;if(u)throw u;return r.setCache(o,p||[],r.CACHE_TTL.entity_positions),p||[]})()}fetchPositions(t,n,s){var r=this;return(0,h.A)(function*(){const o=r.generateCacheKey("positions",{currency:t,nav:n}),l=r.getFromCache(o);if(l)return l;let c=r.supabase.from("position_nav_master").select("*").eq("currency_code",t);n?c=c.eq("nav_type",n):s?.nav_types?.length&&(c=c.in("nav_type",s.nav_types));const{data:d,error:p}=yield c;if(p)throw p;return r.setCache(o,d||[],r.CACHE_TTL.entity_positions),d||[]})()}fetchAllocations(t,n,s){var r=this;return(0,h.A)(function*(){const o="minimal"===s.complexity?10:"comprehensive"===s.complexity?50:25;let l=r.supabase.from("allocation_engine").select("*").eq("currency_code",t).order("created_date",{ascending:!1}).limit(o);if(s.requires_recent_data){const p=new Date;p.setDate(p.getDate()-30),l=l.gte("created_date",p.toISOString())}const{data:c,error:d}=yield l;if(d)throw d;return c||[]})()}fetchHedgeInstruments(t,n,s){var r=this;return(0,h.A)(function*(){const o=r.generateCacheKey("hedge_instruments",{currency:t,method:n.hedgeMethod,nav:n.navType}),l=r.getFromCache(o);if(l)return l;let c=r.supabase.from("hedge_instruments").select("*").eq("active_flag","Y");c=c.or(`base_currency.eq.${t},quote_currency.eq.${t},currency_pair.in.(${t}SGD,SGD${t})`),n.hedgeMethod&&(c=c.in("accounting_method_supported",["Both",n.hedgeMethod])),n.navType&&(c=c.in("nav_type_applicable",["Both",n.navType]));const{data:u,error:_}=yield c;if(_)throw _;return r.setCache(o,u||[],r.CACHE_TTL.static_config),u||[]})()}fetchCurrencyRates(t,n){var s=this;return(0,h.A)(function*(){const r=s.generateCacheKey("currency_rates",{currency:t,date:(new Date).toDateString()}),o=s.getFromCache(r);if(o)return o;const{data:l,error:c}=yield s.supabase.from("currency_rates").select("*").or(`currency_pair.eq.${t}SGD,currency_pair.eq.SGD${t}`).order("effective_date",{ascending:!1}).limit(10);if(c)throw c;return s.setCache(r,l||[],s.CACHE_TTL.currency_rates),l||[]})()}fetchCurrencyConfig(t){var n=this;return(0,h.A)(function*(){const s=n.generateCacheKey("currency_config",{currency:t}),r=n.getFromCache(s);if(r)return r;const{data:o,error:l}=yield n.supabase.from("currency_configuration").select("*").or(`currency_code.eq.${t},proxy_currency.eq.${t}`);if(l)throw l;return n.setCache(s,o||[],n.CACHE_TTL.static_config),o||[]})()}fetchRecentHedgeEvents(t,n){var s=this;return(0,h.A)(function*(){if(!t.length)return[];const{data:r,error:o}=yield s.supabase.from("hedge_business_events").select("*").in("entity_id",t.slice(0,20)).order("trade_date",{ascending:!1}).limit(15);if(o)throw o;return r||[]})()}fetchRecentInstructions(t,n){var s=this;return(0,h.A)(function*(){const{data:r,error:o}=yield s.supabase.from("hedge_instructions").select("*").eq("exposure_currency",t).order("instruction_date",{ascending:!1}).limit(10);if(o)throw o;return r||[]})()}structureOptimizedContext(t,n){return{entities:this.limitArray(t.entities,"minimal"===n.complexity?3:10),positions:this.limitArray(t.positions,"minimal"===n.complexity?5:15),recent_allocations:this.limitArray(t.allocations,"minimal"===n.complexity?5:10),hedge_instruments:this.limitArray(t.hedge_instruments,10),currency_rates:this.limitArray(t.currency_rates,5),prompt_analysis:n}}generateCacheKey(t,n){const s=Object.keys(n).sort().map(r=>`${r}:${n[r]}`).join("|");return`${t}:${this.hashString(s)}`}hashString(t){let n=0;for(let s=0;s<t.length;s++)n=(n<<5)-n+t.charCodeAt(s),n|=0;return Math.abs(n).toString(16)}getFromCache(t){const n=this.cache.get(t);return n&&n.expiry>Date.now()?n.data:(this.cache.delete(t),null)}setCache(t,n,s){this.cache.set(t,{data:n,expiry:Date.now()+s})}cleanExpiredCache(){const t=Date.now();for(const[n,s]of this.cache.entries())s.expiry<=t&&this.cache.delete(n)}extractEntityIds(t,n){const s=new Set;return t.forEach(r=>r.entity_id&&s.add(r.entity_id)),n.forEach(r=>r.entity_id&&s.add(r.entity_id)),Array.from(s)}limitArray(t,n){return t.slice(0,n)}estimateDataSize(t){return JSON.stringify(t).length}getCurrentMetrics(){return this.performanceMetricsSubject.value}clearCache(){this.cache.clear(),console.log(" Client cache cleared")}getCacheStats(){return{totalKeys:this.cache.size,cacheSize:JSON.stringify([...this.cache.values()]).length,hitRate:0}}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275prov=e.jDH({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var ze=m(2194);function Je(i,a){if(1&i&&(e.j41(0,"span",36),e.EFF(1),e.k0s()),2&i){const t=e.XpG();e.R7$(),e.Lme(" ",t.performanceMetrics.response_time_ms,"ms | ",t.performanceMetrics.cache_hit_rate," ")}}function We(i,a){if(1&i){const t=e.RV6();e.j41(0,"button",37),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.toggleBackend())}),e.EFF(1),e.k0s()}if(2&i){const t=e.XpG();e.R7$(),e.SpI(" ","unified"===t.backendStatus.type?" Unified":" Legacy"," ")}}function qe(i,a){if(1&i){const t=e.RV6();e.j41(0,"button",41),e.bIt("click",function(){const s=e.eBV(t).$implicit,r=e.XpG(2);return e.Njj(r.onFamilyChange(s.value))}),e.EFF(1),e.k0s()}if(2&i){const t=a.$implicit,n=e.XpG(2);e.AVh("bg-blue-600",n.selectedFamily===t.value)("text-white",n.selectedFamily===t.value)("border-blue-600",n.selectedFamily===t.value)("bg-white",n.selectedFamily!==t.value)("text-gray-700",n.selectedFamily!==t.value)("border-gray-300",n.selectedFamily!==t.value),e.R7$(),e.JRh(t.label)}}function Ze(i,a){if(1&i&&(e.j41(0,"div",38)(1,"div",39),e.DNE(2,qe,2,13,"button",40),e.k0s()()),2&i){const t=e.XpG();e.R7$(2),e.Y8G("ngForOf",t.families)}}function Qe(i,a){1&i&&(e.j41(0,"div",49),e.EFF(1,"Loading templates..."),e.k0s())}function et(i,a){if(1&i){const t=e.RV6();e.j41(0,"app-pt-card-list",50),e.bIt("select",function(s){e.eBV(t);const r=e.XpG(2);return e.Njj(r.select(s))}),e.k0s()}if(2&i){const t=e.XpG(2);e.Y8G("templates",t.filtered)("selectedIndex",t.selectedIndex)("successMap",t.successRates)}}function tt(i,a){if(1&i){const t=e.RV6();e.j41(0,"div",42)(1,"div",43)(2,"app-pt-filters",44),e.bIt("familyChange",function(s){e.eBV(t);const r=e.XpG();return e.Njj(r.onFamilyChange(s))})("categoryChange",function(s){e.eBV(t);const r=e.XpG();return e.Njj(r.onCategoryChange(s))})("searchChange",function(s){e.eBV(t);const r=e.XpG();return e.Njj(r.onSearchChange(s))}),e.k0s()(),e.j41(3,"div",45),e.DNE(4,Qe,2,0,"div",46)(5,et,1,3,"app-pt-card-list",47),e.k0s(),e.j41(6,"div",43)(7,"app-pt-preview",48),e.bIt("onSend",function(s){e.eBV(t);const r=e.XpG();return e.Njj(r.submit(s))}),e.k0s()()()}if(2&i){const t=e.XpG();e.R7$(2),e.Y8G("families",t.families)("categories",t.categories)("selectedFamily",t.selectedFamily)("selectedCategory",t.selectedCategory)("search",t.search)("hideFamily",!0),e.R7$(2),e.Y8G("ngIf",t.loading),e.R7$(),e.Y8G("ngIf",!t.loading),e.R7$(2),e.Y8G("template",t.selectedTemplate)("fields",t.getSelectedFieldsArray())("streaming",t.isStreaming)}}function nt(i,a){1&i&&(e.j41(0,"div",86)(1,"p",87),e.EFF(2,"No previous chats"),e.k0s()())}function st(i,a){if(1&i){const t=e.RV6();e.j41(0,"div",96),e.bIt("click",function(s){return e.eBV(t),e.Njj(s.stopPropagation())}),e.j41(1,"button",97),e.bIt("click",function(s){e.eBV(t);const r=e.XpG().$implicit;return e.XpG(2).confirmDeleteConversation(r.conversation_id,r.title),e.Njj(s.stopPropagation())}),e.nrm(2,"i",98),e.k0s()()}}function rt(i,a){if(1&i){const t=e.RV6();e.j41(0,"div",88)(1,"div",89),e.bIt("click",function(){const s=e.eBV(t).$implicit,r=e.XpG(2);return e.Njj(r.selectConversation(s.conversation_id))}),e.j41(2,"div",90)(3,"p",91),e.EFF(4),e.k0s(),e.j41(5,"p",92),e.EFF(6),e.nI1(7,"date"),e.k0s()(),e.j41(8,"button",93),e.bIt("click",function(s){const r=e.eBV(t).$implicit,o=e.XpG(2);return e.Njj(o.toggleConversationMenu(r.conversation_id,s))}),e.nrm(9,"i",94),e.k0s()(),e.DNE(10,st,3,0,"div",95),e.k0s()}if(2&i){const t=a.$implicit,n=e.XpG(2);e.AVh("bg-muted",n.selectedConversationId===t.conversation_id),e.R7$(4),e.JRh(t.title),e.R7$(2),e.JRh(e.i5U(7,7,t.updated_at,"short")),e.R7$(2),e.AVh("opacity-100",n.activeConversationMenu===t.conversation_id),e.R7$(2),e.Y8G("ngIf",n.activeConversationMenu===t.conversation_id)}}function it(i,a){if(1&i&&(e.j41(0,"h3",99),e.EFF(1),e.k0s()),2&i){const t=e.XpG(2);e.R7$(),e.SpI(" ",t.getCurrentConversationTitle()," ")}}function ot(i,a){if(1&i&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&i){const t=e.XpG(3);e.R7$(),e.JRh(t.getCurrentHawkAgent().name)}}function at(i,a){if(1&i&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&i){const t=e.XpG(3);e.R7$(),e.JRh(t.getApiKeyForTemplate(t.selectedFamily,t.selectedCategory).agentName)}}function lt(i,a){if(1&i){const t=e.RV6();e.j41(0,"button",104),e.bIt("click",function(s){e.eBV(t);const r=e.XpG(3);return e.Njj(r.toggleAgentMenu(s))}),e.nrm(1,"i",105),e.k0s()}}function ct(i,a){1&i&&e.nrm(0,"i",111)}function dt(i,a){if(1&i){const t=e.RV6();e.j41(0,"button",109),e.bIt("click",function(){const s=e.eBV(t).$implicit,r=e.XpG(4);return e.Njj(r.selectHawkAgent(s.key))}),e.j41(1,"span"),e.EFF(2),e.k0s(),e.DNE(3,ct,1,0,"i",110),e.k0s()}if(2&i){const t=a.$implicit,n=e.XpG(4);e.AVh("bg-accent",n.selectedHawkAgent===t.key),e.R7$(2),e.JRh(t.name),e.R7$(),e.Y8G("ngIf",n.selectedHawkAgent===t.key)}}function pt(i,a){if(1&i&&(e.j41(0,"div",106)(1,"div",107),e.DNE(2,dt,4,4,"button",108),e.k0s()()),2&i){const t=e.XpG(3);e.R7$(2),e.Y8G("ngForOf",t.getHawkAgentOptions())}}function ut(i,a){if(1&i&&(e.j41(0,"div",100)(1,"h3",101),e.DNE(2,ot,2,1,"span",31)(3,at,2,1,"span",31)(4,lt,2,0,"button",102),e.k0s(),e.DNE(5,pt,3,1,"div",103),e.k0s()),2&i){const t=e.XpG(2);e.R7$(2),e.Y8G("ngIf",t.isAgentMode),e.R7$(),e.Y8G("ngIf",!t.isAgentMode),e.R7$(),e.Y8G("ngIf",t.isAgentMode),e.R7$(),e.Y8G("ngIf",t.showAgentMenu)}}function gt(i,a){if(1&i){const t=e.RV6();e.j41(0,"button",120),e.bIt("click",function(){const s=e.eBV(t).$implicit,r=e.XpG(3);return e.Njj(r.useSuggestedPrompt(s))}),e.j41(1,"p",121),e.EFF(2),e.k0s(),e.j41(3,"p",122),e.EFF(4),e.k0s()()}if(2&i){const t=a.$implicit;e.R7$(2),e.JRh(t.title),e.R7$(2),e.JRh(t.description)}}function mt(i,a){if(1&i&&(e.j41(0,"div",112)(1,"div",113)(2,"div",114),e.nrm(3,"img",115),e.k0s(),e.j41(4,"h3",116),e.EFF(5),e.k0s(),e.j41(6,"p",117),e.EFF(7),e.k0s(),e.j41(8,"div",118),e.DNE(9,gt,5,2,"button",119),e.k0s()()()),2&i){const t=e.XpG(2);e.R7$(5),e.SpI("Welcome to ",t.getCurrentHawkAgent().name,""),e.R7$(2),e.Lme("",t.getCurrentHawkAgent().description,". I'm here to help you with ",t.getCurrentHawkAgent().scope.join(", "),"."),e.R7$(2),e.Y8G("ngForOf",t.suggestedPrompts)}}function ht(i,a){if(1&i){const t=e.RV6();e.j41(0,"div",126)(1,"div",127)(2,"div",128)(3,"div",129)(4,"button",130),e.bIt("click",function(){const s=e.eBV(t).$implicit,r=e.XpG(3);return e.Njj(r.copyMessage(s.user))}),e.qSk(),e.j41(5,"svg",131),e.nrm(6,"path",132),e.k0s()(),e.joV(),e.j41(7,"button",133),e.bIt("click",function(){const s=e.eBV(t).$implicit,r=e.XpG(3);return e.Njj(r.reloadMessage(s.user))}),e.qSk(),e.j41(8,"svg",131),e.nrm(9,"path",134),e.k0s()()(),e.joV(),e.j41(10,"div",135)(11,"p",136),e.EFF(12),e.k0s()()()(),e.j41(13,"div",137)(14,"div",138)(15,"div",139),e.nrm(16,"img",140),e.j41(17,"span",121),e.EFF(18),e.k0s()(),e.j41(19,"div",141),e.nrm(20,"div",142),e.k0s(),e.j41(21,"div",143)(22,"button",144),e.bIt("click",function(){const s=e.eBV(t).$implicit,r=e.XpG(3);return e.Njj(r.copyMessage(s.response))}),e.qSk(),e.j41(23,"svg",131),e.nrm(24,"path",132),e.k0s()(),e.joV(),e.j41(25,"button",145),e.bIt("click",function(){const s=e.eBV(t),r=s.$implicit,o=s.index,l=e.XpG(3);return e.Njj(l.exportToPDF(r,o))}),e.qSk(),e.j41(26,"svg",131),e.nrm(27,"path",146),e.k0s()(),e.joV(),e.j41(28,"button",147),e.bIt("click",function(){const s=e.eBV(t).$implicit,r=e.XpG(3);return e.Njj(r.exportToJSON(s.response))}),e.qSk(),e.j41(29,"svg",131),e.nrm(30,"path",148),e.k0s()()()()()()}if(2&i){const t=a.$implicit,n=e.XpG(3);e.R7$(12),e.JRh(t.user),e.R7$(6),e.JRh(n.getCurrentHawkAgent().name),e.R7$(2),e.Y8G("innerHTML",n.formatResponse(t.response),e.npT)}}function ft(i,a){if(1&i&&(e.j41(0,"div",137)(1,"div",138)(2,"div",139),e.nrm(3,"img",140),e.j41(4,"span",149),e.EFF(5,"HAWK Agent"),e.k0s()(),e.j41(6,"div",9)(7,"div",4),e.nrm(8,"div",150)(9,"div",151)(10,"div",152),e.k0s(),e.j41(11,"span",153),e.EFF(12),e.k0s()()()()),2&i){const t=e.XpG(3);e.R7$(12),e.SpI("Thinking... ",t.formatThinkingTime(t.thinkingElapsed),"")}}function _t(i,a){if(1&i&&(e.j41(0,"div",137)(1,"div",138)(2,"div",139)(3,"div",154),e.nrm(4,"div",155),e.k0s(),e.j41(5,"span",156),e.EFF(6,"HAWK Agent is typing..."),e.k0s()(),e.j41(7,"div",141),e.nrm(8,"div",142),e.k0s()()()),2&i){const t=e.XpG(3);e.R7$(8),e.Y8G("innerHTML",t.formatResponse(t.currentAgentResponse),e.npT)}}function yt(i,a){if(1&i&&(e.j41(0,"div",123),e.DNE(1,ht,31,3,"div",124)(2,ft,13,1,"div",125)(3,_t,9,1,"div",125),e.k0s()),2&i){const t=e.XpG(2);e.R7$(),e.Y8G("ngForOf",t.agentMessages),e.R7$(),e.Y8G("ngIf",t.isThinking),e.R7$(),e.Y8G("ngIf",t.isStreaming&&t.currentAgentResponse)}}function vt(i,a){1&i&&(e.qSk(),e.j41(0,"svg",157),e.nrm(1,"path",158),e.k0s())}function bt(i,a){1&i&&(e.qSk(),e.j41(0,"svg",157),e.nrm(1,"path",159),e.k0s())}function xt(i,a){if(1&i){const t=e.RV6();e.j41(0,"div",51)(1,"div",52)(2,"div",53)(3,"div",4),e.nrm(4,"img",54),e.j41(5,"span",55),e.EFF(6,"Hawk"),e.j41(7,"span",56),e.EFF(8,"Agent"),e.k0s()()()(),e.j41(9,"div",57)(10,"button",58),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.startNewConversation())}),e.nrm(11,"i",59),e.j41(12,"span"),e.EFF(13,"New chat"),e.k0s()(),e.j41(14,"button",60),e.nrm(15,"i",61),e.j41(16,"span"),e.EFF(17,"Search chats"),e.k0s()()(),e.j41(18,"div",62)(19,"div",63)(20,"h4",64),e.EFF(21,"Previous chats"),e.k0s()(),e.j41(22,"div",65),e.DNE(23,nt,3,0,"div",66)(24,rt,11,10,"div",67),e.k0s()()(),e.j41(25,"div",68)(26,"div",69)(27,"div"),e.DNE(28,it,2,1,"h3",70)(29,ut,6,4,"ng-template",null,0,e.C5r),e.k0s(),e.j41(31,"div",71)(32,"span",72),e.EFF(33,"Template"),e.k0s(),e.j41(34,"label",73)(35,"input",20),e.bIt("ngModelChange",function(s){e.eBV(t);const r=e.XpG();return e.Njj(r.onAgentModeToggle(s))}),e.k0s(),e.nrm(36,"div",74),e.k0s(),e.j41(37,"span",75),e.EFF(38,"Agent"),e.k0s()()(),e.j41(39,"div",76),e.DNE(40,mt,10,4,"div",77)(41,yt,4,3,"div",78),e.k0s(),e.j41(42,"div",79)(43,"div",80)(44,"div",81)(45,"div",82)(46,"textarea",83),e.mxI("ngModelChange",function(s){e.eBV(t);const r=e.XpG();return e.DH7(r.agentPrompt,s)||(r.agentPrompt=s),e.Njj(s)}),e.bIt("keydown.enter",function(s){e.eBV(t);const r=e.XpG();return e.Njj(r.handleTextareaEnter(s))}),e.EFF(47,"                  "),e.k0s(),e.j41(48,"button",84),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.isStreaming?s.stopStreaming():s.sendAgentMessage())}),e.DNE(49,vt,2,0,"svg",85)(50,bt,2,0,"svg",85),e.k0s()()()()()()()}if(2&i){const t=e.sdS(30),n=e.XpG();e.R7$(23),e.Y8G("ngIf",0===n.chatHistory.length),e.R7$(),e.Y8G("ngForOf",n.chatHistory),e.R7$(4),e.Y8G("ngIf",n.agentMessages.length>0)("ngIfElse",t),e.R7$(7),e.Y8G("ngModel",n.isAgentMode),e.R7$(5),e.Y8G("ngIf",0===n.agentMessages.length),e.R7$(),e.Y8G("ngIf",n.agentMessages.length>0),e.R7$(5),e.R50("ngModel",n.agentPrompt),e.Y8G("disabled",n.isStreaming),e.R7$(2),e.AVh("text-gray-400",!(n.isStreaming||n.agentPrompt&&n.agentPrompt.trim()))("hover:text-blue-600",!n.isStreaming&&n.agentPrompt&&n.agentPrompt.trim())("text-red-500",n.isStreaming)("hover:text-red-600",n.isStreaming)("disabled:opacity-50",!(n.isStreaming||n.agentPrompt&&n.agentPrompt.trim()))("disabled:cursor-not-allowed",!(n.isStreaming||n.agentPrompt&&n.agentPrompt.trim())),e.Y8G("disabled",!(n.isStreaming||n.agentPrompt&&n.agentPrompt.trim())),e.R7$(),e.Y8G("ngIf",!n.isStreaming),e.R7$(),e.Y8G("ngIf",n.isStreaming)}}function kt(i,a){if(1&i&&(e.j41(0,"div",168),e.nrm(1,"div",169),e.j41(2,"span",170),e.EFF(3),e.k0s()()),2&i){const t=e.XpG(3);e.R7$(3),e.SpI(" ","unified"===t.backendStatus.type?"Unified Backend Processing...":"Legacy Processing..."," ")}}function Ct(i,a){if(1&i&&(e.j41(0,"div",171),e.EFF(1),e.k0s()),2&i){const t=e.XpG(3);e.R7$(),e.E5c(" ",t.performanceMetrics.response_time_ms,"ms | ",t.performanceMetrics.cache_hit_rate," | ",t.performanceMetrics.total_records," records ")}}function Tt(i,a){if(1&i&&(e.j41(0,"div",163)(1,"div",164)(2,"h3",165),e.EFF(3,"Response"),e.k0s(),e.j41(4,"div",9),e.DNE(5,kt,4,1,"div",166)(6,Ct,2,3,"div",167),e.k0s()()()),2&i){const t=e.XpG(2);e.R7$(5),e.Y8G("ngIf",t.isStreaming),e.R7$(),e.Y8G("ngIf",t.performanceMetrics&&!t.isStreaming)}}function wt(i,a){if(1&i){const t=e.RV6();e.j41(0,"div",160),e.DNE(1,Tt,7,2,"div",161),e.j41(2,"app-pt-results",162),e.bIt("export",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.exportReport())})("ticket",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.createTicket())})("schedule",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.scheduleReview())})("share",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.shareResults())})("rate",function(s){e.eBV(t);const r=e.XpG();return e.Njj(r.setRating(s))})("setCompletion",function(s){e.eBV(t);const r=e.XpG();return e.Njj(r.setCompletionStatus(s))})("feedbackChange",function(s){e.eBV(t);const r=e.XpG();return e.Njj(r.onFeedbackChange(s))}),e.k0s()()}if(2&i){const t=e.XpG();e.R7$(),e.Y8G("ngIf",t.responseText||t.isStreaming),e.R7$(),e.Y8G("responseText",t.responseText)("streaming",t.isStreaming)("rating",t.currentRating)("completion",t.getCompletionStatus())("feedback",t.feedbackText)}}function Ft(i,a){if(1&i&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&i){const t=e.XpG();e.R7$(),e.SpI(" Avg Response: ",t.performanceMetrics.response_time_ms,"ms ")}}function Et(i,a){if(1&i){const t=e.RV6();e.j41(0,"button",172),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.clearCurrencyCache(s.getSelectedCurrency()))}),e.EFF(1),e.k0s()}if(2&i){const t=e.XpG();e.Mz_("title","Clear cache for ",t.getSelectedCurrency(),""),e.R7$(),e.SpI(" Clear ",t.getSelectedCurrency()," Cache ")}}function jt(i,a){if(1&i){const t=e.RV6();e.j41(0,"div",173),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.cancelDeleteConversation())}),e.j41(1,"div",174),e.bIt("click",function(s){return e.eBV(t),e.Njj(s.stopPropagation())}),e.j41(2,"div",175),e.qSk(),e.j41(3,"svg",176),e.nrm(4,"path",177),e.k0s(),e.joV(),e.j41(5,"h3",165),e.EFF(6,"Delete Conversation"),e.k0s()(),e.j41(7,"p",178),e.EFF(8,' Are you sure you want to delete "'),e.j41(9,"strong"),e.EFF(10),e.k0s(),e.EFF(11,'"? This action cannot be undone. '),e.k0s(),e.j41(12,"div",179)(13,"button",180),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.cancelDeleteConversation())}),e.EFF(14," Cancel "),e.k0s(),e.j41(15,"button",181),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.deleteConversation())}),e.EFF(16," Delete "),e.k0s()()()()}if(2&i){const t=e.XpG();e.R7$(10),e.JRh(null==t.conversationToDelete?null:t.conversationToDelete.title)}}let St=(()=>{class i{constructor(t,n,s,r,o,l,c,d,p){this.svc=t,this.sessions=n,this.conversations=s,this.route=r,this.router=o,this.sanitizer=l,this.cdr=c,this.clientOptimizer=d,this.layoutService=p,this.families=[],this.categories=[],this.selectedFamily="",this.selectedCategory="",this.search="",this.loading=!1,this.responseText="",this.isLoading=!1,this.isStreaming=!1,this.backendStatus={type:"unified",healthy:!0,performance:null,url:"/api"},this.performanceMetrics=null,this.showBackendToggle=!1,this.dataFreshnessMinutes=15,this.forceFreshData=!1,this.templates=[],this.filtered=[],this.selectedIndex=-1,this.selectedTemplate=null,this.selectedFields={},this.successRates={},this.currentRating=0,this.completionStatus="",this.feedbackText="",this.isAgentMode=!1,this.agentPrompt="",this.agentMessages=[],this.currentAgentResponse="",this.selectedHawkAgent=(()=>{try{if(typeof localStorage<"u"){const u=localStorage.getItem("selectedHawkAgent");if(u&&u in F.X0)return console.log("\u{1f504} Restored HAWK Agent from localStorage:",u),u}}catch(u){console.warn("\u26a0\ufe0f localStorage access failed:",u)}return console.log("\u{1f504} Using default HAWK Agent:",F.kz),F.kz})(),this.hawkAgents=F.X0,this.isThinking=!1,this.thinkingStartTime=0,this.thinkingElapsed=0,this.activeConversationMenu=null,this.showDeleteConfirmation=!1,this.conversationToDelete=null,this.chatHistory=[],this.selectedConversationId="",this.showAgentMenu=!1,this.defaultPrompts=[{title:"Current Hedge Positions",description:"What are our current hedge positions?",prompt:"What are our current hedge positions?"},{title:"USD Exposure Analysis",description:"Show me utilization analysis for USD exposures",prompt:"Show me utilization analysis for USD exposures"},{title:"Hedge Effectiveness",description:"Help me understand hedge effectiveness testing",prompt:"Help me understand hedge effectiveness testing"},{title:"Risk Assessment",description:"Perform a risk assessment for our portfolio",prompt:"Perform a risk assessment for our portfolio"}],this.allocationPrompts=[{title:"Utilization Check",description:"Check hedge allocation feasibility",prompt:"Perform utilization check for new 150,000 CNY hedge under ENTITY001"},{title:"CAR Buffer Analysis",description:"Check available hedge capacity",prompt:"Show CAR buffer availability and remaining capacity for USD hedges"},{title:"Capacity Assessment",description:"Multi-entity capacity analysis",prompt:"Analyze hedge capacity across all entities for EUR exposures"},{title:"Threshold Validation",description:"USD PB threshold compliance",prompt:"Validate USD deposit threshold compliance for new hedge allocation"}],this.bookingPrompts=[{title:"Hedge Booking Process",description:"Guide through hedge booking workflow",prompt:"Guide me through the hedge booking process for approved USD exposure of $500,000"},{title:"Murex Integration",description:"Murex booking and trade execution",prompt:"Help with Murex booking setup and trade execution parameters"},{title:"GL Posting Process",description:"General ledger posting workflow",prompt:"Explain GL posting process and accounting entries for completed hedge trades"},{title:"Amendment Process",description:"Hedge amendment and modification",prompt:"Process hedge amendment for maturity extension on existing trade"}],this.analyticsPrompts=[{title:"Hedge Effectiveness",description:"Test hedge effectiveness",prompt:"Run hedge effectiveness testing for Q3 2024"},{title:"Exposure Trends",description:"Analyze exposure trends",prompt:"Show me FX exposure trends over last 6 months"},{title:"P&L Attribution",description:"Break down P&L by hedge type",prompt:"Analyze P&L attribution by hedge instrument type"},{title:"Risk Metrics",description:"Current risk metrics dashboard",prompt:"Generate current risk metrics dashboard"}],this.configPrompts=[{title:"Update Thresholds",description:"Modify hedge thresholds",prompt:"Update USD hedge threshold to $2M for Entity001"},{title:"Buffer Configuration",description:"Configure buffer percentages",prompt:"Set CAR buffer to 15% for all entities"},{title:"Entity Mappings",description:"Update entity configurations",prompt:"Show current entity mapping configuration"},{title:"System Settings",description:"Review system parameters",prompt:"Review and validate current system parameters"}],this.suggestedPrompts=this.getPromptsForAgent(this.selectedHawkAgent),this.currentMsgUid="",this.currentInstructionId="",this.msgUidCounter=1,this.instructionIdCounter=1,this.subscriptions=[],this.streamBuffer="",this.reader=null,this.endedEvent=!1,this.retryCount=0,this.maxRetries=3,this.updateAgentUrl(),console.log("HAWK_AGENTS loaded:",Object.keys(this.hawkAgents).map(u=>this.hawkAgents[u].name)),this.updateWelcomeContent(),this.showBackendToggle=!0}toggleAgentMenu(t){t.stopPropagation(),this.showAgentMenu=!this.showAgentMenu}ngOnInit(){var t=this;return(0,h.A)(function*(){yield t.loadData(),t.loadFromUrl(),yield t.loadChatHistory(),t.documentClickListener=()=>{t.activeConversationMenu&&!t.showDeleteConfirmation&&(t.activeConversationMenu=null)},document.addEventListener("click",t.documentClickListener)})()}ngOnDestroy(){this.subscriptions.forEach(t=>t.unsubscribe()),this.stopThinkingTimer(),this.documentClickListener&&document.removeEventListener("click",this.documentClickListener)}get backendStatusText(){return this.backendStatus.healthy?"unified"===this.backendStatus.type?"Unified Smart Backend v5.0":"Legacy Dify Backend":"Backend Offline"}getSelectedFieldsArray(){if(!this.selectedTemplate)return[];const t=this.svc.extractFieldNamesFromTemplate(this.selectedTemplate),n=new Set,s=t.filter(r=>{const o=r.toLowerCase().trim();return!n.has(o)&&(n.add(o),!0)});return s.length!==t.length&&console.log(`Template "${this.selectedTemplate.name}": Removed ${t.length-s.length} duplicate fields`),s}getCompletionStatus(){return"complete"===this.completionStatus||"incomplete"===this.completionStatus?this.completionStatus:null}getSelectedCurrency(){return this.selectedFields.currency||""}sendToUnifiedBackend(t){const n=this.extractCurrencyFromPrompt(t),s={user_prompt:t,template_category:this.selectedCategory||"general",msg_uid:this.currentMsgUid,instruction_id:this.currentInstructionId,stream_response:!0,force_fresh:!0,use_cache:!1,currency:n,...this.isAgentMode?{agent_id:this.selectedHawkAgent,agent_api_key:this.getCurrentHawkAgent().apiKey}:(()=>{const r=this.getApiKeyForTemplate(this.selectedFamily,this.selectedCategory);return{agent_id:r.agentKey,agent_api_key:r.apiKey}})()};if(console.log("Processing prompt with Unified Backend"),this.isAgentMode)console.log("\u{1f511} Agent Mode - Using HAWK Agent:",this.getCurrentHawkAgent().name,"API Key:",this.getCurrentHawkAgent().apiKey);else{const r=this.getApiKeyForTemplate(this.selectedFamily,this.selectedCategory);console.log("\u{1f4dd} Template Mode - Family:",this.selectedFamily,"Category:",this.selectedCategory),console.log("\u{1f511} Routed to HAWK Agent:",r.agentName,"API Key:",r.apiKey)}fetch("/api/hawk-agent/process-prompt",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}).then(r=>{if(!r.ok)throw new Error(`HTTP ${r.status}`);if(!r.body)throw new Error("Empty response body");return this.isLoading=!1,this.reader=r.body.getReader(),this.processUnifiedStream(this.reader)}).catch(r=>{if(console.error("Unified Backend error:",r),!this.endedEvent&&this.retryCount<this.maxRetries)return this.retryCount++,void setTimeout(()=>this.sendToUnifiedBackend(t),Math.min(1500*this.retryCount,5e3));this.isLoading=!1,this.isStreaming=!1,this.responseText+=`\n\n[Backend Error: ${r?.message||r}]`,this.updateDatabaseSession("failed").catch(()=>{})})}processUnifiedStream(t){var n=this;return(0,h.A)(function*(){const s=new TextDecoder;let r="",o=null;try{for(;;){const{value:l,done:c}=yield t.read();if(c){n.isStreaming=!1,n.finishUnifiedStream(o);break}if(!l)continue;r+=s.decode(l,{stream:!0});const p=r.split("\n");r=p.pop()||"";for(const u of p)if(""!==u.trim())if(u.startsWith("data: ")){let _=u.substring(6);if(_.startsWith("data: ")&&(_=_.substring(6)),"event: ping"===_)continue;try{const g=JSON.parse(_);if("error"===g.event)return n.responseText=` **Error from Dify AI:** ${g.message||g.code||"Unknown error"}\n\n${JSON.stringify(g,null,2)}`,void(n.isStreaming=!1);if("agent_message"!==g.event&&"message"!==g.event||!(g.answer||g.output_text||g.data?.answer)||(n.streamBuffer+=g.answer||g.output_text||g.data?.answer||"",n.responseText=n.streamBuffer),"message_end"===g.event)return n.endedEvent=!0,g.metadata?.usage&&(o=g.metadata.usage),n.isStreaming=!1,void n.finishUnifiedStream(o);if("agent_thought"===g.event)continue}catch{_.trim()&&!_.includes("{")&&!_.includes("}")&&!_.includes('"event"')&&!_.includes('"answer"')&&!_.includes("data:")&&_.length>10&&(n.streamBuffer+=_,n.responseText=n.streamBuffer)}}else u.trim()&&u.length>5&&!u.includes("event:")&&!u.includes("id:")&&!u.includes("retry:")&&(n.streamBuffer+=u+"\n",n.responseText=n.streamBuffer)}}catch(l){n.isStreaming=!1,n.responseText+="\n\n[Stream interrupted due to error: "+l+"]",n.updateDatabaseSession("failed").catch(()=>{})}finally{t.releaseLock()}})()}finishUnifiedStream(t){let n="\n\n---\n";n+=`**Message UID:** ${this.currentMsgUid}\n`,n+=`**Instruction ID:** ${this.currentInstructionId}\n`,n+="**Backend:** Enhanced Unified Smart Backend v5.0\n",n+=`**Category:** ${this.selectedCategory||"general"}`,t&&(n+=`\n**Input Tokens:** ${t.input_tokens||t.prompt_tokens||0}`,n+=`\n**Output Tokens:** ${t.output_tokens||t.completion_tokens||0}`,n+=`\n**Total Tokens:** ${t.total_tokens||(t.input_tokens||t.prompt_tokens||0)+(t.output_tokens||t.completion_tokens||0)}`,n+=`\n**Processing Cost:** $${(Number(t.total_price)||0).toFixed(4)} USD`),this.responseText+=n,this.updateDatabaseSession("completed",t).catch(()=>{}),this.clientOptimizer.clearCache()}submit(t){var n=this;return(0,h.A)(function*(){const r=n.svc.fillTemplate(t?.text||"",t?.values||{});if(!r)return;n.resetResultsPage(),n.extractCurrencyFromPrompt(r),n.responseText="",n.isStreaming=!0,n.isLoading=!0,n.currentMsgUid=n.generateMsgUID(),n.currentInstructionId=n.generateInstructionId(),n.selectedFields=t.values||{},yield n.sessions.createSession(r,n.currentMsgUid,n.currentInstructionId,n.selectedCategory||"template",n.selectedIndex+1);const l=n.selectedTemplate?.id;l&&n.svc.incrementUsageCount(l).catch(()=>{}),n.sendToUnifiedBackend(r)})()}resetResultsPage(){this.clientOptimizer.clearCache(),this.responseText="",this.streamBuffer="",this.isStreaming=!1,this.isLoading=!1}extractCurrencyFromPrompt(t){const s=t.match(/\b(USD|EUR|GBP|JPY|SGD|AUD|CHF|CAD|HKD|CNY|INR|KRW|THB|MYR|PHP|TWD|NZD)\b/i);return s?s[1].toUpperCase():"USD"}forceRefreshData(){this.clientOptimizer.clearCache(),this.forceFreshData=!0;const t=document.querySelector('button[title="Force refresh all cached data"]');t&&(t.innerHTML="\u23f3 Refreshing...",t.disabled=!0,setTimeout(()=>{t.innerHTML="\u2705 Refreshed",setTimeout(()=>{t.innerHTML="\u{1f504} Fresh Data",t.disabled=!1,this.forceFreshData=!1},1500)},500))}toggleBackend(){this.backendStatus.type="unified"===this.backendStatus.type?"legacy":"unified",this.cdr.detectChanges()}refreshBackendStatus(){var t=this;return(0,h.A)(function*(){try{const n=yield fetch("/api/health",{method:"GET"});t.backendStatus.healthy=n.ok}catch{t.backendStatus.healthy=!1}t.cdr.detectChanges()})()}showPerformanceStats(){var t=this;return(0,h.A)(function*(){try{const n={response_time_ms:500,cache_hit_rate:"95%"};console.log("Performance Stats:",n);const s="unified"===t.backendStatus.type?`Unified Backend Stats:\n- Response Time: ${n.response_time_ms}ms\n- Cache Hit Rate: ${n.cache_hit_rate}\n- Backend: Unified Smart Backend v5.0`:"Legacy Backend: Performance tracking not available";alert(s)}catch(n){console.error("Failed to get performance stats:",n),alert("Failed to load performance statistics")}})()}clearCurrencyCache(t){return(0,h.A)(function*(){if(t)try{if(!(yield fetch(`/api/cache/clear/${t}`,{method:"DELETE"})).ok)throw new Error("Cache clear failed");alert(`Cache cleared for ${t}`)}catch(n){console.error("Failed to clear cache:",n),alert(`Failed to clear cache for ${t}`)}})()}loadData(){var t=this;return(0,h.A)(function*(){t.loading=!0;try{yield t.svc.loadTemplates(),t.svc.templates$.subscribe(n=>{t.templates=n}),t.buildFilters(),t.applyFilters(),t.loadSuccessRates()}catch(n){console.error("Failed to load templates:",n)}finally{t.loading=!1}})()}buildFilters(){const t=new Set,n=new Map;if(this.templates.forEach(s=>{s.family_type&&t.add(s.family_type);const r=s.template_category||"uncategorized";n.set(r,(n.get(r)||0)+1)}),this.families=Array.from(t).map(s=>({label:s,value:s})),!this.selectedFamily){const s=this.families.find(r=>{const o=(r.value||"").toLowerCase();return o.includes("instruction")&&o.includes("processing")});this.selectedFamily=s?s.value:this.families[0]?.value||""}this.buildCategoriesForFamily()}buildCategoriesForFamily(){const t=new Map;this.templates.filter(s=>!this.selectedFamily||s.family_type===this.selectedFamily).forEach(s=>{const r=s.template_category||"uncategorized";t.set(r,(t.get(r)||0)+1)}),this.categories=Array.from(t.entries()).map(([s,r])=>({label:s,value:s,count:r})),!this.selectedCategory&&this.categories.length>0&&(this.selectedCategory=this.categories[0].value)}applyFilters(){if(this.filtered=this.templates.filter(t=>{const n=!this.selectedFamily||t.family_type===this.selectedFamily,s=!this.selectedCategory||t.template_category===this.selectedCategory,r=!this.search||t.name?.toLowerCase().includes(this.search.toLowerCase())||t.description?.toLowerCase().includes(this.search.toLowerCase());return n&&s&&r}),(this.selectedIndex<0||this.selectedIndex>=this.filtered.length)&&(this.selectedIndex=this.filtered.length>0?0:-1),this.selectedTemplate=this.filtered[this.selectedIndex]||null,this.selectedTemplate){const t=this.getSelectedFieldsArray();console.log(`Template "${this.selectedTemplate.name}" selected with ${t.length} dynamic fields`)}}loadSuccessRates(){this.templates.forEach(t=>{t.id&&(this.successRates[t.id]=t.usage_count?Math.min(95,10*t.usage_count%100):Math.floor(100*Math.random()))})}onFamilyChange(t){this.selectedFamily=t,this.selectedIndex=-1,this.selectedCategory="",this.buildCategoriesForFamily(),this.applyFilters(),this.persistAndSyncUrl()}onCategoryChange(t){this.selectedCategory=t,this.selectedIndex=-1,this.applyFilters(),this.persistAndSyncUrl()}onSearchChange(t){this.search=t,this.selectedIndex=-1,this.applyFilters(),this.persistAndSyncUrl()}select(t){this.selectedIndex=t,this.selectedTemplate=this.filtered[t]||null,this.persistAndSyncUrl()}onAgentModeToggle(t){this.isAgentMode=t,this.layoutService.setAgentMode(t),t&&(this.agentMessages=[],this.currentAgentResponse="")}sendAgentMessage(){var t=this;return(0,h.A)(function*(){if(!t.agentPrompt?.trim()||t.isStreaming)return;const n=t.agentPrompt.trim();t.agentPrompt="";const s=t.agentMessages.length;if(t.agentMessages.push({user:n,response:""}),1===t.agentMessages.length&&!t.selectedConversationId)try{t.selectedConversationId=t.conversations.generateConversationId();const r=t.conversations.generateConversationTitle(n);yield t.conversations.createConversation(t.selectedConversationId,n,r),console.log("\u2705 Conversation created successfully")}catch(r){console.warn("\u26a0\ufe0f Failed to create conversation (table may not exist), continuing with in-memory chat:",r),t.selectedConversationId=t.conversations.generateConversationId()}t.startThinkingTimer(),t.currentAgentResponse="";try{console.log("\u{1f680} Sending agent message:",n.substring(0,50)+"..."),console.log("\u{1f310} Backend URL:","/api/hawk-agent/process-prompt"),console.log("\u{1f511} DEBUGGING - selectedHawkAgent variable:",t.selectedHawkAgent),console.log("\u{1f511} DEBUGGING - getCurrentHawkAgent() result:",t.getCurrentHawkAgent()),console.log("\u{1f511} Using HAWK Agent:",t.getCurrentHawkAgent().name,"API Key:",t.getCurrentHawkAgent().apiKey),console.log("\u{1f511} DEBUGGING - Agent payload will use:",{agent_id:t.selectedHawkAgent,agent_api_key:t.getCurrentHawkAgent().apiKey});const r=yield fetch("/api/hawk-agent/process-prompt",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_prompt:n,instruction_id:"agent-conversation",use_cache:!1,force_fresh:!0,agent_id:t.selectedHawkAgent,agent_api_key:t.getCurrentHawkAgent().apiKey,template_category:t.selectedCategory||"general"})});if(console.log("\u{1f4e1} Response status:",r.status,r.statusText),!r.ok){const p=yield r.text().catch(()=>"No error details");throw console.error("\u274c Backend error response:",p),new Error(`Backend error: ${r.status} - ${p}`)}const o=r.body?.getReader(),l=new TextDecoder;let c="",d="";if(console.log("\u{1f4d6} Starting to read response stream..."),o)for(;;){const{done:p,value:u}=yield o.read();if(p){console.log("\u2705 Stream reading completed"),d.trim()&&(console.log("\u{1f4dd} Processing final buffer:",d.substring(0,100)),t.processStreamLine(d.trim(),c));break}const _=l.decode(u,{stream:!0});console.log("\u{1f4e5} Received chunk:",_.substring(0,100)+(_.length>100?"...":"")),d+=_;const g=d.split("\n");d=g.pop()||"";for(const v of g){if(""===v.trim())continue;const k=t.processStreamLine(v,c);k&&(c+=k,t.currentAgentResponse=c,t.cdr.detectChanges())}}if(t.agentMessages[s].response=c,t.currentAgentResponse="",t.selectedConversationId&&c)try{yield t.conversations.addMessage(t.selectedConversationId,{role:"assistant",content:c,timestamp:(new Date).toISOString()}),console.log("\u2705 Assistant message saved to conversation")}catch(p){console.warn("\u26a0\ufe0f Failed to save assistant message (table may not exist), continuing in-memory:",p)}}catch(r){console.error("\u274c Agent message failed:",r),t.agentMessages[s].response="Sorry, I encountered an error processing your request. Please try again."}finally{t.stopThinkingTimer(),t.isStreaming=!1,t.cdr.detectChanges()}})()}processStreamLine(t,n){console.log("\u{1f4dd} Processing line:",t.substring(0,150)+(t.length>150?"...":""));try{let r,s="";if(t.startsWith("data: data: "))s=t.substring(12),console.log("\u{1f50d} Found nested data format");else{if(!t.startsWith("data: "))return console.log("\u23ed\ufe0f Skipping non-data line"),null;s=t.substring(6),console.log("\u{1f50d} Found standard data format")}if("[DONE]"===s.trim())return console.log("\u{1f3c1} Stream completion marker received"),null;try{r=JSON.parse(s),console.log("\u{1f4ca} Parsed data:",r)}catch(o){return!s.includes('"event"')&&s.length>50&&(console.warn("\u26a0\ufe0f Unexpected JSON parse error:",o),console.warn("\u{1f50d} Raw content:",s.substring(0,100)+"...")),null}if("error"===r.event)throw console.error("\u274c Backend error received:",r.message||r.error),new Error(`Backend error: ${r.message||r.error||"Unknown error"}`);return r.answer?(console.log("\u{1f4ac} Answer chunk received:",r.answer.substring(0,50)+"..."),this.isThinking&&(console.log("\u{1f6d1} Stopping thinking timer, starting stream display"),this.stopThinkingTimer(),this.isStreaming=!0),r.answer):(console.log("\u2753 No answer field in data:",Object.keys(r)),null)}catch(s){return t.length>50&&!t.includes("data:")&&console.warn("\u26a0\ufe0f Failed to parse agent stream line:",t.substring(0,100),s),null}}startNewConversation(){this.agentMessages.length>0&&this.saveCurrentConversation(),this.agentMessages=[],this.currentAgentResponse="",this.selectedConversationId=""}saveCurrentConversation(){var t=this;return(0,h.A)(function*(){if(0!==t.agentMessages.length)try{if(t.selectedConversationId){const n=t.agentMessages[t.agentMessages.length-1];n.response&&(yield t.conversations.addMessage(t.selectedConversationId,{role:"assistant",content:n.response,timestamp:(new Date).toISOString(),thinking_time:t.thinkingElapsed>0?t.formatThinkingTime(t.thinkingElapsed):void 0}))}else{const n=t.conversations.generateConversationId(),s=t.conversations.generateConversationTitle(t.agentMessages[0].user);yield t.conversations.createConversation(n,t.agentMessages[0].user,s);for(let r=0;r<t.agentMessages.length;r++){const o=t.agentMessages[r];r>0&&(yield t.conversations.addMessage(n,{role:"user",content:o.user,timestamp:(new Date).toISOString()})),o.response&&(yield t.conversations.addMessage(n,{role:"assistant",content:o.response,timestamp:(new Date).toISOString()}))}t.selectedConversationId=n}yield t.loadChatHistory()}catch(n){console.error("\u274c Failed to save conversation:",n)}})()}loadChatHistory(){var t=this;return(0,h.A)(function*(){try{t.chatHistory=yield t.conversations.getConversations(),console.log(`\u2705 Loaded ${t.chatHistory.length} previous conversations`)}catch(n){console.warn("\u26a0\ufe0f Failed to load chat history (conversations table may not exist):",n),t.chatHistory=[],console.log("\u{1f4a1} Previous chats feature requires hawk_agent_conversations table")}})()}selectConversation(t){var n=this;return(0,h.A)(function*(){if(n.isStreaming||n.isThinking)return void console.warn("\u26a0\ufe0f Cannot switch conversations during streaming");if(n.selectedConversationId===t)return;const s=n.chatHistory.find(r=>r.conversation_id===t);s&&(n.agentMessages.length>0&&n.selectedConversationId!==t&&(yield n.saveCurrentConversation()),n.selectedConversationId=t,n.agentMessages=n.convertDatabaseMessagesToComponent(s.messages),n.currentAgentResponse="",n.cdr.detectChanges())})()}convertDatabaseMessagesToComponent(t){const n=[];for(let s=0;s<t.length;s++){const r=t[s];if("user"===r.role){const o=t[s+1];n.push({user:r.content,response:o&&"assistant"===o.role?o.content:""}),o&&"assistant"===o.role&&s++}}return n}clearCurrentConversation(){this.agentMessages=[],this.currentAgentResponse="",this.selectedConversationId&&(this.chatHistory=this.chatHistory.filter(t=>t.conversation_id!==this.selectedConversationId),this.selectedConversationId="")}getCurrentConversationTitle(){return this.selectedConversationId?this.chatHistory.find(n=>n.conversation_id===this.selectedConversationId)?.title||"Conversation":this.agentMessages.length>0?this.generateConversationTitle():"New Conversation"}getCurrentTimestamp(){if(this.selectedConversationId){const t=this.chatHistory.find(n=>n.conversation_id===this.selectedConversationId);return t?new Date(t.updated_at||t.created_at||"").toLocaleString():""}return(new Date).toLocaleString()}useSuggestedPrompt(t){this.agentPrompt=t.prompt,setTimeout(()=>{const n=document.querySelector("textarea");n&&n.focus()},100)}handleTextareaEnter(t){t.shiftKey||(t.preventDefault(),this.sendAgentMessage())}stopStreaming(){this.stopThinkingTimer(),this.isStreaming=!1,this.cdr.detectChanges()}generateConversationId(){return"conv_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}generateConversationTitle(){if(0===this.agentMessages.length)return"New Conversation";const t=this.agentMessages[0].user;let n=t.length>60?t.substring(0,57)+"...":t;return n=n.replace(/\s+/g," ").trim(),n||"Untitled Conversation"}startThinkingTimer(){this.isThinking=!0,this.thinkingStartTime=Date.now(),this.thinkingElapsed=0,this.thinkingTimer=setInterval(()=>{this.thinkingElapsed=Date.now()-this.thinkingStartTime,this.cdr.detectChanges()},100)}stopThinkingTimer(){this.isThinking=!1,this.thinkingTimer&&(clearInterval(this.thinkingTimer),this.thinkingTimer=null)}formatThinkingTime(t){return`${Math.floor(t/1e3)}.${Math.floor(t%1e3/100)}s`}formatResponse(t){if(!t)return"";let n=t;return n=this.parseMarkdownTables(n),n=n.replace(/^### (.+)$/gm,'<h3 class="text-lg font-semibold text-gray-900 mt-6 mb-3">$1</h3>'),n=n.replace(/^## (.+)$/gm,'<h2 class="text-xl font-semibold text-gray-900 mt-6 mb-4">$1</h2>'),n=n.replace(/^# (.+)$/gm,'<h1 class="text-2xl font-bold text-gray-900 mt-6 mb-4">$1</h1>'),n=n.replace(/\*\*(.+?)\*\*/g,'<strong class="font-semibold">$1</strong>'),n=n.replace(/\*(.+?)\*/g,'<em class="italic">$1</em>'),n=n.replace(/^- (.+)$/gm,'<li class="ml-4">$1</li>'),n=n.replace(/(<li.*<\/li>)/gs,'<ul class="list-disc pl-6 my-3">$1</ul>'),n=n.replace(/^\d+\. (.+)$/gm,'<li class="ml-4">$1</li>'),n=n.replace(/(<li.*<\/li>)/gs,s=>s.includes("list-disc")?s:`<ol class="list-decimal pl-6 my-3">${s}</ol>`),n=n.replace(/\n\n/g,'</p><p class="mb-4">'),n=n.replace(/\n/g,"<br>"),n.startsWith("<")||(n=`<p class="mb-4">${n}</p>`),n}parseMarkdownTables(t){const n=t.split("\n");let s=[],r=0;for(;r<n.length;){const o=n[r];if(o.trim().includes("|")&&o.trim().startsWith("|")&&o.trim().endsWith("|")){let l=[],c=r;for(;r<n.length&&n[r].trim().includes("|")&&n[r].trim().startsWith("|")&&n[r].trim().endsWith("|");)l.push(n[r]),r++;if(l.length>0){const d=this.convertTableToHtml(l);s.push(d);continue}r=c}s.push(o),r++}return s.join("\n")}convertTableToHtml(t){if(0===t.length)return"";let n='<table class="min-w-full border-collapse border border-gray-300 my-4 bg-white shadow-sm rounded-lg overflow-hidden">';for(let s=0;s<t.length;s++){const r=t[s].trim();if(/^[\|\-\:\s]+$/.test(r))continue;const o=r.split("|").slice(1,-1).map(l=>l.trim());if(o.length>0){const l=0===s,c=l?"th":"td",d=l?"bg-gray-50 font-semibold text-gray-900":"bg-white text-gray-800";n+="<tr>",o.forEach(p=>{n+=`<${c} class="px-4 py-3 border border-gray-300 text-sm ${d}">${p||"&nbsp;"}</${c}>`}),n+="</tr>"}}return n+="</table>",n}exportReport(){console.log("Export report clicked")}createTicket(){console.log("Create ticket clicked")}scheduleReview(){console.log("Schedule review clicked")}shareResults(){console.log("Share results clicked")}setRating(t){this.currentRating=t}setCompletionStatus(t){this.completionStatus=t}onFeedbackChange(t){this.feedbackText=t}generateMsgUID(){return`MSG_${Date.now()}_${this.msgUidCounter++}`}generateInstructionId(){return"I"+this.instructionIdCounter++}updateDatabaseSession(t,n){var s=this;return(0,h.A)(function*(){try{yield s.sessions.updateSession(s.currentMsgUid,{agent_status:t,agent_end_time:(new Date).toISOString(),agent_response:{text:s.responseText,...n?{usage:n}:{},backend_type:s.backendStatus.type}})}catch(r){console.error("update session error",r)}})()}loadFromUrl(){this.route.queryParams.subscribe(t=>{if(t.family&&(this.selectedFamily=t.family),t.category&&(this.selectedCategory=t.category),t.search&&(this.search=t.search),void 0!==t.template){const n=parseInt(t.template,10);n>=0&&n<this.filtered.length&&(this.selectedIndex=n,this.selectedTemplate=this.filtered[n])}this.applyFilters()})}persistAndSyncUrl(){const t={};this.selectedFamily&&(t.family=this.selectedFamily),this.selectedCategory&&(t.category=this.selectedCategory),this.search&&(t.search=this.search),this.selectedIndex>=0&&(t.template=this.selectedIndex),this.router.navigate([],{queryParams:t,queryParamsHandling:"merge"})}onKeydown(t){this.isAgentMode||this.filtered?.length&&("ArrowDown"===t.key&&(this.selectedIndex=Math.min(this.filtered.length-1,Math.max(0,this.selectedIndex)+1),t.preventDefault(),this.persistAndSyncUrl()),"ArrowUp"===t.key&&(this.selectedIndex=Math.max(0,(this.selectedIndex<0?0:this.selectedIndex)-1),t.preventDefault(),this.persistAndSyncUrl()),"Enter"===t.key&&(this.submit({text:this.selectedTemplate?.prompt_text||"",values:{}}),t.preventDefault()))}onHawkAgentChange(t){console.log("\u{1f504} Changing HAWK Agent from",this.selectedHawkAgent,"to",t),this.selectedHawkAgent=t;try{localStorage.setItem("selectedHawkAgent",t),console.log("\u{1f4be} Persisted HAWK Agent to localStorage:",t)}catch(n){console.warn("\u26a0\ufe0f Failed to persist HAWK Agent to localStorage:",n)}this.updateAgentUrl(),console.log(`\u2705 Switched to ${this.getCurrentHawkAgent().name} with API key: ${this.getCurrentHawkAgent().apiKey}`)}selectHawkAgent(t){this.onHawkAgentChange(t),this.showAgentMenu=!1,this.updateWelcomeContent()}updateWelcomeContent(){this.suggestedPrompts=this.getPromptsForAgent(this.selectedHawkAgent)}getPromptsForAgent(t){switch(t){case"allocation":return this.allocationPrompts;case"booking":return this.bookingPrompts;case"analytics":return this.analyticsPrompts;case"config":return this.configPrompts;default:return this.defaultPrompts}}getApiKeyForTemplate(t,n){const s=(t||"").toLowerCase(),r=(n||"").toLowerCase();return s.includes("config")||s.includes("setup")?{agentKey:"config",apiKey:this.hawkAgents.config.apiKey,agentName:this.hawkAgents.config.name}:s.includes("instruction")&&s.includes("processing")&&(r.includes("inception")||r.includes("utilization")||r.includes("utilisation"))?{agentKey:"allocation",apiKey:this.hawkAgents.allocation.apiKey,agentName:this.hawkAgents.allocation.name}:{agentKey:"analytics",apiKey:this.hawkAgents.analytics.apiKey,agentName:this.hawkAgents.analytics.name}}updateAgentUrl(){this.agentUrlSafe=this.sanitizer.bypassSecurityTrustResourceUrl(this.hawkAgents[this.selectedHawkAgent].url)}getCurrentHawkAgent(){return this.hawkAgents[this.selectedHawkAgent]}getHawkAgentOptions(){const t=Object.keys(this.hawkAgents).map(n=>({key:n,name:this.hawkAgents[n].name}));return console.log("HAWK dropdown options:",t.map(n=>n.name)),t}getHawkStageBadgeClass(t){return{"1A":"bg-green-100 text-green-800 border border-green-200","1B":"bg-blue-100 text-blue-800 border border-blue-200",2:"bg-orange-100 text-orange-800 border border-orange-200",3:"bg-red-100 text-red-800 border border-red-200"}[t]||"bg-gray-100 text-gray-800 border border-gray-200"}toggleConversationMenu(t,n){n.stopPropagation(),this.activeConversationMenu=this.activeConversationMenu===t?null:t}confirmDeleteConversation(t,n){this.conversationToDelete={id:t,title:n},this.showDeleteConfirmation=!0,this.activeConversationMenu=null}cancelDeleteConversation(){this.showDeleteConfirmation=!1,this.conversationToDelete=null}deleteConversation(){var t=this;return(0,h.A)(function*(){if(t.conversationToDelete)try{yield t.conversations.deleteConversation(t.conversationToDelete.id),t.chatHistory=t.chatHistory.filter(n=>n.conversation_id!==t.conversationToDelete.id),t.selectedConversationId===t.conversationToDelete.id&&(t.selectedConversationId="",t.agentMessages=[],t.currentAgentResponse=""),console.log("\u2705 Conversation deleted successfully")}catch(n){console.error("\u274c Failed to delete conversation:",n)}finally{t.cancelDeleteConversation()}})()}copyMessage(t){navigator.clipboard&&navigator.clipboard.writeText(t).then(()=>{console.log("\u2705 Message copied to clipboard")}).catch(n=>{console.error("\u274c Failed to copy message:",n)})}reloadMessage(t){this.agentPrompt=t,this.sendAgentMessage()}exportToPDF(t,n){const s=this.agentMessages.slice(0,n+1),r=this.getCurrentConversationTitle(),o=this.generatePDFContent(s,r);this.downloadPDF(o,`${r}_conversation.pdf`)}exportToJSON(t){const n={timestamp:(new Date).toISOString(),agent:this.getCurrentHawkAgent().name,response:t,metadata:{agent_key:this.selectedHawkAgent,conversation_id:this.selectedConversationId||"temp"}},s=JSON.stringify(n,null,2),r=new Blob([s],{type:"application/json"}),o=URL.createObjectURL(r),l=document.createElement("a");l.href=o,l.download=`hawk_response_${Date.now()}.json`,l.click(),URL.revokeObjectURL(o),console.log("\u2705 Response exported to JSON")}generatePDFContent(t,n){let s="HAWK Agent Conversation Export\n";return s+=`Title: ${n}\n`,s+=`Agent: ${this.getCurrentHawkAgent().name}\n`,s+=`Date: ${(new Date).toLocaleString()}\n`,s+=`\n${"=".repeat(50)}\n\n`,t.forEach((r,o)=>{s+=`Message ${o+1}:\n`,s+=`User: ${r.user}\n\n`,s+=`${this.getCurrentHawkAgent().name}: ${r.response}\n\n`,s+=`${"-".repeat(30)}\n\n`}),s}downloadPDF(t,n){const s=new Blob([t],{type:"text/plain"}),r=URL.createObjectURL(s),o=document.createElement("a");o.href=r,o.download=n.replace(".pdf",".txt"),o.click(),URL.revokeObjectURL(r),console.log("\u2705 Conversation exported to text file")}static{this.\u0275fac=function(n){return new(n||i)(e.rXU(G.r),e.rXU(Xe.G),e.rXU(Le),e.rXU(H.nX),e.rXU(H.Ix),e.rXU(V.up),e.rXU(e.gRc),e.rXU(Ke),e.rXU(ze.Y))}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["app-enhanced-prompt-templates-v2"]],hostBindings:function(n,s){1&n&&e.bIt("keydown",function(o){return s.onKeydown(o)})},standalone:!0,features:[e.aNF],decls:53,vars:25,consts:[["hawkAgent",""],[1,"p-6","min-h-full","flex","flex-col"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-xl","font-semibold","text-gray-900","flex","items-center","gap-3"],[1,"flex","items-center","gap-2"],[1,"w-2","h-2","rounded-full","animate-pulse"],[1,"text-xs","font-medium","px-2","py-1","rounded-full"],[1,"text-xs","text-gray-500","flex","items-center","gap-4"],["class","text-green-600",4,"ngIf"],[1,"flex","items-center","gap-3"],["class","text-xs px-2 py-1 rounded border border-gray-300 hover:bg-gray-50","title","Toggle between Unified and Legacy backend",3,"click",4,"ngIf"],[1,"flex","items-center","gap-2",2,"display","none"],["title","Force refresh all cached data",1,"text-xs","px-2","py-1","rounded","border","border-blue-200","hover:bg-blue-50","text-blue-600",3,"click","disabled"],["title","Cache data for this duration",1,"text-xs","px-1","py-0.5","border","border-gray-200","rounded",3,"ngModelChange","ngModel"],["value","2"],["value","5"],["value","15"],["value","30"],[1,"text-sm",3,"ngClass"],[1,"inline-flex","items-center","cursor-pointer"],["type","checkbox",1,"sr-only",3,"ngModelChange","ngModel"],["role","switch",1,"relative"],[1,"w-12","h-7","rounded-full","transition-colors","duration-200","shadow-inner","ring-1",3,"ngClass"],[1,"absolute","top-0.5","left-0.5","w-6","h-6","bg-white","rounded-full","shadow","transform","transition","duration-200"],["class","mb-3 overflow-x-auto",4,"ngIf"],["class","flex-1 grid gap-4","style","grid-template-columns: 280px 1fr 400px; min-height: 0;",4,"ngIf"],["class","fixed inset-0 flex bg-white","style","z-index: 1000;",4,"ngIf"],["class","mt-4 bg-white border rounded-lg p-3 overflow-auto",4,"ngIf"],[1,"mt-4","border-t","border-gray-200","pt-3"],[1,"flex","items-center","justify-between","text-xs","text-gray-500"],[1,"flex","items-center","gap-4"],[4,"ngIf"],["title","View detailed performance statistics",1,"text-gray-600","hover:text-gray-700",3,"click"],["class","text-gray-600 hover:text-gray-700",3,"title","click",4,"ngIf"],["title","Refresh backend connection",1,"text-gray-600","hover:text-gray-700",3,"click"],["class","fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50","style","z-index: 9999 !important;",3,"click",4,"ngIf"],[1,"text-green-600"],["title","Toggle between Unified and Legacy backend",1,"text-xs","px-2","py-1","rounded","border","border-gray-300","hover:bg-gray-50",3,"click"],[1,"mb-3","overflow-x-auto"],[1,"flex","gap-2"],["class","px-3 py-1.5 rounded-full border text-sm whitespace-nowrap",3,"bg-blue-600","text-white","border-blue-600","bg-white","text-gray-700","border-gray-300","click",4,"ngFor","ngForOf"],[1,"px-3","py-1.5","rounded-full","border","text-sm","whitespace-nowrap",3,"click"],[1,"flex-1","grid","gap-4",2,"grid-template-columns","280px 1fr 400px","min-height","0"],[1,"bg-white","border","rounded-lg","p-3","overflow-auto"],[3,"familyChange","categoryChange","searchChange","families","categories","selectedFamily","selectedCategory","search","hideFamily"],[1,"bg-white","border","rounded-lg","p-3","overflow-auto","min-h-0",2,"max-height","520px"],["class","text-sm text-gray-500",4,"ngIf"],[3,"templates","selectedIndex","successMap","select",4,"ngIf"],[3,"onSend","template","fields","streaming"],[1,"text-sm","text-gray-500"],[3,"select","templates","selectedIndex","successMap"],[1,"fixed","inset-0","flex","bg-white",2,"z-index","1000"],[1,"bg-card","w-64","border-r","border-border","flex","flex-col"],[1,"h-14","flex","items-center","px-4","border-b","border-border"],["src","assets/Logo/DBS/Logomark.svg","alt","DBS",1,"w-6","h-6","object-contain"],[1,"font-bold","text-lg","tracking-tight","text-foreground"],[1,"font-light"],[1,"p-3","space-y-2"],[1,"w-full","btn-primary",3,"click"],[1,"pi","pi-plus","text-xs"],[1,"w-full","btn-secondary"],[1,"pi","pi-search","text-xs"],[1,"flex-1","overflow-hidden","flex","flex-col"],[1,"px-4","py-2"],[1,"text-[10px]","font-bold","text-muted-foreground","uppercase","tracking-widest"],[1,"flex-1","overflow-y-auto","p-2","space-y-1"],["class","text-center text-gray-400 py-8",4,"ngIf"],["class","relative p-2 rounded-md cursor-pointer transition-colors hover:bg-muted",3,"bg-muted",4,"ngFor","ngForOf"],[1,"flex-1","flex","flex-col","bg-background","relative"],[1,"h-14","px-6","border-b","border-border","flex","items-center","justify-between","bg-white/50","backdrop-blur-sm"],["class","text-base font-semibold text-gray-900",4,"ngIf","ngIfElse"],[1,"flex","items-center","gap-3","bg-muted/30","px-3","py-1.5","rounded-full","border","border-border/50"],[1,"text-xs","font-medium","text-muted-foreground"],[1,"inline-flex","items-center","cursor-pointer","relative"],[1,"w-9","h-5","bg-gray-200","peer-focus:outline-none","rounded-full","peer","peer-checked:after:translate-x-full","peer-checked:after:border-white","after:content-['']","after:absolute","after:top-[2px]","after:left-[2px]","after:bg-white","after:border-gray-300","after:border","after:rounded-full","after:h-4","after:w-4","after:transition-all","peer-checked:bg-blue-600"],[1,"text-xs","font-medium","text-primary"],[1,"flex-1","overflow-y-auto","px-4","py-4",2,"scroll-behavior","smooth"],["class","flex justify-center items-center h-full",4,"ngIf"],["class","space-y-6 max-w-4xl mx-auto",4,"ngIf"],[1,"bg-white","px-4","py-3"],[1,"max-w-6xl","mx-auto"],[1,"flex","gap-3"],[1,"flex-1","relative"],["placeholder","Ask me anything about hedge accounting...","rows","1",1,"w-full","px-4","py-3","pr-12","border","border-gray-300","rounded-xl","resize-none","focus:ring-2","focus:ring-blue-500","focus:border-blue-500","bg-white","shadow-sm",2,"min-height","52px","max-height","120px","box-shadow","0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)",3,"ngModelChange","keydown.enter","ngModel","disabled"],[1,"absolute","right-2","top-1/2","transform","-translate-y-1/2","p-2","transition-colors",3,"click","disabled"],["class","w-5 h-5","fill","none","stroke","currentColor","viewBox","0 0 24 24",4,"ngIf"],[1,"text-center","text-gray-400","py-8"],[1,"text-xs"],[1,"relative","p-2","rounded-md","cursor-pointer","transition-colors","hover:bg-muted"],[1,"flex","items-center","justify-between",3,"click"],[1,"flex-1","min-w-0"],[1,"text-xs","font-medium","text-foreground","truncate"],[1,"text-[10px]","text-muted-foreground","mt-0.5"],[1,"ml-2","p-1","rounded-full","hover:bg-background","transition-colors","opacity-0","group-hover:opacity-100",3,"click"],[1,"pi","pi-ellipsis-h","text-xs","text-muted-foreground"],["class","absolute top-0 right-0 w-16 h-full bg-red-500 rounded-md flex items-center justify-center z-10 animate-slide-in-right",3,"click",4,"ngIf"],[1,"absolute","top-0","right-0","w-16","h-full","bg-red-500","rounded-md","flex","items-center","justify-center","z-10","animate-slide-in-right",3,"click"],["title","Delete conversation",1,"text-white","hover:text-red-100","transition-colors",3,"click"],[1,"pi","pi-trash"],[1,"text-base","font-semibold","text-gray-900"],[1,"relative","inline-block"],[1,"text-base","font-semibold","text-gray-900","inline-flex","items-center","gap-2"],["class","px-1.5 py-1 rounded-md hover:bg-muted text-muted-foreground transition-colors","title","Select Agent",3,"click",4,"ngIf"],["class","absolute left-0 top-full mt-1 w-56 bg-popover border border-border rounded-lg shadow-lg z-50 overflow-hidden",4,"ngIf"],["title","Select Agent",1,"px-1.5","py-1","rounded-md","hover:bg-muted","text-muted-foreground","transition-colors",3,"click"],[1,"pi","pi-chevron-down","text-xs"],[1,"absolute","left-0","top-full","mt-1","w-56","bg-popover","border","border-border","rounded-lg","shadow-lg","z-50","overflow-hidden"],[1,"p-1"],["class","w-full text-left px-3 py-2 text-sm rounded-md hover:bg-accent hover:text-accent-foreground transition-colors flex items-center justify-between",3,"bg-accent","click",4,"ngFor","ngForOf"],[1,"w-full","text-left","px-3","py-2","text-sm","rounded-md","hover:bg-accent","hover:text-accent-foreground","transition-colors","flex","items-center","justify-between",3,"click"],["class","pi pi-check text-xs text-primary",4,"ngIf"],[1,"pi","pi-check","text-xs","text-primary"],[1,"flex","justify-center","items-center","h-full"],[1,"text-center","max-w-2xl"],[1,"w-16","h-16","mx-auto","mb-6","bg-gray-50","rounded-full","flex","items-center","justify-center","border","border-gray-200"],["src","assets/Logo/DBS/Logomark.svg","alt","DBS",1,"h-8","w-auto"],[1,"text-2xl","font-semibold","text-gray-900","mb-4"],[1,"text-gray-600","mb-8"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-3","max-w-2xl","mx-auto"],["class","p-4 text-left border border-gray-200 rounded-lg hover:border-blue-300 hover:bg-blue-50 transition-colors",3,"click",4,"ngFor","ngForOf"],[1,"p-4","text-left","border","border-gray-200","rounded-lg","hover:border-blue-300","hover:bg-blue-50","transition-colors",3,"click"],[1,"text-sm","font-medium","text-gray-900"],[1,"text-xs","text-gray-600","mt-1"],[1,"space-y-6","max-w-4xl","mx-auto"],["class","space-y-4",4,"ngFor","ngForOf"],["class","flex justify-start",4,"ngIf"],[1,"space-y-4"],[1,"flex","justify-end","group"],[1,"relative","flex","items-center","gap-2"],[1,"action-buttons","flex","items-center","gap-1","pr-2"],["title","Copy message",1,"p-1.5","rounded-full","hover:bg-gray-100","transition-colors",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","text-gray-500"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"],["title","Resend message",1,"p-1.5","rounded-full","hover:bg-gray-100","transition-colors",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"],[1,"max-w-2xl","bg-blue-600","text-white","rounded-2xl","px-4","py-3"],[1,"text-sm"],[1,"flex","justify-start"],[1,"w-full","max-w-4xl"],[1,"flex","items-center","gap-2","mb-3"],["src","assets/Logo/DBS/Logomark.svg","alt","HAWK Agent",1,"w-6","h-6"],[1,"overflow-x-auto"],[1,"prose","prose-sm","text-gray-800",2,"white-space","pre-wrap","word-wrap","break-word","overflow-wrap","break-word","min-width","800px",3,"innerHTML"],[1,"flex","items-center","gap-2","mt-3","pt-2","border-t","border-gray-100"],["title","Copy response",1,"p-1.5","rounded-full","hover:bg-gray-100","transition-colors",3,"click"],["title","Export conversation to PDF",1,"p-1.5","rounded-full","hover:bg-gray-100","transition-colors",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"],["title","Export response to JSON",1,"p-1.5","rounded-full","hover:bg-gray-100","transition-colors",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"],[1,"text-sm","font-medium","text-gray-600"],[1,"animate-pulse","rounded-full","h-2","w-2","bg-blue-600"],[1,"animate-pulse","rounded-full","h-2","w-2","bg-blue-600",2,"animation-delay","0.2s"],[1,"animate-pulse","rounded-full","h-2","w-2","bg-blue-600",2,"animation-delay","0.4s"],[1,"text-sm","text-gray-600"],[1,"w-6","h-6","flex","items-center","justify-center"],[1,"animate-spin","rounded-full","h-4","w-4","border-b-2","border-blue-600"],[1,"text-sm","font-medium","text-blue-600"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 19l9 2-9-18-9 18 9-2zm0 0v-8"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 6h12v12H6z"],[1,"mt-4","bg-white","border","rounded-lg","p-3","overflow-auto"],["class","mb-4",4,"ngIf"],[3,"export","ticket","schedule","share","rate","setCompletion","feedbackChange","responseText","streaming","rating","completion","feedback"],[1,"mb-4"],[1,"flex","items-center","justify-between","mb-3"],[1,"text-lg","font-semibold","text-gray-900"],["class","flex items-center gap-2 px-3 py-1 bg-blue-50 rounded-full",4,"ngIf"],["class","text-xs bg-green-50 text-green-700 px-2 py-1 rounded-full",4,"ngIf"],[1,"flex","items-center","gap-2","px-3","py-1","bg-blue-50","rounded-full"],[1,"animate-spin","rounded-full","h-3","w-3","border-b-2","border-blue-600"],[1,"text-xs","text-blue-700","font-medium"],[1,"text-xs","bg-green-50","text-green-700","px-2","py-1","rounded-full"],[1,"text-gray-600","hover:text-gray-700",3,"click","title"],[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","z-50",2,"z-index","9999 !important",3,"click"],[1,"bg-white","rounded-lg","p-6","max-w-md","mx-4","shadow-lg",3,"click"],[1,"flex","items-center","gap-3","mb-4"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6","text-red-500"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.232 15.5c-.77.833.192 2.5 1.732 2.5z"],[1,"text-gray-600","mb-6"],[1,"flex","gap-3","justify-end"],[1,"px-4","py-2","text-gray-700","border","border-gray-300","rounded-lg","hover:bg-gray-50","transition-colors",3,"click"],[1,"px-4","py-2","bg-red-500","text-white","rounded-lg","hover:bg-red-600","transition-colors",3,"click"]],template:function(n,s){1&n&&(e.j41(0,"div",1)(1,"div",2)(2,"div")(3,"h2",3),e.EFF(4),e.j41(5,"div",4),e.nrm(6,"div",5),e.j41(7,"span",6),e.EFF(8),e.k0s()()(),e.j41(9,"div",7)(10,"span"),e.EFF(11,"HAWK Agent v5.0"),e.k0s(),e.DNE(12,Je,2,2,"span",8),e.k0s()(),e.j41(13,"div",9),e.DNE(14,We,2,1,"button",10),e.j41(15,"div",11)(16,"button",12),e.bIt("click",function(){return s.forceRefreshData()}),e.EFF(17," \u{1f504} Fresh Data "),e.k0s(),e.j41(18,"select",13),e.mxI("ngModelChange",function(o){return e.DH7(s.dataFreshnessMinutes,o)||(s.dataFreshnessMinutes=o),o}),e.j41(19,"option",14),e.EFF(20,"2min"),e.k0s(),e.j41(21,"option",15),e.EFF(22,"5min"),e.k0s(),e.j41(23,"option",16),e.EFF(24,"15min"),e.k0s(),e.j41(25,"option",17),e.EFF(26,"30min"),e.k0s()()(),e.j41(27,"span",18),e.EFF(28,"Template Mode"),e.k0s(),e.j41(29,"label",19)(30,"input",20),e.bIt("ngModelChange",function(o){return s.onAgentModeToggle(o)}),e.k0s(),e.j41(31,"div",21),e.nrm(32,"div",22)(33,"div",23),e.k0s()(),e.j41(34,"span",18),e.EFF(35,"Agent Mode"),e.k0s()()(),e.DNE(36,Ze,3,1,"div",24)(37,tt,8,11,"div",25)(38,xt,51,24,"div",26)(39,wt,3,6,"div",27),e.j41(40,"div",28)(41,"div",29)(42,"div",30)(43,"span"),e.EFF(44),e.k0s(),e.DNE(45,Ft,2,1,"span",31),e.k0s(),e.j41(46,"div",9)(47,"button",32),e.bIt("click",function(){return s.showPerformanceStats()}),e.EFF(48," Performance Stats "),e.k0s(),e.DNE(49,Et,2,3,"button",33),e.j41(50,"button",34),e.bIt("click",function(){return s.refreshBackendStatus()}),e.EFF(51," Refresh "),e.k0s()()()()(),e.DNE(52,jt,17,1,"div",35)),2&n&&(e.R7$(4),e.SpI(" ",s.isAgentMode?"Agent Mode":"Template Mode"," "),e.R7$(2),e.HbH(s.backendStatus.healthy?"bg-green-500":"bg-red-500"),e.R7$(),e.HbH(s.backendStatus.healthy?"unified"===s.backendStatus.type?"bg-blue-100 text-blue-700":"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"),e.R7$(),e.SpI(" ",s.backendStatusText," "),e.R7$(4),e.Y8G("ngIf",s.performanceMetrics),e.R7$(2),e.Y8G("ngIf",s.showBackendToggle),e.R7$(2),e.Y8G("disabled",s.isLoading),e.R7$(2),e.R50("ngModel",s.dataFreshnessMinutes),e.R7$(9),e.Y8G("ngClass",s.isAgentMode?"text-gray-400":"text-blue-700 font-medium"),e.R7$(3),e.Y8G("ngModel",s.isAgentMode),e.R7$(),e.BMQ("aria-checked",s.isAgentMode),e.R7$(),e.Y8G("ngClass",s.isAgentMode?"bg-blue-600 ring-blue-600":"bg-gray-300 ring-gray-300"),e.R7$(),e.AVh("translate-x-5",s.isAgentMode),e.R7$(),e.Y8G("ngClass",s.isAgentMode?"text-blue-700 font-medium":"text-gray-400"),e.R7$(2),e.Y8G("ngIf",!s.isAgentMode),e.R7$(),e.Y8G("ngIf",!s.isAgentMode),e.R7$(),e.Y8G("ngIf",s.isAgentMode),e.R7$(),e.Y8G("ngIf",!s.isAgentMode),e.R7$(5),e.SpI("Backend: ",s.backendStatus.url||"Legacy Dify",""),e.R7$(),e.Y8G("ngIf",s.performanceMetrics),e.R7$(4),e.Y8G("ngIf","unified"===s.backendStatus.type&&s.getSelectedCurrency()),e.R7$(3),e.Y8G("ngIf",s.showDeleteConfirmation))},dependencies:[y.MD,y.YU,y.Sq,y.bT,y.vh,f.YN,f.xH,f.y7,f.me,f.Zm,f.wz,f.BC,f.vS,Y,Z,He,Ue],styles:["@keyframes _ngcontent-%COMP%_slide-in-right{0%{transform:translate(100%)}to{transform:translate(0)}}.animate-slide-in-right[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slide-in-right .2s ease-out}.conversation-item[_ngcontent-%COMP%]:hover   .action-buttons[_ngcontent-%COMP%], .group[_ngcontent-%COMP%]:hover   .action-buttons[_ngcontent-%COMP%]{opacity:1}.action-buttons[_ngcontent-%COMP%]{opacity:0;transition:opacity .2s ease}.action-buttons[_ngcontent-%COMP%]:hover{opacity:1}"]})}}return i})()}}]);